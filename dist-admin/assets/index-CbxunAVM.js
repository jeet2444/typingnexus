import{a as ca,b as da,g as ua,r as _,u as mr,R as At,B as ha,c as pa,d as Wt,N as ga}from"./vendor-C1IoJi6V.js";import{S as ma,U as fa,L as xa,A as Ps,P as ue,a as $t,T as oe,X as _e,b as gt,G as Tt,c as ys,B as fr,F as Ze,d as vs,e as St,f as Fe,I as ba,g as Pt,h as Rs,i as ts,D as Ue,j as Is,C as ss,E as ya,k as va,l as xr,m as wa,n as br,o as rs,p as as,q as yr,r as vr,s as ja,t as wr,M as Na,u as ns,v as _a,w as ws,x as jr,y as Nr,z as Sa,H as ka,J as Ca,R as Mt,K as _r,N as Sr,O as Ea,Z as kt,Q as Rt,V as kr,W as Aa,Y as is,_ as Ta,$ as Pa,a0 as Os,a1 as Ra,a2 as Ia,a3 as Ls,a4 as Oa,a5 as La,a6 as Da,a7 as Ua,a8 as $a,a9 as Ma,aa as Ba,ab as Fa,ac as za,ad as qa}from"./icons-B2oMMw0Z.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(i){if(i.ep)return;i.ep=!0;const n=r(i);fetch(i.href,n)}})();var Kt={exports:{}},st={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ds;function Ha(){if(Ds)return st;Ds=1;var s=ca(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,i=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function o(l,c,h){var d,f={},g=null,p=null;h!==void 0&&(g=""+h),c.key!==void 0&&(g=""+c.key),c.ref!==void 0&&(p=c.ref);for(d in c)a.call(c,d)&&!n.hasOwnProperty(d)&&(f[d]=c[d]);if(l&&l.defaultProps)for(d in c=l.defaultProps,c)f[d]===void 0&&(f[d]=c[d]);return{$$typeof:e,type:l,key:g,ref:p,props:f,_owner:i.current}}return st.Fragment=r,st.jsx=o,st.jsxs=o,st}var Us;function Wa(){return Us||(Us=1,Kt.exports=Ha()),Kt.exports}var t=Wa(),xt={},$s;function Ka(){if($s)return xt;$s=1;var s=da();return xt.createRoot=s.createRoot,xt.hydrateRoot=s.hydrateRoot,xt}var Va=Ka();const Ga=ua(Va);function Bt(s,e){var r={};for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&e.indexOf(a)<0&&(r[a]=s[a]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(s);i<a.length;i++)e.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(s,a[i])&&(r[a[i]]=s[a[i]]);return r}function Ja(s,e,r,a){function i(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function l(d){try{h(a.next(d))}catch(f){o(f)}}function c(d){try{h(a.throw(d))}catch(f){o(f)}}function h(d){d.done?n(d.value):i(d.value).then(l,c)}h((a=a.apply(s,e||[])).next())})}const Ya=s=>s?(...e)=>s(...e):(...e)=>fetch(...e);class js extends Error{constructor(e,r="FunctionsError",a){super(e),this.name=r,this.context=a}}class Qa extends js{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ms extends js{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Bs extends js{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var os;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(os||(os={}));class Xa{constructor(e,{headers:r={},customFetch:a,region:i=os.Any}={}){this.url=e,this.headers=r,this.region=i,this.fetch=Ya(a)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Ja(this,arguments,void 0,function*(r,a={}){var i;let n,o;try{const{headers:l,method:c,body:h,signal:d,timeout:f}=a;let g={},{region:p}=a;p||(p=this.region);const u=new URL(`${this.url}/${r}`);p&&p!=="any"&&(g["x-region"]=p,u.searchParams.set("forceFunctionRegion",p));let b;h&&(l&&!Object.prototype.hasOwnProperty.call(l,"Content-Type")||!l)?typeof Blob<"u"&&h instanceof Blob||h instanceof ArrayBuffer?(g["Content-Type"]="application/octet-stream",b=h):typeof h=="string"?(g["Content-Type"]="text/plain",b=h):typeof FormData<"u"&&h instanceof FormData?b=h:(g["Content-Type"]="application/json",b=JSON.stringify(h)):h&&typeof h!="string"&&!(typeof Blob<"u"&&h instanceof Blob)&&!(h instanceof ArrayBuffer)&&!(typeof FormData<"u"&&h instanceof FormData)?b=JSON.stringify(h):b=h;let m=d;f&&(o=new AbortController,n=setTimeout(()=>o.abort(),f),d?(m=o.signal,d.addEventListener("abort",()=>o.abort())):m=o.signal);const y=yield this.fetch(u.toString(),{method:c||"POST",headers:Object.assign(Object.assign(Object.assign({},g),this.headers),l),body:b,signal:m}).catch(k=>{throw new Qa(k)}),x=y.headers.get("x-relay-error");if(x&&x==="true")throw new Ms(y);if(!y.ok)throw new Bs(y);let w=((i=y.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),v;return w==="application/json"?v=yield y.json():w==="application/octet-stream"||w==="application/pdf"?v=yield y.blob():w==="text/event-stream"?v=y:w==="multipart/form-data"?v=yield y.formData():v=yield y.text(),{data:v,error:null,response:y}}catch(l){return{data:null,error:l,response:l instanceof Bs||l instanceof Ms?l.context:void 0}}finally{n&&clearTimeout(n)}})}}var Za=class extends Error{constructor(s){super(s.message),this.name="PostgrestError",this.details=s.details,this.hint=s.hint,this.code=s.code}},en=class{constructor(s){var e,r,a;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(e=s.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=s.signal,this.isMaybeSingle=(r=s.isMaybeSingle)!==null&&r!==void 0?r:!1,this.urlLengthLimit=(a=s.urlLengthLimit)!==null&&a!==void 0?a:8e3,s.fetch?this.fetch=s.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,e){return this.headers=new Headers(this.headers),this.headers.set(s,e),this}then(s,e){var r=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let i=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async n=>{let o=null,l=null,c=null,h=n.status,d=n.statusText;if(n.ok){var f,g;if(r.method!=="HEAD"){var p;const y=await n.text();y===""||(r.headers.get("Accept")==="text/csv"||r.headers.get("Accept")&&(!((p=r.headers.get("Accept"))===null||p===void 0)&&p.includes("application/vnd.pgrst.plan+text"))?l=y:l=JSON.parse(y))}const b=(f=r.headers.get("Prefer"))===null||f===void 0?void 0:f.match(/count=(exact|planned|estimated)/),m=(g=n.headers.get("content-range"))===null||g===void 0?void 0:g.split("/");b&&m&&m.length>1&&(c=parseInt(m[1])),r.isMaybeSingle&&r.method==="GET"&&Array.isArray(l)&&(l.length>1?(o={code:"PGRST116",details:`Results contain ${l.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,c=null,h=406,d="Not Acceptable"):l.length===1?l=l[0]:l=null)}else{var u;const b=await n.text();try{o=JSON.parse(b),Array.isArray(o)&&n.status===404&&(l=[],o=null,h=200,d="OK")}catch{n.status===404&&b===""?(h=204,d="No Content"):o={message:b}}if(o&&r.isMaybeSingle&&(!(o==null||(u=o.details)===null||u===void 0)&&u.includes("0 rows"))&&(o=null,h=200,d="OK"),o&&r.shouldThrowOnError)throw new Za(o)}return{error:o,data:l,count:c,status:h,statusText:d}});return this.shouldThrowOnError||(i=i.catch(n=>{var o;let l="",c="",h="";const d=n==null?void 0:n.cause;if(d){var f,g,p,u;const y=(f=d==null?void 0:d.message)!==null&&f!==void 0?f:"",x=(g=d==null?void 0:d.code)!==null&&g!==void 0?g:"";l=`${(p=n==null?void 0:n.name)!==null&&p!==void 0?p:"FetchError"}: ${n==null?void 0:n.message}`,l+=`

Caused by: ${(u=d==null?void 0:d.name)!==null&&u!==void 0?u:"Error"}: ${y}`,x&&(l+=` (${x})`),d!=null&&d.stack&&(l+=`
${d.stack}`)}else{var b;l=(b=n==null?void 0:n.stack)!==null&&b!==void 0?b:""}const m=this.url.toString().length;return(n==null?void 0:n.name)==="AbortError"||(n==null?void 0:n.code)==="ABORT_ERR"?(h="",c="Request was aborted (timeout or manual cancellation)",m>this.urlLengthLimit&&(c+=`. Note: Your request URL is ${m} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((d==null?void 0:d.name)==="HeadersOverflowError"||(d==null?void 0:d.code)==="UND_ERR_HEADERS_OVERFLOW")&&(h="",c="HTTP headers exceeded server limits (typically 16KB)",m>this.urlLengthLimit&&(c+=`. Your request URL is ${m} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(o=n==null?void 0:n.name)!==null&&o!==void 0?o:"FetchError"}: ${n==null?void 0:n.message}`,details:l,hint:c,code:h},data:null,count:null,status:0,statusText:""}})),i.then(s,e)}returns(){return this}overrideTypes(){return this}},tn=class extends en{select(s){let e=!1;const r=(s??"*").split("").map(a=>/\s/.test(a)&&!e?"":(a==='"'&&(e=!e),a)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:e=!0,nullsFirst:r,foreignTable:a,referencedTable:i=a}={}){const n=i?`${i}.order`:"order",o=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${o?`${o},`:""}${s}.${e?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:e,referencedTable:r=e}={}){const a=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${s}`),this}range(s,e,{foreignTable:r,referencedTable:a=r}={}){const i=typeof a>"u"?"offset":`${a}.offset`,n=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(i,`${s}`),this.url.searchParams.set(n,`${e-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:e=!1,settings:r=!1,buffers:a=!1,wal:i=!1,format:n="text"}={}){var o;const l=[s?"analyze":null,e?"verbose":null,r?"settings":null,a?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${n}; for="${c}"; options=${l};`),n==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}};const Fs=new RegExp("[,()]");var Ge=class extends tn{eq(s,e){return this.url.searchParams.append(s,`eq.${e}`),this}neq(s,e){return this.url.searchParams.append(s,`neq.${e}`),this}gt(s,e){return this.url.searchParams.append(s,`gt.${e}`),this}gte(s,e){return this.url.searchParams.append(s,`gte.${e}`),this}lt(s,e){return this.url.searchParams.append(s,`lt.${e}`),this}lte(s,e){return this.url.searchParams.append(s,`lte.${e}`),this}like(s,e){return this.url.searchParams.append(s,`like.${e}`),this}likeAllOf(s,e){return this.url.searchParams.append(s,`like(all).{${e.join(",")}}`),this}likeAnyOf(s,e){return this.url.searchParams.append(s,`like(any).{${e.join(",")}}`),this}ilike(s,e){return this.url.searchParams.append(s,`ilike.${e}`),this}ilikeAllOf(s,e){return this.url.searchParams.append(s,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(s,e){return this.url.searchParams.append(s,`ilike(any).{${e.join(",")}}`),this}regexMatch(s,e){return this.url.searchParams.append(s,`match.${e}`),this}regexIMatch(s,e){return this.url.searchParams.append(s,`imatch.${e}`),this}is(s,e){return this.url.searchParams.append(s,`is.${e}`),this}isDistinct(s,e){return this.url.searchParams.append(s,`isdistinct.${e}`),this}in(s,e){const r=Array.from(new Set(e)).map(a=>typeof a=="string"&&Fs.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(s,`in.(${r})`),this}notIn(s,e){const r=Array.from(new Set(e)).map(a=>typeof a=="string"&&Fs.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(s,`not.in.(${r})`),this}contains(s,e){return typeof e=="string"?this.url.searchParams.append(s,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(s,`cs.{${e.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(e)}`),this}containedBy(s,e){return typeof e=="string"?this.url.searchParams.append(s,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(s,`cd.{${e.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(e)}`),this}rangeGt(s,e){return this.url.searchParams.append(s,`sr.${e}`),this}rangeGte(s,e){return this.url.searchParams.append(s,`nxl.${e}`),this}rangeLt(s,e){return this.url.searchParams.append(s,`sl.${e}`),this}rangeLte(s,e){return this.url.searchParams.append(s,`nxr.${e}`),this}rangeAdjacent(s,e){return this.url.searchParams.append(s,`adj.${e}`),this}overlaps(s,e){return typeof e=="string"?this.url.searchParams.append(s,`ov.${e}`):this.url.searchParams.append(s,`ov.{${e.join(",")}}`),this}textSearch(s,e,{config:r,type:a}={}){let i="";a==="plain"?i="pl":a==="phrase"?i="ph":a==="websearch"&&(i="w");const n=r===void 0?"":`(${r})`;return this.url.searchParams.append(s,`${i}fts${n}.${e}`),this}match(s){return Object.entries(s).forEach(([e,r])=>{this.url.searchParams.append(e,`eq.${r}`)}),this}not(s,e,r){return this.url.searchParams.append(s,`not.${e}.${r}`),this}or(s,{foreignTable:e,referencedTable:r=e}={}){const a=r?`${r}.or`:"or";return this.url.searchParams.append(a,`(${s})`),this}filter(s,e,r){return this.url.searchParams.append(s,`${e}.${r}`),this}},sn=class{constructor(s,{headers:e={},schema:r,fetch:a,urlLengthLimit:i=8e3}){this.url=s,this.headers=new Headers(e),this.schema=r,this.fetch=a,this.urlLengthLimit=i}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(s,e){const{head:r=!1,count:a}=e??{},i=r?"HEAD":"GET";let n=!1;const o=(s??"*").split("").map(h=>/\s/.test(h)&&!n?"":(h==='"'&&(n=!n),h)).join(""),{url:l,headers:c}=this.cloneRequestState();return l.searchParams.set("select",o),a&&c.append("Prefer",`count=${a}`),new Ge({method:i,url:l,headers:c,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(s,{count:e,defaultToNull:r=!0}={}){var a;const i="POST",{url:n,headers:o}=this.cloneRequestState();if(e&&o.append("Prefer",`count=${e}`),r||o.append("Prefer","missing=default"),Array.isArray(s)){const l=s.reduce((c,h)=>c.concat(Object.keys(h)),[]);if(l.length>0){const c=[...new Set(l)].map(h=>`"${h}"`);n.searchParams.set("columns",c.join(","))}}return new Ge({method:i,url:n,headers:o,schema:this.schema,body:s,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(s,{onConflict:e,ignoreDuplicates:r=!1,count:a,defaultToNull:i=!0}={}){var n;const o="POST",{url:l,headers:c}=this.cloneRequestState();if(c.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),e!==void 0&&l.searchParams.set("on_conflict",e),a&&c.append("Prefer",`count=${a}`),i||c.append("Prefer","missing=default"),Array.isArray(s)){const h=s.reduce((d,f)=>d.concat(Object.keys(f)),[]);if(h.length>0){const d=[...new Set(h)].map(f=>`"${f}"`);l.searchParams.set("columns",d.join(","))}}return new Ge({method:o,url:l,headers:c,schema:this.schema,body:s,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch,urlLengthLimit:this.urlLengthLimit})}update(s,{count:e}={}){var r;const a="PATCH",{url:i,headers:n}=this.cloneRequestState();return e&&n.append("Prefer",`count=${e}`),new Ge({method:a,url:i,headers:n,schema:this.schema,body:s,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:s}={}){var e;const r="DELETE",{url:a,headers:i}=this.cloneRequestState();return s&&i.append("Prefer",`count=${s}`),new Ge({method:r,url:a,headers:i,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}};function ot(s){"@babel/helpers - typeof";return ot=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ot(s)}function rn(s,e){if(ot(s)!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var a=r.call(s,e);if(ot(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function an(s){var e=rn(s,"string");return ot(e)=="symbol"?e:e+""}function nn(s,e,r){return(e=an(e))in s?Object.defineProperty(s,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[e]=r,s}function zs(s,e){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);e&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable})),r.push.apply(r,a)}return r}function bt(s){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?zs(Object(r),!0).forEach(function(a){nn(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):zs(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}var on=class Cr{constructor(e,{headers:r={},schema:a,fetch:i,timeout:n,urlLengthLimit:o=8e3}={}){this.url=e,this.headers=new Headers(r),this.schemaName=a,this.urlLengthLimit=o;const l=i??globalThis.fetch;n!==void 0&&n>0?this.fetch=(c,h)=>{const d=new AbortController,f=setTimeout(()=>d.abort(),n),g=h==null?void 0:h.signal;if(g){if(g.aborted)return clearTimeout(f),l(c,h);const p=()=>{clearTimeout(f),d.abort()};return g.addEventListener("abort",p,{once:!0}),l(c,bt(bt({},h),{},{signal:d.signal})).finally(()=>{clearTimeout(f),g.removeEventListener("abort",p)})}return l(c,bt(bt({},h),{},{signal:d.signal})).finally(()=>clearTimeout(f))}:this.fetch=l}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new sn(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(e){return new Cr(this.url,{headers:this.headers,schema:e,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(e,r={},{head:a=!1,get:i=!1,count:n}={}){var o;let l;const c=new URL(`${this.url}/rpc/${e}`);let h;const d=p=>p!==null&&typeof p=="object"&&(!Array.isArray(p)||p.some(d)),f=a&&Object.values(r).some(d);f?(l="POST",h=r):a||i?(l=a?"HEAD":"GET",Object.entries(r).filter(([p,u])=>u!==void 0).map(([p,u])=>[p,Array.isArray(u)?`{${u.join(",")}}`:`${u}`]).forEach(([p,u])=>{c.searchParams.append(p,u)})):(l="POST",h=r);const g=new Headers(this.headers);return f?g.set("Prefer",n?`count=${n},return=minimal`:"return=minimal"):n&&g.set("Prefer",`count=${n}`),new Ge({method:l,url:c,headers:g,schema:this.schemaName,body:h,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch,urlLengthLimit:this.urlLengthLimit})}};class ln{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const r=globalThis.process;if(r){const a=r.versions;if(a&&a.node){const i=a.node,n=parseInt(i.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let r=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(r+=`

Suggested solution: ${e.workaround}`),new Error(r)}static createWebSocket(e,r){const a=this.getWebSocketConstructor();return new a(e,r)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const cn="2.95.0",dn=`realtime-js/${cn}`,un="1.0.0",Er="2.0.0",qs=Er,ls=1e4,hn=1e3,pn=100;var Te;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(Te||(Te={}));var ee;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(ee||(ee={}));var we;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(we||(we={}));var cs;(function(s){s.websocket="websocket"})(cs||(cs={}));var $e;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})($e||($e={}));class gn{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,r){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(e));let a=[e.join_ref,e.ref,e.topic,e.event,e.payload];return r(JSON.stringify(a))}_binaryEncodeUserBroadcastPush(e){var r;return this._isArrayBuffer((r=e.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var r,a;const i=(a=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&a!==void 0?a:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,i)}_encodeJsonUserBroadcastPush(e){var r,a;const i=(a=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&a!==void 0?a:{},o=new TextEncoder().encode(JSON.stringify(i)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,r,a){var i,n;const o=e.topic,l=(i=e.ref)!==null&&i!==void 0?i:"",c=(n=e.join_ref)!==null&&n!==void 0?n:"",h=e.payload.event,d=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},f=Object.keys(d).length===0?"":JSON.stringify(d);if(c.length>255)throw new Error(`joinRef length ${c.length} exceeds maximum of 255`);if(l.length>255)throw new Error(`ref length ${l.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`userEvent length ${h.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`metadata length ${f.length} exceeds maximum of 255`);const g=this.USER_BROADCAST_PUSH_META_LENGTH+c.length+l.length+o.length+h.length+f.length,p=new ArrayBuffer(this.HEADER_LENGTH+g);let u=new DataView(p),b=0;u.setUint8(b++,this.KINDS.userBroadcastPush),u.setUint8(b++,c.length),u.setUint8(b++,l.length),u.setUint8(b++,o.length),u.setUint8(b++,h.length),u.setUint8(b++,f.length),u.setUint8(b++,r),Array.from(c,y=>u.setUint8(b++,y.charCodeAt(0))),Array.from(l,y=>u.setUint8(b++,y.charCodeAt(0))),Array.from(o,y=>u.setUint8(b++,y.charCodeAt(0))),Array.from(h,y=>u.setUint8(b++,y.charCodeAt(0))),Array.from(f,y=>u.setUint8(b++,y.charCodeAt(0)));var m=new Uint8Array(p.byteLength+a.byteLength);return m.set(new Uint8Array(p),0),m.set(new Uint8Array(a),p.byteLength),m.buffer}decode(e,r){if(this._isArrayBuffer(e)){let a=this._binaryDecode(e);return r(a)}if(typeof e=="string"){const a=JSON.parse(e),[i,n,o,l,c]=a;return r({join_ref:i,ref:n,topic:o,event:l,payload:c})}return r({})}_binaryDecode(e){const r=new DataView(e),a=r.getUint8(0),i=new TextDecoder;switch(a){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,r,i)}}_decodeUserBroadcast(e,r,a){const i=r.getUint8(1),n=r.getUint8(2),o=r.getUint8(3),l=r.getUint8(4);let c=this.HEADER_LENGTH+4;const h=a.decode(e.slice(c,c+i));c=c+i;const d=a.decode(e.slice(c,c+n));c=c+n;const f=a.decode(e.slice(c,c+o));c=c+o;const g=e.slice(c,e.byteLength),p=l===this.JSON_ENCODING?JSON.parse(a.decode(g)):g,u={type:this.BROADCAST_EVENT,event:d,payload:p};return o>0&&(u.meta=JSON.parse(f)),{join_ref:null,ref:null,topic:h,event:this.BROADCAST_EVENT,payload:u}}_isArrayBuffer(e){var r;return e instanceof ArrayBuffer||((r=e==null?void 0:e.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}_pick(e,r){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([a])=>r.includes(a)))}}class Ar{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var $;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})($||($={}));const Hs=(s,e,r={})=>{var a;const i=(a=r.skipTypes)!==null&&a!==void 0?a:[];return e?Object.keys(e).reduce((n,o)=>(n[o]=mn(o,s,e,i),n),{}):{}},mn=(s,e,r,a)=>{const i=e.find(l=>l.name===s),n=i==null?void 0:i.type,o=r[s];return n&&!a.includes(n)?Tr(n,o):ds(o)},Tr=(s,e)=>{if(s.charAt(0)==="_"){const r=s.slice(1,s.length);return yn(e,r)}switch(s){case $.bool:return fn(e);case $.float4:case $.float8:case $.int2:case $.int4:case $.int8:case $.numeric:case $.oid:return xn(e);case $.json:case $.jsonb:return bn(e);case $.timestamp:return vn(e);case $.abstime:case $.date:case $.daterange:case $.int4range:case $.int8range:case $.money:case $.reltime:case $.text:case $.time:case $.timestamptz:case $.timetz:case $.tsrange:case $.tstzrange:return ds(e);default:return ds(e)}},ds=s=>s,fn=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},xn=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},bn=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch{return s}return s},yn=(s,e)=>{if(typeof s!="string")return s;const r=s.length-1,a=s[r];if(s[0]==="{"&&a==="}"){let n;const o=s.slice(1,r);try{n=JSON.parse("["+o+"]")}catch{n=o?o.split(","):[]}return n.map(l=>Tr(e,l))}return s},vn=s=>typeof s=="string"?s.replace(" ","T"):s,Pr=s=>{const e=new URL(s);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Vt{constructor(e,r,a={},i=ls){this.channel=e,this.event=r,this.payload=a,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var a;return this._hasReceived(e)&&r((a=this.receivedResp)===null||a===void 0?void 0:a.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(a=>a.status===e).forEach(a=>a.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ws;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(Ws||(Ws={}));class nt{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const a=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(a.state,{},i=>{const{onJoin:n,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=nt.syncState(this.state,i,n,o),this.pendingDiffs.forEach(c=>{this.state=nt.syncDiff(this.state,c,n,o)}),this.pendingDiffs=[],l()}),this.channel._on(a.diff,{},i=>{const{onJoin:n,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=nt.syncDiff(this.state,i,n,o),l())}),this.onJoin((i,n,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:n,newPresences:o})}),this.onLeave((i,n,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:n,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,a,i){const n=this.cloneDeep(e),o=this.transformState(r),l={},c={};return this.map(n,(h,d)=>{o[h]||(c[h]=d)}),this.map(o,(h,d)=>{const f=n[h];if(f){const g=d.map(m=>m.presence_ref),p=f.map(m=>m.presence_ref),u=d.filter(m=>p.indexOf(m.presence_ref)<0),b=f.filter(m=>g.indexOf(m.presence_ref)<0);u.length>0&&(l[h]=u),b.length>0&&(c[h]=b)}else l[h]=d}),this.syncDiff(n,{joins:l,leaves:c},a,i)}static syncDiff(e,r,a,i){const{joins:n,leaves:o}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return a||(a=()=>{}),i||(i=()=>{}),this.map(n,(l,c)=>{var h;const d=(h=e[l])!==null&&h!==void 0?h:[];if(e[l]=this.cloneDeep(c),d.length>0){const f=e[l].map(p=>p.presence_ref),g=d.filter(p=>f.indexOf(p.presence_ref)<0);e[l].unshift(...g)}a(l,d,c)}),this.map(o,(l,c)=>{let h=e[l];if(!h)return;const d=c.map(f=>f.presence_ref);h=h.filter(f=>d.indexOf(f.presence_ref)<0),e[l]=h,i(l,h,c),h.length===0&&delete e[l]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(a=>r(a,e[a]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,a)=>{const i=e[a];return"metas"in i?r[a]=i.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):r[a]=i,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ks;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(Ks||(Ks={}));var it;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(it||(it={}));var Ne;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(Ne||(Ne={}));class Qe{constructor(e,r={config:{}},a){var i,n;if(this.topic=e,this.params=r,this.socket=a,this.bindings={},this.state=ee.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new Vt(this,we.join,this.params,this.timeout),this.rejoinTimer=new Ar(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ee.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ee.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=ee.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ee.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=ee.errored,this.rejoinTimer.scheduleTimeout())}),this._on(we.reply,{},(o,l)=>{this._trigger(this._replyEventName(l),o)}),this.presence=new nt(this),this.broadcastEndpointURL=Pr(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((n=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||n===void 0)&&n.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,r=this.timeout){var a,i,n;if(this.socket.isConnected()||this.socket.connect(),this.state==ee.closed){const{config:{broadcast:o,presence:l,private:c}}=this.params,h=(i=(a=this.bindings.postgres_changes)===null||a===void 0?void 0:a.map(p=>p.filter))!==null&&i!==void 0?i:[],d=!!this.bindings[it.PRESENCE]&&this.bindings[it.PRESENCE].length>0||((n=this.params.config.presence)===null||n===void 0?void 0:n.enabled)===!0,f={},g={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:d}),postgres_changes:h,private:c};this.socket.accessTokenValue&&(f.access_token=this.socket.accessTokenValue),this._onError(p=>e==null?void 0:e(Ne.CHANNEL_ERROR,p)),this._onClose(()=>e==null?void 0:e(Ne.CLOSED)),this.updateJoinPayload(Object.assign({config:g},f)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:p})=>{var u;if(this.socket._isManualToken()||this.socket.setAuth(),p===void 0){e==null||e(Ne.SUBSCRIBED);return}else{const b=this.bindings.postgres_changes,m=(u=b==null?void 0:b.length)!==null&&u!==void 0?u:0,y=[];for(let x=0;x<m;x++){const w=b[x],{filter:{event:v,schema:k,table:S,filter:T}}=w,P=p&&p[x];if(P&&P.event===v&&Qe.isFilterValueEqual(P.schema,k)&&Qe.isFilterValueEqual(P.table,S)&&Qe.isFilterValueEqual(P.filter,T))y.push(Object.assign(Object.assign({},w),{id:P.id}));else{this.unsubscribe(),this.state=ee.errored,e==null||e(Ne.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(Ne.SUBSCRIBED);return}}).receive("error",p=>{this.state=ee.errored,e==null||e(Ne.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Ne.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,a){return this.state===ee.joined&&e===it.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,r,a)}async httpSend(e,r,a={}){var i;if(r==null)return Promise.reject("Payload is required for httpSend()");const n={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(n.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:n,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:r,private:this.private}]})},l=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(i=a.timeout)!==null&&i!==void 0?i:this.timeout);if(l.status===202)return{success:!0};let c=l.statusText;try{const h=await l.json();c=h.error||h.message||c}catch{}return Promise.reject(new Error(c))}async send(e,r={}){var a,i;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:n,payload:o}=e,l={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(l.Authorization=`Bearer ${this.socket.accessTokenValue}`);const c={method:"POST",headers:l,body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:o,private:this.private}]})};try{const h=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(a=r.timeout)!==null&&a!==void 0?a:this.timeout);return await((i=h.body)===null||i===void 0?void 0:i.cancel()),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var o,l,c;const h=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&n("ok"),h.receive("ok",()=>n("ok")),h.receive("error",()=>n("error")),h.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=ee.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(we.close,"leave",this._joinRef())};this.joinPush.destroy();let a=null;return new Promise(i=>{a=new Vt(this,we.leave,{},e),a.receive("ok",()=>{r(),i("ok")}).receive("timeout",()=>{r(),i("timed out")}).receive("error",()=>{i("error")}),a.send(),this._canPush()||a.trigger("ok",{})}).finally(()=>{a==null||a.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=ee.closed,this.bindings={}}async _fetchWithTimeout(e,r,a){const i=new AbortController,n=setTimeout(()=>i.abort(),a),o=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:i.signal}));return clearTimeout(n),o}_push(e,r,a=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Vt(this,e,r,a);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>pn){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(e,r,a){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,a){var i,n;const o=e.toLocaleLowerCase(),{close:l,error:c,leave:h,join:d}=we;if(a&&[l,c,h,d].indexOf(o)>=0&&a!==this._joinRef())return;let g=this._onMessage(o,r,a);if(r&&!g)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(p=>{var u,b,m;return((u=p.filter)===null||u===void 0?void 0:u.event)==="*"||((m=(b=p.filter)===null||b===void 0?void 0:b.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===o}).map(p=>p.callback(g,a)):(n=this.bindings[o])===null||n===void 0||n.filter(p=>{var u,b,m,y,x,w;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const v=p.id,k=(u=p.filter)===null||u===void 0?void 0:u.event;return v&&((b=r.ids)===null||b===void 0?void 0:b.includes(v))&&(k==="*"||(k==null?void 0:k.toLocaleLowerCase())===((m=r.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{const v=(x=(y=p==null?void 0:p.filter)===null||y===void 0?void 0:y.event)===null||x===void 0?void 0:x.toLocaleLowerCase();return v==="*"||v===((w=r==null?void 0:r.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof g=="object"&&"ids"in g){const u=g.data,{schema:b,table:m,commit_timestamp:y,type:x,errors:w}=u;g=Object.assign(Object.assign({},{schema:b,table:m,commit_timestamp:y,eventType:x,new:{},old:{},errors:w}),this._getPayloadRecords(u))}p.callback(g,a)})}_isClosed(){return this.state===ee.closed}_isJoined(){return this.state===ee.joined}_isJoining(){return this.state===ee.joining}_isLeaving(){return this.state===ee.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,a){const i=e.toLocaleLowerCase(),n={type:i,filter:r,callback:a};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}_off(e,r){const a=e.toLocaleLowerCase();return this.bindings[a]&&(this.bindings[a]=this.bindings[a].filter(i=>{var n;return!(((n=i.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===a&&Qe.isEqual(i.filter,r))})),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const a in e)if(e[a]!==r[a])return!1;return!0}static isFilterValueEqual(e,r){return(e??void 0)===(r??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(we.close,{},e)}_onError(e){this._on(we.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ee.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=Hs(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=Hs(e.columns,e.old_record)),r}}const Gt=()=>{},yt={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},wn=[1e3,2e3,5e3,1e4],jn=1e4,Nn=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class _n{constructor(e,r){var a;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ls,this.transport=null,this.heartbeatIntervalMs=yt.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Gt,this.ref=0,this.reconnectTimer=null,this.vsn=qs,this.logger=Gt,this.conn=null,this.sendBuffer=[],this.serializer=new gn,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=i=>i?(...n)=>i(...n):(...n)=>fetch(...n),!(!((a=r==null?void 0:r.params)===null||a===void 0)&&a.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${e}/${cs.websocket}`,this.httpEndpoint=Pr(e),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=ln.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const r=e.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const a=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(a),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return r==="ok"&&this._remove(e),this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,a){this.logger(e,r,a)}connectionState(){switch(this.conn&&this.conn.readyState){case Te.connecting:return $e.Connecting;case Te.open:return $e.Open;case Te.closing:return $e.Closing;default:return $e.Closed}}isConnected(){return this.connectionState()===$e.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,r={config:{}}){const a=`realtime:${e}`,i=this.getChannels().find(n=>n.topic===a);if(i)return i;{const n=new Qe(`realtime:${e}`,r,this);return this.channels.push(n),n}}push(e){const{topic:r,event:a,payload:i,ref:n}=e,o=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${r} ${a} (${n})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(hn,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},yt.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(a=>a.topic===e&&(a._isJoined()||a._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply"&&r.ref&&r.ref===this.pendingHeartbeatRef){const h=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error",h)}catch(d){this.log("error","error in heartbeat callback",d)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:a,event:i,payload:n,ref:o}=r,l=o?`(${o})`:"",c=n.status||"";this.log("receive",`${c} ${a} ${i} ${l}`.trim(),n),this.channels.filter(h=>h._isMember(a)).forEach(h=>h._trigger(i,n,o)),this._triggerStateCallbacks("message",r)})}_clearTimer(e){var r;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===Te.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Te.open||this.conn.readyState===Te.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this._terminateWorker()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var r;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(r){this.log("error","error in heartbeat callback",r)}}_triggerChanError(){this.channels.forEach(e=>e._trigger(we.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const a=e.match(/\?/)?"&":"?",i=new URLSearchParams(r);return`${e}${a}${i}`}_workerObjectUrl(e){let r;if(e)r=e;else{const a=new Blob([Nn],{type:"application/javascript"});r=URL.createObjectURL(a)}return r}_setConnectionState(e,r=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(e=null){let r,a=!1;if(e)r=e,a=!0;else if(this.accessToken)try{r=await this.accessToken()}catch(i){this.log("error","Error fetching access token from callback",i),r=this.accessTokenValue}else r=this.accessTokenValue;a?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(i=>{const n={access_token:r,version:dn};r&&i.updateJoinPayload(n),i.joinedOnce&&i._isJoined()&&i._push(we.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(r=>{this.log("error",`Error setting auth in ${e}`,r)})}_triggerStateCallbacks(e,r){try{this.stateChangeCallbacks[e].forEach(a=>{try{a(r)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(a){this.log("error",`error triggering ${e} callbacks`,a)}}_setupReconnectionTimer(){this.reconnectTimer=new Ar(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},yt.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var r,a,i,n,o,l,c,h,d,f,g,p;switch(this.transport=(r=e==null?void 0:e.transport)!==null&&r!==void 0?r:null,this.timeout=(a=e==null?void 0:e.timeout)!==null&&a!==void 0?a:ls,this.heartbeatIntervalMs=(i=e==null?void 0:e.heartbeatIntervalMs)!==null&&i!==void 0?i:yt.HEARTBEAT_INTERVAL,this.worker=(n=e==null?void 0:e.worker)!==null&&n!==void 0?n:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=e==null?void 0:e.heartbeatCallback)!==null&&l!==void 0?l:Gt,this.vsn=(c=e==null?void 0:e.vsn)!==null&&c!==void 0?c:qs,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e==null?void 0:e.reconnectAfterMs)!==null&&h!==void 0?h:(u=>wn[u-1]||jn),this.vsn){case un:this.encode=(d=e==null?void 0:e.encode)!==null&&d!==void 0?d:((u,b)=>b(JSON.stringify(u))),this.decode=(f=e==null?void 0:e.decode)!==null&&f!==void 0?f:((u,b)=>b(JSON.parse(u)));break;case Er:this.encode=(g=e==null?void 0:e.encode)!==null&&g!==void 0?g:this.serializer.encode.bind(this.serializer),this.decode=(p=e==null?void 0:e.decode)!==null&&p!==void 0?p:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var lt=class extends Error{constructor(s,e){var r;super(s),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((r=e.icebergType)==null?void 0:r.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Sn(s,e,r){const a=new URL(e,s);if(r)for(const[i,n]of Object.entries(r))n!==void 0&&a.searchParams.set(i,n);return a.toString()}async function kn(s){return!s||s.type==="none"?{}:s.type==="bearer"?{Authorization:`Bearer ${s.token}`}:s.type==="header"?{[s.name]:s.value}:s.type==="custom"?await s.getHeaders():{}}function Cn(s){const e=s.fetchImpl??globalThis.fetch;return{async request({method:r,path:a,query:i,body:n,headers:o}){const l=Sn(s.baseUrl,a,i),c=await kn(s.auth),h=await e(l,{method:r,headers:{...n?{"Content-Type":"application/json"}:{},...c,...o},body:n?JSON.stringify(n):void 0}),d=await h.text(),f=(h.headers.get("content-type")||"").includes("application/json"),g=f&&d?JSON.parse(d):d;if(!h.ok){const p=f?g:void 0,u=p==null?void 0:p.error;throw new lt((u==null?void 0:u.message)??`Request failed with status ${h.status}`,{status:h.status,icebergType:u==null?void 0:u.type,icebergCode:u==null?void 0:u.code,details:p})}return{status:h.status,headers:h.headers,data:g}}}}function vt(s){return s.join("")}var En=class{constructor(s,e=""){this.client=s,this.prefix=e}async listNamespaces(s){const e=s?{parent:vt(s.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(a=>({namespace:a}))}async createNamespace(s,e){const r={namespace:s.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(s){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${vt(s.namespace)}`})}async loadNamespaceMetadata(s){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${vt(s.namespace)}`})).data.properties}}async namespaceExists(s){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${vt(s.namespace)}`}),!0}catch(e){if(e instanceof lt&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(s,e){try{return await this.createNamespace(s,e)}catch(r){if(r instanceof lt&&r.status===409)return;throw r}}};function ze(s){return s.join("")}var An=class{constructor(s,e="",r){this.client=s,this.prefix=e,this.accessDelegation=r}async listTables(s){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ze(s.namespace)}/tables`})).data.identifiers}async createTable(s,e){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ze(s.namespace)}/tables`,body:e,headers:r})).data.metadata}async updateTable(s,e){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ze(s.namespace)}/tables/${s.name}`,body:e});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(s,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${ze(s.namespace)}/tables/${s.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(s){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ze(s.namespace)}/tables/${s.name}`,headers:e})).data.metadata}async tableExists(s){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${ze(s.namespace)}/tables/${s.name}`,headers:e}),!0}catch(r){if(r instanceof lt&&r.status===404)return!1;throw r}}async createTableIfNotExists(s,e){try{return await this.createTable(s,e)}catch(r){if(r instanceof lt&&r.status===409)return await this.loadTable({namespace:s.namespace,name:e.name});throw r}}},Tn=class{constructor(s){var a;let e="v1";s.catalogName&&(e+=`/${s.catalogName}`);const r=s.baseUrl.endsWith("/")?s.baseUrl:`${s.baseUrl}/`;this.client=Cn({baseUrl:r,auth:s.auth,fetchImpl:s.fetch}),this.accessDelegation=(a=s.accessDelegation)==null?void 0:a.join(","),this.namespaceOps=new En(this.client,e),this.tableOps=new An(this.client,e,this.accessDelegation)}async listNamespaces(s){return this.namespaceOps.listNamespaces(s)}async createNamespace(s,e){return this.namespaceOps.createNamespace(s,e)}async dropNamespace(s){await this.namespaceOps.dropNamespace(s)}async loadNamespaceMetadata(s){return this.namespaceOps.loadNamespaceMetadata(s)}async listTables(s){return this.tableOps.listTables(s)}async createTable(s,e){return this.tableOps.createTable(s,e)}async updateTable(s,e){return this.tableOps.updateTable(s,e)}async dropTable(s,e){await this.tableOps.dropTable(s,e)}async loadTable(s){return this.tableOps.loadTable(s)}async namespaceExists(s){return this.namespaceOps.namespaceExists(s)}async tableExists(s){return this.tableOps.tableExists(s)}async createNamespaceIfNotExists(s,e){return this.namespaceOps.createNamespaceIfNotExists(s,e)}async createTableIfNotExists(s,e){return this.tableOps.createTableIfNotExists(s,e)}},Ft=class extends Error{constructor(s,e="storage",r,a){super(s),this.__isStorageError=!0,this.namespace=e,this.name=e==="vectors"?"StorageVectorsError":"StorageError",this.status=r,this.statusCode=a}};function zt(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}var wt=class extends Ft{constructor(s,e,r,a="storage"){super(s,a,e,r),this.name=a==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=e,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Rr=class extends Ft{constructor(s,e,r="storage"){super(s,r),this.name=r==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=e}};const Pn=s=>s?(...e)=>s(...e):(...e)=>fetch(...e),Rn=s=>{if(typeof s!="object"||s===null)return!1;const e=Object.getPrototypeOf(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},us=s=>{if(Array.isArray(s))return s.map(r=>us(r));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([r,a])=>{const i=r.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace(/[-_]/g,""));e[i]=us(a)}),e},In=s=>!s||typeof s!="string"||s.length===0||s.length>100||s.trim()!==s||s.includes("/")||s.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(s);function ct(s){"@babel/helpers - typeof";return ct=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ct(s)}function On(s,e){if(ct(s)!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var a=r.call(s,e);if(ct(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function Ln(s){var e=On(s,"string");return ct(e)=="symbol"?e:e+""}function Dn(s,e,r){return(e=Ln(e))in s?Object.defineProperty(s,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[e]=r,s}function Vs(s,e){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);e&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable})),r.push.apply(r,a)}return r}function R(s){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Vs(Object(r),!0).forEach(function(a){Dn(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Vs(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}const Gs=s=>{var e;return s.msg||s.message||s.error_description||(typeof s.error=="string"?s.error:(e=s.error)===null||e===void 0?void 0:e.message)||JSON.stringify(s)},Un=async(s,e,r,a)=>{if(s&&typeof s=="object"&&"status"in s&&"ok"in s&&typeof s.status=="number"&&!(r!=null&&r.noResolveJson)){const i=s,n=i.status||500;if(typeof i.json=="function")i.json().then(o=>{const l=(o==null?void 0:o.statusCode)||(o==null?void 0:o.code)||n+"";e(new wt(Gs(o),n,l,a))}).catch(()=>{if(a==="vectors"){const o=n+"";e(new wt(i.statusText||`HTTP ${n} error`,n,o,a))}else{const o=n+"";e(new wt(i.statusText||`HTTP ${n} error`,n,o,a))}});else{const o=n+"";e(new wt(i.statusText||`HTTP ${n} error`,n,o,a))}}else e(new Rr(Gs(s),s,a))},$n=(s,e,r,a)=>{const i={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"||s==="HEAD"||!a?R(R({},i),r):(Rn(a)?(i.headers=R({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(a)):i.body=a,e!=null&&e.duplex&&(i.duplex=e.duplex),R(R({},i),r))};async function rt(s,e,r,a,i,n,o){return new Promise((l,c)=>{s(r,$n(e,a,i,n)).then(h=>{if(!h.ok)throw h;if(a!=null&&a.noResolveJson)return h;if(o==="vectors"){const d=h.headers.get("content-type");if(h.headers.get("content-length")==="0"||h.status===204)return{};if(!d||!d.includes("application/json"))return{}}return h.json()}).then(h=>l(h)).catch(h=>Un(h,c,a,o))})}function Ir(s="storage"){return{get:async(e,r,a,i)=>rt(e,"GET",r,a,i,void 0,s),post:async(e,r,a,i,n)=>rt(e,"POST",r,i,n,a,s),put:async(e,r,a,i,n)=>rt(e,"PUT",r,i,n,a,s),head:async(e,r,a,i)=>rt(e,"HEAD",r,R(R({},a),{},{noResolveJson:!0}),i,void 0,s),remove:async(e,r,a,i,n)=>rt(e,"DELETE",r,i,n,a,s)}}const Mn=Ir("storage"),{get:dt,post:ve,put:hs,head:Bn,remove:Ns}=Mn,pe=Ir("vectors");var et=class{constructor(s,e={},r,a="storage"){this.shouldThrowOnError=!1,this.url=s,this.headers=e,this.fetch=Pn(r),this.namespace=a}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(s){var e=this;try{return{data:await s(),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(zt(r))return{data:null,error:r};throw r}}},Fn=class{constructor(s,e){this.downloadFn=s,this.shouldThrowOnError=e}then(s,e){return this.execute().then(s,e)}async execute(){var s=this;try{return{data:(await s.downloadFn()).body,error:null}}catch(e){if(s.shouldThrowOnError)throw e;if(zt(e))return{data:null,error:e};throw e}}};let Or;Or=Symbol.toStringTag;var zn=class{constructor(s,e){this.downloadFn=s,this.shouldThrowOnError=e,this[Or]="BlobDownloadBuilder",this.promise=null}asStream(){return new Fn(this.downloadFn,this.shouldThrowOnError)}then(s,e){return this.getPromise().then(s,e)}catch(s){return this.getPromise().catch(s)}finally(s){return this.getPromise().finally(s)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var s=this;try{return{data:await(await s.downloadFn()).blob(),error:null}}catch(e){if(s.shouldThrowOnError)throw e;if(zt(e))return{data:null,error:e};throw e}}};const qn={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Js={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var Hn=class extends et{constructor(s,e={},r,a){super(s,e,a,"storage"),this.bucketId=r}async uploadOrUpdate(s,e,r,a){var i=this;return i.handleOperation(async()=>{let n;const o=R(R({},Js),a);let l=R(R({},i.headers),s==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&r instanceof Blob?(n=new FormData,n.append("cacheControl",o.cacheControl),c&&n.append("metadata",i.encodeMetadata(c)),n.append("",r)):typeof FormData<"u"&&r instanceof FormData?(n=r,n.has("cacheControl")||n.append("cacheControl",o.cacheControl),c&&!n.has("metadata")&&n.append("metadata",i.encodeMetadata(c))):(n=r,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=i.toBase64(i.encodeMetadata(c))),(typeof ReadableStream<"u"&&n instanceof ReadableStream||n&&typeof n=="object"&&"pipe"in n&&typeof n.pipe=="function")&&!o.duplex&&(o.duplex="half")),a!=null&&a.headers&&(l=R(R({},l),a.headers));const h=i._removeEmptyFolders(e),d=i._getFinalPath(h),f=await(s=="PUT"?hs:ve)(i.fetch,`${i.url}/object/${d}`,n,R({headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{path:h,id:f.Id,fullPath:f.Key}})}async upload(s,e,r){return this.uploadOrUpdate("POST",s,e,r)}async uploadToSignedUrl(s,e,r,a){var i=this;const n=i._removeEmptyFolders(s),o=i._getFinalPath(n),l=new URL(i.url+`/object/upload/sign/${o}`);return l.searchParams.set("token",e),i.handleOperation(async()=>{let c;const h=R({upsert:Js.upsert},a),d=R(R({},i.headers),{"x-upsert":String(h.upsert)});return typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",h.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",h.cacheControl)):(c=r,d["cache-control"]=`max-age=${h.cacheControl}`,d["content-type"]=h.contentType),{path:n,fullPath:(await hs(i.fetch,l.toString(),c,{headers:d})).Key}})}async createSignedUploadUrl(s,e){var r=this;return r.handleOperation(async()=>{let a=r._getFinalPath(s);const i=R({},r.headers);e!=null&&e.upsert&&(i["x-upsert"]="true");const n=await ve(r.fetch,`${r.url}/object/upload/sign/${a}`,{},{headers:i}),o=new URL(r.url+n.url),l=o.searchParams.get("token");if(!l)throw new Ft("No token returned by API");return{signedUrl:o.toString(),path:s,token:l}})}async update(s,e,r){return this.uploadOrUpdate("PUT",s,e,r)}async move(s,e,r){var a=this;return a.handleOperation(async()=>await ve(a.fetch,`${a.url}/object/move`,{bucketId:a.bucketId,sourceKey:s,destinationKey:e,destinationBucket:r==null?void 0:r.destinationBucket},{headers:a.headers}))}async copy(s,e,r){var a=this;return a.handleOperation(async()=>({path:(await ve(a.fetch,`${a.url}/object/copy`,{bucketId:a.bucketId,sourceKey:s,destinationKey:e,destinationBucket:r==null?void 0:r.destinationBucket},{headers:a.headers})).Key}))}async createSignedUrl(s,e,r){var a=this;return a.handleOperation(async()=>{let i=a._getFinalPath(s),n=await ve(a.fetch,`${a.url}/object/sign/${i}`,R({expiresIn:e},r!=null&&r.transform?{transform:r.transform}:{}),{headers:a.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{signedUrl:encodeURI(`${a.url}${n.signedURL}${o}`)}})}async createSignedUrls(s,e,r){var a=this;return a.handleOperation(async()=>{const i=await ve(a.fetch,`${a.url}/object/sign/${a.bucketId}`,{expiresIn:e,paths:s},{headers:a.headers}),n=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i.map(o=>R(R({},o),{},{signedUrl:o.signedURL?encodeURI(`${a.url}${o.signedURL}${n}`):null}))})}download(s,e,r){const a=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),n=i?`?${i}`:"",o=this._getFinalPath(s),l=()=>dt(this.fetch,`${this.url}/${a}/${o}${n}`,{headers:this.headers,noResolveJson:!0},r);return new zn(l,this.shouldThrowOnError)}async info(s){var e=this;const r=e._getFinalPath(s);return e.handleOperation(async()=>us(await dt(e.fetch,`${e.url}/object/info/${r}`,{headers:e.headers})))}async exists(s){var e=this;const r=e._getFinalPath(s);try{return await Bn(e.fetch,`${e.url}/object/${r}`,{headers:e.headers}),{data:!0,error:null}}catch(a){if(e.shouldThrowOnError)throw a;if(zt(a)&&a instanceof Rr){const i=a.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:a}}throw a}}getPublicUrl(s,e){const r=this._getFinalPath(s),a=[],i=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";i!==""&&a.push(i);const n=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});o!==""&&a.push(o);let l=a.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${r}${l}`)}}}async remove(s){var e=this;return e.handleOperation(async()=>await Ns(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:s},{headers:e.headers}))}async list(s,e,r){var a=this;return a.handleOperation(async()=>{const i=R(R(R({},qn),e),{},{prefix:s||""});return await ve(a.fetch,`${a.url}/object/list/${a.bucketId}`,i,{headers:a.headers},r)})}async listV2(s,e){var r=this;return r.handleOperation(async()=>{const a=R({},s);return await ve(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,a,{headers:r.headers},e)})}encodeMetadata(s){return JSON.stringify(s)}toBase64(s){return typeof Buffer<"u"?Buffer.from(s).toString("base64"):btoa(s)}_getFinalPath(s){return`${this.bucketId}/${s.replace(/^\/+/,"")}`}_removeEmptyFolders(s){return s.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(s){const e=[];return s.width&&e.push(`width=${s.width}`),s.height&&e.push(`height=${s.height}`),s.resize&&e.push(`resize=${s.resize}`),s.format&&e.push(`format=${s.format}`),s.quality&&e.push(`quality=${s.quality}`),e.join("&")}};const Wn="2.95.0",mt={"X-Client-Info":`storage-js/${Wn}`};var Kn=class extends et{constructor(s,e={},r,a){const i=new URL(s);a!=null&&a.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase."));const n=i.href.replace(/\/$/,""),o=R(R({},mt),e);super(n,o,r,"storage")}async listBuckets(s){var e=this;return e.handleOperation(async()=>{const r=e.listBucketOptionsToQueryString(s);return await dt(e.fetch,`${e.url}/bucket${r}`,{headers:e.headers})})}async getBucket(s){var e=this;return e.handleOperation(async()=>await dt(e.fetch,`${e.url}/bucket/${s}`,{headers:e.headers}))}async createBucket(s,e={public:!1}){var r=this;return r.handleOperation(async()=>await ve(r.fetch,`${r.url}/bucket`,{id:s,name:s,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}))}async updateBucket(s,e){var r=this;return r.handleOperation(async()=>await hs(r.fetch,`${r.url}/bucket/${s}`,{id:s,name:s,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}))}async emptyBucket(s){var e=this;return e.handleOperation(async()=>await ve(e.fetch,`${e.url}/bucket/${s}/empty`,{},{headers:e.headers}))}async deleteBucket(s){var e=this;return e.handleOperation(async()=>await Ns(e.fetch,`${e.url}/bucket/${s}`,{},{headers:e.headers}))}listBucketOptionsToQueryString(s){const e={};return s&&("limit"in s&&(e.limit=String(s.limit)),"offset"in s&&(e.offset=String(s.offset)),s.search&&(e.search=s.search),s.sortColumn&&(e.sortColumn=s.sortColumn),s.sortOrder&&(e.sortOrder=s.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},Vn=class extends et{constructor(s,e={},r){const a=s.replace(/\/$/,""),i=R(R({},mt),e);super(a,i,r,"storage")}async createBucket(s){var e=this;return e.handleOperation(async()=>await ve(e.fetch,`${e.url}/bucket`,{name:s},{headers:e.headers}))}async listBuckets(s){var e=this;return e.handleOperation(async()=>{const r=new URLSearchParams;(s==null?void 0:s.limit)!==void 0&&r.set("limit",s.limit.toString()),(s==null?void 0:s.offset)!==void 0&&r.set("offset",s.offset.toString()),s!=null&&s.sortColumn&&r.set("sortColumn",s.sortColumn),s!=null&&s.sortOrder&&r.set("sortOrder",s.sortOrder),s!=null&&s.search&&r.set("search",s.search);const a=r.toString(),i=a?`${e.url}/bucket?${a}`:`${e.url}/bucket`;return await dt(e.fetch,i,{headers:e.headers})})}async deleteBucket(s){var e=this;return e.handleOperation(async()=>await Ns(e.fetch,`${e.url}/bucket/${s}`,{},{headers:e.headers}))}from(s){var e=this;if(!In(s))throw new Ft("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new Tn({baseUrl:this.url,catalogName:s,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),a=this.shouldThrowOnError;return new Proxy(r,{get(i,n){const o=i[n];return typeof o!="function"?o:async(...l)=>{try{return{data:await o.apply(i,l),error:null}}catch(c){if(a)throw c;return{data:null,error:c}}}}})}},Gn=class extends et{constructor(s,e={},r){const a=s.replace(/\/$/,""),i=R(R({},mt),{},{"Content-Type":"application/json"},e);super(a,i,r,"vectors")}async createIndex(s){var e=this;return e.handleOperation(async()=>await pe.post(e.fetch,`${e.url}/CreateIndex`,s,{headers:e.headers})||{})}async getIndex(s,e){var r=this;return r.handleOperation(async()=>await pe.post(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:s,indexName:e},{headers:r.headers}))}async listIndexes(s){var e=this;return e.handleOperation(async()=>await pe.post(e.fetch,`${e.url}/ListIndexes`,s,{headers:e.headers}))}async deleteIndex(s,e){var r=this;return r.handleOperation(async()=>await pe.post(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:s,indexName:e},{headers:r.headers})||{})}},Jn=class extends et{constructor(s,e={},r){const a=s.replace(/\/$/,""),i=R(R({},mt),{},{"Content-Type":"application/json"},e);super(a,i,r,"vectors")}async putVectors(s){var e=this;if(s.vectors.length<1||s.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return e.handleOperation(async()=>await pe.post(e.fetch,`${e.url}/PutVectors`,s,{headers:e.headers})||{})}async getVectors(s){var e=this;return e.handleOperation(async()=>await pe.post(e.fetch,`${e.url}/GetVectors`,s,{headers:e.headers}))}async listVectors(s){var e=this;if(s.segmentCount!==void 0){if(s.segmentCount<1||s.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(s.segmentIndex!==void 0&&(s.segmentIndex<0||s.segmentIndex>=s.segmentCount))throw new Error(`segmentIndex must be between 0 and ${s.segmentCount-1}`)}return e.handleOperation(async()=>await pe.post(e.fetch,`${e.url}/ListVectors`,s,{headers:e.headers}))}async queryVectors(s){var e=this;return e.handleOperation(async()=>await pe.post(e.fetch,`${e.url}/QueryVectors`,s,{headers:e.headers}))}async deleteVectors(s){var e=this;if(s.keys.length<1||s.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return e.handleOperation(async()=>await pe.post(e.fetch,`${e.url}/DeleteVectors`,s,{headers:e.headers})||{})}},Yn=class extends et{constructor(s,e={},r){const a=s.replace(/\/$/,""),i=R(R({},mt),{},{"Content-Type":"application/json"},e);super(a,i,r,"vectors")}async createBucket(s){var e=this;return e.handleOperation(async()=>await pe.post(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:s},{headers:e.headers})||{})}async getBucket(s){var e=this;return e.handleOperation(async()=>await pe.post(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:s},{headers:e.headers}))}async listBuckets(s={}){var e=this;return e.handleOperation(async()=>await pe.post(e.fetch,`${e.url}/ListVectorBuckets`,s,{headers:e.headers}))}async deleteBucket(s){var e=this;return e.handleOperation(async()=>await pe.post(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:s},{headers:e.headers})||{})}},Qn=class extends Yn{constructor(s,e={}){super(s,e.headers||{},e.fetch)}from(s){return new Xn(this.url,this.headers,s,this.fetch)}async createBucket(s){var e=()=>super.createBucket,r=this;return e().call(r,s)}async getBucket(s){var e=()=>super.getBucket,r=this;return e().call(r,s)}async listBuckets(s={}){var e=()=>super.listBuckets,r=this;return e().call(r,s)}async deleteBucket(s){var e=()=>super.deleteBucket,r=this;return e().call(r,s)}},Xn=class extends Gn{constructor(s,e,r,a){super(s,e,a),this.vectorBucketName=r}async createIndex(s){var e=()=>super.createIndex,r=this;return e().call(r,R(R({},s),{},{vectorBucketName:r.vectorBucketName}))}async listIndexes(s={}){var e=()=>super.listIndexes,r=this;return e().call(r,R(R({},s),{},{vectorBucketName:r.vectorBucketName}))}async getIndex(s){var e=()=>super.getIndex,r=this;return e().call(r,r.vectorBucketName,s)}async deleteIndex(s){var e=()=>super.deleteIndex,r=this;return e().call(r,r.vectorBucketName,s)}index(s){return new Zn(this.url,this.headers,this.vectorBucketName,s,this.fetch)}},Zn=class extends Jn{constructor(s,e,r,a,i){super(s,e,i),this.vectorBucketName=r,this.indexName=a}async putVectors(s){var e=()=>super.putVectors,r=this;return e().call(r,R(R({},s),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async getVectors(s){var e=()=>super.getVectors,r=this;return e().call(r,R(R({},s),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async listVectors(s={}){var e=()=>super.listVectors,r=this;return e().call(r,R(R({},s),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async queryVectors(s){var e=()=>super.queryVectors,r=this;return e().call(r,R(R({},s),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async deleteVectors(s){var e=()=>super.deleteVectors,r=this;return e().call(r,R(R({},s),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}},ei=class extends Kn{constructor(s,e={},r,a){super(s,e,r,a)}from(s){return new Hn(this.url,this.headers,s,this.fetch)}get vectors(){return new Qn(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Vn(this.url+"/iceberg",this.headers,this.fetch)}};const Lr="2.95.0",Je=30*1e3,ps=3,Jt=ps*Je,ti="http://localhost:9999",si="supabase.auth.token",ri={"X-Client-Info":`gotrue-js/${Lr}`},gs="X-Supabase-Api-Version",Dr={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},ai=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,ni=600*1e3;class ut extends Error{constructor(e,r,a){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=a}}function E(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class ii extends ut{constructor(e,r,a){super(e,r,a),this.name="AuthApiError",this.status=r,this.code=a}}function oi(s){return E(s)&&s.name==="AuthApiError"}class Me extends ut{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class Se extends ut{constructor(e,r,a,i){super(e,a,i),this.name=r,this.status=a}}class he extends Se{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Yt(s){return E(s)&&s.name==="AuthSessionMissingError"}class qe extends Se{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class jt extends Se{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Nt extends Se{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function li(s){return E(s)&&s.name==="AuthImplicitGrantRedirectError"}class Ys extends Se{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ci extends Se{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class ms extends Se{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function Qt(s){return E(s)&&s.name==="AuthRetryableFetchError"}class Qs extends Se{constructor(e,r,a){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=a}}class fs extends Se{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const It="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Xs=` 	
\r=`.split(""),di=(()=>{const s=new Array(128);for(let e=0;e<s.length;e+=1)s[e]=-1;for(let e=0;e<Xs.length;e+=1)s[Xs[e].charCodeAt(0)]=-2;for(let e=0;e<It.length;e+=1)s[It[e].charCodeAt(0)]=e;return s})();function Zs(s,e,r){if(s!==null)for(e.queue=e.queue<<8|s,e.queuedBits+=8;e.queuedBits>=6;){const a=e.queue>>e.queuedBits-6&63;r(It[a]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const a=e.queue>>e.queuedBits-6&63;r(It[a]),e.queuedBits-=6}}function Ur(s,e,r){const a=di[s];if(a>-1)for(e.queue=e.queue<<6|a,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(a===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function er(s){const e=[],r=o=>{e.push(String.fromCodePoint(o))},a={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},n=o=>{pi(o,a,r)};for(let o=0;o<s.length;o+=1)Ur(s.charCodeAt(o),i,n);return e.join("")}function ui(s,e){if(s<=127){e(s);return}else if(s<=2047){e(192|s>>6),e(128|s&63);return}else if(s<=65535){e(224|s>>12),e(128|s>>6&63),e(128|s&63);return}else if(s<=1114111){e(240|s>>18),e(128|s>>12&63),e(128|s>>6&63),e(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function hi(s,e){for(let r=0;r<s.length;r+=1){let a=s.charCodeAt(r);if(a>55295&&a<=56319){const i=(a-55296)*1024&65535;a=(s.charCodeAt(r+1)-56320&65535|i)+65536,r+=1}ui(a,e)}}function pi(s,e,r){if(e.utf8seq===0){if(s<=127){r(s);return}for(let a=1;a<6;a+=1)if((s>>7-a&1)===0){e.utf8seq=a;break}if(e.utf8seq===2)e.codepoint=s&31;else if(e.utf8seq===3)e.codepoint=s&15;else if(e.utf8seq===4)e.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|s&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function Xe(s){const e=[],r={queue:0,queuedBits:0},a=i=>{e.push(i)};for(let i=0;i<s.length;i+=1)Ur(s.charCodeAt(i),r,a);return new Uint8Array(e)}function gi(s){const e=[];return hi(s,r=>e.push(r)),new Uint8Array(e)}function Be(s){const e=[],r={queue:0,queuedBits:0},a=i=>{e.push(i)};return s.forEach(i=>Zs(i,r,a)),Zs(null,r,a),e.join("")}function mi(s){return Math.round(Date.now()/1e3)+s}function fi(){return Symbol("auth-callback")}const re=()=>typeof window<"u"&&typeof document<"u",Ie={tested:!1,writable:!1},$r=()=>{if(!re())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ie.tested)return Ie.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),Ie.tested=!0,Ie.writable=!0}catch{Ie.tested=!0,Ie.writable=!1}return Ie.writable};function xi(s){const e={},r=new URL(s);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((i,n)=>{e[n]=i})}catch{}return r.searchParams.forEach((a,i)=>{e[i]=a}),e}const Mr=s=>s?(...e)=>s(...e):(...e)=>fetch(...e),bi=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",Ye=async(s,e,r)=>{await s.setItem(e,JSON.stringify(r))},Oe=async(s,e)=>{const r=await s.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},se=async(s,e)=>{await s.removeItem(e)};class qt{constructor(){this.promise=new qt.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}qt.promiseConstructor=Promise;function _t(s){const e=s.split(".");if(e.length!==3)throw new fs("Invalid JWT structure");for(let a=0;a<e.length;a++)if(!ai.test(e[a]))throw new fs("JWT not in base64url format");return{header:JSON.parse(er(e[0])),payload:JSON.parse(er(e[1])),signature:Xe(e[2]),raw:{header:e[0],payload:e[1]}}}async function yi(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function vi(s,e){return new Promise((a,i)=>{(async()=>{for(let n=0;n<1/0;n++)try{const o=await s(n);if(!e(n,null,o)){a(o);return}}catch(o){if(!e(n,o)){i(o);return}}})()})}function wi(s){return("0"+s.toString(16)).substr(-2)}function ji(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=r.length;let i="";for(let n=0;n<56;n++)i+=r.charAt(Math.floor(Math.random()*a));return i}return crypto.getRandomValues(e),Array.from(e,wi).join("")}async function Ni(s){const r=new TextEncoder().encode(s),a=await crypto.subtle.digest("SHA-256",r),i=new Uint8Array(a);return Array.from(i).map(n=>String.fromCharCode(n)).join("")}async function _i(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const r=await Ni(s);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function He(s,e,r=!1){const a=ji();let i=a;r&&(i+="/PASSWORD_RECOVERY"),await Ye(s,`${e}-code-verifier`,i);const n=await _i(a);return[n,a===n?"plain":"s256"]}const Si=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function ki(s){const e=s.headers.get(gs);if(!e||!e.match(Si))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Ci(s){if(!s)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(s<=e)throw new Error("JWT has expired")}function Ei(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Ai=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function We(s){if(!Ai.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Xt(){const s={};return new Proxy(s,{get:(e,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const a=r.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Ti(s,e){return new Proxy(s,{get:(r,a,i)=>{if(a==="__isInsecureUserWarningProxy")return!0;if(typeof a=="symbol"){const n=a.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)"||n==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,a,i)}return!e.value&&typeof a=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(r,a,i)}})}function tr(s){return JSON.parse(JSON.stringify(s))}const De=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),Pi=[502,503,504];async function sr(s){var e;if(!bi(s))throw new ms(De(s),0);if(Pi.includes(s.status))throw new ms(De(s),s.status);let r;try{r=await s.json()}catch(n){throw new Me(De(n),n)}let a;const i=ki(s);if(i&&i.getTime()>=Dr["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?a=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(a=r.error_code),a){if(a==="weak_password")throw new Qs(De(r),s.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(a==="session_not_found")throw new he}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((n,o)=>n&&typeof o=="string",!0))throw new Qs(De(r),s.status,r.weak_password.reasons);throw new ii(De(r),s.status||500,a)}const Ri=(s,e,r,a)=>{const i={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(a),Object.assign(Object.assign({},i),r))};async function A(s,e,r,a){var i;const n=Object.assign({},a==null?void 0:a.headers);n[gs]||(n[gs]=Dr["2024-01-01"].name),a!=null&&a.jwt&&(n.Authorization=`Bearer ${a.jwt}`);const o=(i=a==null?void 0:a.query)!==null&&i!==void 0?i:{};a!=null&&a.redirectTo&&(o.redirect_to=a.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await Ii(s,e,r+l,{headers:n,noResolveJson:a==null?void 0:a.noResolveJson},{},a==null?void 0:a.body);return a!=null&&a.xform?a==null?void 0:a.xform(c):{data:Object.assign({},c),error:null}}async function Ii(s,e,r,a,i,n){const o=Ri(e,a,i,n);let l;try{l=await s(r,Object.assign({},o))}catch(c){throw console.error(c),new ms(De(c),0)}if(l.ok||await sr(l),a!=null&&a.noResolveJson)return l;try{return await l.json()}catch(c){await sr(c)}}function ye(s){var e;let r=null;Di(s)&&(r=Object.assign({},s),s.expires_at||(r.expires_at=mi(s.expires_in)));const a=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:r,user:a},error:null}}function rr(s){const e=ye(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((r,a)=>r&&typeof a=="string",!0)&&(e.data.weak_password=s.weak_password),e}function Pe(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function Oi(s){return{data:s,error:null}}function Li(s){const{action_link:e,email_otp:r,hashed_token:a,redirect_to:i,verification_type:n}=s,o=Bt(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:r,hashed_token:a,redirect_to:i,verification_type:n},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function ar(s){return s}function Di(s){return s.access_token&&s.refresh_token&&s.expires_in}const Zt=["global","local","others"];class Ui{constructor({url:e="",headers:r={},fetch:a}){this.url=e,this.headers=r,this.fetch=Mr(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,r=Zt[0]){if(Zt.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Zt.join(", ")}`);try{return await A(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(a){if(E(a))return{data:null,error:a};throw a}}async inviteUserByEmail(e,r={}){try{return await A(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Pe})}catch(a){if(E(a))return{data:{user:null},error:a};throw a}}async generateLink(e){try{const{options:r}=e,a=Bt(e,["options"]),i=Object.assign(Object.assign({},a),r);return"newEmail"in a&&(i.new_email=a==null?void 0:a.newEmail,delete i.newEmail),await A(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Li,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(E(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await A(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Pe})}catch(r){if(E(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,a,i,n,o,l,c;try{const h={nextPage:null,lastPage:0,total:0},d=await A(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(r=e==null?void 0:e.page)===null||r===void 0?void 0:r.toString())!==null&&a!==void 0?a:"",per_page:(n=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:ar});if(d.error)throw d.error;const f=await d.json(),g=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=d.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(u=>{const b=parseInt(u.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(u.split(";")[1].split("=")[1]);h[`${m}Page`]=b}),h.total=parseInt(g)),{data:Object.assign(Object.assign({},f),h),error:null}}catch(h){if(E(h))return{data:{users:[]},error:h};throw h}}async getUserById(e){We(e);try{return await A(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Pe})}catch(r){if(E(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){We(e);try{return await A(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:Pe})}catch(a){if(E(a))return{data:{user:null},error:a};throw a}}async deleteUser(e,r=!1){We(e);try{return await A(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:Pe})}catch(a){if(E(a))return{data:{user:null},error:a};throw a}}async _listFactors(e){We(e.userId);try{const{data:r,error:a}=await A(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:r,error:a}}catch(r){if(E(r))return{data:null,error:r};throw r}}async _deleteFactor(e){We(e.userId),We(e.id);try{return{data:await A(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if(E(r))return{data:null,error:r};throw r}}async _listOAuthClients(e){var r,a,i,n,o,l,c;try{const h={nextPage:null,lastPage:0,total:0},d=await A(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(r=e==null?void 0:e.page)===null||r===void 0?void 0:r.toString())!==null&&a!==void 0?a:"",per_page:(n=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:ar});if(d.error)throw d.error;const f=await d.json(),g=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=d.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(u=>{const b=parseInt(u.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(u.split(";")[1].split("=")[1]);h[`${m}Page`]=b}),h.total=parseInt(g)),{data:Object.assign(Object.assign({},f),h),error:null}}catch(h){if(E(h))return{data:{clients:[]},error:h};throw h}}async _createOAuthClient(e){try{return await A(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(E(r))return{data:null,error:r};throw r}}async _getOAuthClient(e){try{return await A(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(E(r))return{data:null,error:r};throw r}}async _updateOAuthClient(e,r){try{return await A(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:r,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(E(a))return{data:null,error:a};throw a}}async _deleteOAuthClient(e){try{return await A(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(E(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(e){try{return await A(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(E(r))return{data:null,error:r};throw r}}}function nr(s={}){return{getItem:e=>s[e]||null,setItem:(e,r)=>{s[e]=r},removeItem:e=>{delete s[e]}}}const Ke={debug:!!(globalThis&&$r()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Br extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class $i extends Br{}async function Mi(s,e,r){Ke.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const a=new globalThis.AbortController;return e>0&&setTimeout(()=>{a.abort(),Ke.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async i=>{if(i){Ke.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,i.name);try{return await r()}finally{Ke.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,i.name)}}else{if(e===0)throw Ke.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new $i(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(Ke.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function Bi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Fr(s){if(!/^0x[a-fA-F0-9]{40}$/.test(s))throw new Error(`@supabase/auth-js: Address "${s}" is invalid.`);return s.toLowerCase()}function Fi(s){return parseInt(s,16)}function zi(s){const e=new TextEncoder().encode(s);return"0x"+Array.from(e,a=>a.toString(16).padStart(2,"0")).join("")}function qi(s){var e;const{chainId:r,domain:a,expirationTime:i,issuedAt:n=new Date,nonce:o,notBefore:l,requestId:c,resources:h,scheme:d,uri:f,version:g}=s;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!a)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!f)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(g!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${g}`);if(!((e=s.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${s.statement}`)}const p=Fr(s.address),u=d?`${d}://${a}`:a,b=s.statement?`${s.statement}
`:"",m=`${u} wants you to sign in with your Ethereum account:
${p}

${b}`;let y=`URI: ${f}
Version: ${g}
Chain ID: ${r}${o?`
Nonce: ${o}`:""}
Issued At: ${n.toISOString()}`;if(i&&(y+=`
Expiration Time: ${i.toISOString()}`),l&&(y+=`
Not Before: ${l.toISOString()}`),c&&(y+=`
Request ID: ${c}`),h){let x=`
Resources:`;for(const w of h){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);x+=`
- ${w}`}y+=x}return`${m}
${y}`}class Q extends Error{constructor({message:e,code:r,cause:a,name:i}){var n;super(e,{cause:a}),this.__isWebAuthnError=!0,this.name=(n=i??(a instanceof Error?a.name:void 0))!==null&&n!==void 0?n:"Unknown Error",this.code=r}}class Ot extends Q{constructor(e,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:e}),this.name="WebAuthnUnknownError",this.originalError=r}}function Hi({error:s,options:e}){var r,a,i;const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Q({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else if(s.name==="ConstraintError"){if(((r=n.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new Q({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:s});if(e.mediation==="conditional"&&((a=n.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new Q({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:s});if(((i=n.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new Q({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:s})}else{if(s.name==="InvalidStateError")return new Q({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:s});if(s.name==="NotAllowedError")return new Q({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="NotSupportedError")return n.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new Q({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:s}):new Q({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:s});if(s.name==="SecurityError"){const o=window.location.hostname;if(zr(o)){if(n.rp.id!==o)return new Q({message:`The RP ID "${n.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new Q({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="TypeError"){if(n.user.id.byteLength<1||n.user.id.byteLength>64)return new Q({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:s})}else if(s.name==="UnknownError")return new Q({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new Q({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}function Wi({error:s,options:e}){const{publicKey:r}=e;if(!r)throw Error("options was missing required publicKey property");if(s.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Q({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:s})}else{if(s.name==="NotAllowedError")return new Q({message:s.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s});if(s.name==="SecurityError"){const a=window.location.hostname;if(zr(a)){if(r.rpId!==a)return new Q({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:s})}else return new Q({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:s})}else if(s.name==="UnknownError")return new Q({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:s})}return new Q({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s})}class Ki{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const Vi=new Ki;function Gi(s){if(!s)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(s);const{challenge:e,user:r,excludeCredentials:a}=s,i=Bt(s,["challenge","user","excludeCredentials"]),n=Xe(e).buffer,o=Object.assign(Object.assign({},r),{id:Xe(r.id).buffer}),l=Object.assign(Object.assign({},i),{challenge:n,user:o});if(a&&a.length>0){l.excludeCredentials=new Array(a.length);for(let c=0;c<a.length;c++){const h=a[c];l.excludeCredentials[c]=Object.assign(Object.assign({},h),{id:Xe(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return l}function Ji(s){if(!s)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(s);const{challenge:e,allowCredentials:r}=s,a=Bt(s,["challenge","allowCredentials"]),i=Xe(e).buffer,n=Object.assign(Object.assign({},a),{challenge:i});if(r&&r.length>0){n.allowCredentials=new Array(r.length);for(let o=0;o<r.length;o++){const l=r[o];n.allowCredentials[o]=Object.assign(Object.assign({},l),{id:Xe(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return n}function Yi(s){var e;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const r=s;return{id:s.id,rawId:s.id,response:{attestationObject:Be(new Uint8Array(s.response.attestationObject)),clientDataJSON:Be(new Uint8Array(s.response.clientDataJSON))},type:"public-key",clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Qi(s){var e;if("toJSON"in s&&typeof s.toJSON=="function")return s.toJSON();const r=s,a=s.getClientExtensionResults(),i=s.response;return{id:s.id,rawId:s.id,response:{authenticatorData:Be(new Uint8Array(i.authenticatorData)),clientDataJSON:Be(new Uint8Array(i.clientDataJSON)),signature:Be(new Uint8Array(i.signature)),userHandle:i.userHandle?Be(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:a,authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function zr(s){return s==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(s)}function ir(){var s,e;return!!(re()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((s=navigator==null?void 0:navigator.credentials)===null||s===void 0?void 0:s.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function Xi(s){try{const e=await navigator.credentials.create(s);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Ot("Browser returned unexpected credential type",e)}:{data:null,error:new Ot("Empty credential response",e)}}catch(e){return{data:null,error:Hi({error:e,options:s})}}}async function Zi(s){try{const e=await navigator.credentials.get(s);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Ot("Browser returned unexpected credential type",e)}:{data:null,error:new Ot("Empty credential response",e)}}catch(e){return{data:null,error:Wi({error:e,options:s})}}}const eo={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},to={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Lt(...s){const e=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),r=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),a={};for(const i of s)if(i)for(const n in i){const o=i[n];if(o!==void 0)if(Array.isArray(o))a[n]=o;else if(r(o))a[n]=o;else if(e(o)){const l=a[n];e(l)?a[n]=Lt(l,o):a[n]=Lt(o)}else a[n]=o}return a}function so(s,e){return Lt(eo,s,e||{})}function ro(s,e){return Lt(to,s,e||{})}class ao{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:r,friendlyName:a,signal:i},n){var o;try{const{data:l,error:c}=await this.client.mfa.challenge({factorId:e,webauthn:r});if(!l)return{data:null,error:c};const h=i??Vi.createNewAbortSignal();if(l.webauthn.type==="create"){const{user:d}=l.webauthn.credential_options.publicKey;if(!d.name){const f=a;if(f)d.name=`${d.id}:${f}`;else{const p=(await this.client.getUser()).data.user,u=((o=p==null?void 0:p.user_metadata)===null||o===void 0?void 0:o.name)||(p==null?void 0:p.email)||(p==null?void 0:p.id)||"User";d.name=`${d.id}:${u}`}}d.displayName||(d.displayName=d.name)}switch(l.webauthn.type){case"create":{const d=so(l.webauthn.credential_options.publicKey,n==null?void 0:n.create),{data:f,error:g}=await Xi({publicKey:d,signal:h});return f?{data:{factorId:e,challengeId:l.id,webauthn:{type:l.webauthn.type,credential_response:f}},error:null}:{data:null,error:g}}case"request":{const d=ro(l.webauthn.credential_options.publicKey,n==null?void 0:n.request),{data:f,error:g}=await Zi(Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:d,signal:h}));return f?{data:{factorId:e,challengeId:l.id,webauthn:{type:l.webauthn.type,credential_response:f}},error:null}:{data:null,error:g}}}}catch(l){return E(l)?{data:null,error:l}:{data:null,error:new Me("Unexpected error in challenge",l)}}}async _verify({challengeId:e,factorId:r,webauthn:a}){return this.client.mfa.verify({factorId:r,challengeId:e,webauthn:a})}async _authenticate({factorId:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},n){if(!r)return{data:null,error:new ut("rpId is required for WebAuthn authentication")};try{if(!ir())return{data:null,error:new Me("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this.challenge({factorId:e,webauthn:{rpId:r,rpOrigins:a},signal:i},{request:n});if(!o)return{data:null,error:l};const{webauthn:c}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:c.type,rpId:r,rpOrigins:a,credential_response:c.credential_response}})}catch(o){return E(o)?{data:null,error:o}:{data:null,error:new Me("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},n){if(!r)return{data:null,error:new ut("rpId is required for WebAuthn registration")};try{if(!ir())return{data:null,error:new Me("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(d=>{var f;return(f=d.data)===null||f===void 0?void 0:f.all.find(g=>g.factor_type==="webauthn"&&g.friendly_name===e&&g.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d==null?void 0:d.id}):void 0),{data:null,error:l};const{data:c,error:h}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:r,rpOrigins:a},signal:i},{create:n});return c?this._verify({factorId:o.id,challengeId:c.challengeId,webauthn:{rpId:r,rpOrigins:a,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:h}}catch(o){return E(o)?{data:null,error:o}:{data:null,error:new Me("Unexpected error in register",o)}}}}Bi();const no={url:ti,storageKey:si,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ri,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function or(s,e,r){return await r()}const Ve={};class ht{get jwks(){var e,r;return(r=(e=Ve[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(e){Ve[this.storageKey]=Object.assign(Object.assign({},Ve[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,r;return(r=(e=Ve[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ve[this.storageKey]=Object.assign(Object.assign({},Ve[this.storageKey]),{cachedAt:e})}constructor(e){var r,a,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const n=Object.assign(Object.assign({},no),e);if(this.storageKey=n.storageKey,this.instanceID=(r=ht.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,ht.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.instanceID>0&&re()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=n.persistSession,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Ui({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Mr(n.fetch),this.lock=n.lock||or,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,this.throwOnError=n.throwOnError,this.lockAcquireTimeout=n.lockAcquireTimeout,n.lock?this.lock=n.lock:this.persistSession&&re()&&(!((a=globalThis==null?void 0:globalThis.navigator)===null||a===void 0)&&a.locks)?this.lock=Mi:this.lock=or,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new ao(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:$r()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=nr(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=nr(this.memoryStorage)),re()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o);try{await this._notifyAllSubscribers(o.data.event,o.data.session,!1)}catch(l){this._debug("#broadcastChannel","error",l)}})}this.initialize().catch(o=>{this._debug("#initialize()","error",o)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Lr}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let r={},a="none";if(re()&&(r=xi(window.location.href),this._isImplicitGrantCallback(r)?a="implicit":await this._isPKCECallback(r)&&(a="pkce")),re()&&this.detectSessionInUrl&&a!=="none"){const{data:i,error:n}=await this._getSessionFromURL(r,a);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),li(n)){const c=(e=n.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:n}}return{error:n}}const{session:o,redirectType:l}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return E(r)?this._returnResult({error:r}):this._returnResult({error:new Me("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,a,i;try{const n=await A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(a=(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:ye}),{data:o,error:l}=n;if(l||!o)return this._returnResult({data:{user:null,session:null},error:l});const c=o.session,h=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:h,session:c},error:null})}catch(n){if(E(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signUp(e){var r,a,i;try{let n;if("email"in e){const{email:d,password:f,options:g}=e;let p=null,u=null;this.flowType==="pkce"&&([p,u]=await He(this.storage,this.storageKey)),n=await A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:g==null?void 0:g.emailRedirectTo,body:{email:d,password:f,data:(r=g==null?void 0:g.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken},code_challenge:p,code_challenge_method:u},xform:ye})}else if("phone"in e){const{phone:d,password:f,options:g}=e;n=await A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:f,data:(a=g==null?void 0:g.data)!==null&&a!==void 0?a:{},channel:(i=g==null?void 0:g.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken}},xform:ye})}else throw new jt("You must provide either an email or phone number and a password");const{data:o,error:l}=n;if(l||!o)return await se(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:l});const c=o.session,h=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:h,session:c},error:null})}catch(n){if(await se(this.storage,`${this.storageKey}-code-verifier`),E(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithPassword(e){try{let r;if("email"in e){const{email:n,password:o,options:l}=e;r=await A(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:rr})}else if("phone"in e){const{phone:n,password:o,options:l}=e;r=await A(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:rr})}else throw new jt("You must provide either an email or phone number and a password");const{data:a,error:i}=r;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!a||!a.session||!a.user){const n=new qe;return this._returnResult({data:{user:null,session:null},error:n})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign({user:a.user,session:a.session},a.weak_password?{weakPassword:a.weak_password}:null),error:i})}catch(r){if(E(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(e){var r,a,i,n;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;switch(r){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(e){var r,a,i,n,o,l,c,h,d,f,g;let p,u;if("message"in e)p=e.message,u=e.signature;else{const{chain:b,wallet:m,statement:y,options:x}=e;let w;if(re())if(typeof m=="object")w=m;else{const F=window;if("ethereum"in F&&typeof F.ethereum=="object"&&"request"in F.ethereum&&typeof F.ethereum.request=="function")w=F.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!(x!=null&&x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=m}const v=new URL((r=x==null?void 0:x.url)!==null&&r!==void 0?r:window.location.href),k=await w.request({method:"eth_requestAccounts"}).then(F=>F).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!k||k.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const S=Fr(k[0]);let T=(a=x==null?void 0:x.signInWithEthereum)===null||a===void 0?void 0:a.chainId;if(!T){const F=await w.request({method:"eth_chainId"});T=Fi(F)}const P={domain:v.host,address:S,statement:y,uri:v.href,version:"1",chainId:T,nonce:(i=x==null?void 0:x.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(o=(n=x==null?void 0:x.signInWithEthereum)===null||n===void 0?void 0:n.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(l=x==null?void 0:x.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(c=x==null?void 0:x.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(h=x==null?void 0:x.signInWithEthereum)===null||h===void 0?void 0:h.requestId,resources:(d=x==null?void 0:x.signInWithEthereum)===null||d===void 0?void 0:d.resources};p=qi(P),u=await w.request({method:"personal_sign",params:[zi(p),S]})}try{const{data:b,error:m}=await A(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:u},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:ye});if(m)throw m;if(!b||!b.session||!b.user){const y=new qe;return this._returnResult({data:{user:null,session:null},error:y})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:Object.assign({},b),error:m})}catch(b){if(E(b))return this._returnResult({data:{user:null,session:null},error:b});throw b}}async signInWithSolana(e){var r,a,i,n,o,l,c,h,d,f,g,p;let u,b;if("message"in e)u=e.message,b=e.signature;else{const{chain:m,wallet:y,statement:x,options:w}=e;let v;if(re())if(typeof y=="object")v=y;else{const S=window;if("solana"in S&&typeof S.solana=="object"&&("signIn"in S.solana&&typeof S.solana.signIn=="function"||"signMessage"in S.solana&&typeof S.solana.signMessage=="function"))v=S.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=y}const k=new URL((r=w==null?void 0:w.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in v&&v.signIn){const S=await v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:k.host,uri:k.href}),x?{statement:x}:null));let T;if(Array.isArray(S)&&S[0]&&typeof S[0]=="object")T=S[0];else if(S&&typeof S=="object"&&"signedMessage"in S&&"signature"in S)T=S;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in T&&"signature"in T&&(typeof T.signedMessage=="string"||T.signedMessage instanceof Uint8Array)&&T.signature instanceof Uint8Array)u=typeof T.signedMessage=="string"?T.signedMessage:new TextDecoder().decode(T.signedMessage),b=T.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in v)||typeof v.signMessage!="function"||!("publicKey"in v)||typeof v!="object"||!v.publicKey||!("toBase58"in v.publicKey)||typeof v.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");u=[`${k.host} wants you to sign in with your Solana account:`,v.publicKey.toBase58(),...x?["",x,""]:[""],"Version: 1",`URI: ${k.href}`,`Issued At: ${(i=(a=w==null?void 0:w.signInWithSolana)===null||a===void 0?void 0:a.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((n=w==null?void 0:w.signInWithSolana)===null||n===void 0)&&n.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((c=w==null?void 0:w.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((h=w==null?void 0:w.signInWithSolana)===null||h===void 0)&&h.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((f=(d=w==null?void 0:w.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||f===void 0)&&f.length?["Resources",...w.signInWithSolana.resources.map(T=>`- ${T}`)]:[]].join(`
`);const S=await v.signMessage(new TextEncoder().encode(u),"utf8");if(!S||!(S instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");b=S}}try{const{data:m,error:y}=await A(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:u,signature:Be(b)},!((g=e.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:ye});if(y)throw y;if(!m||!m.session||!m.user){const x=new qe;return this._returnResult({data:{user:null,session:null},error:x})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:Object.assign({},m),error:y})}catch(m){if(E(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async _exchangeCodeForSession(e){const r=await Oe(this.storage,`${this.storageKey}-code-verifier`),[a,i]=(r??"").split("/");try{if(!a&&this.flowType==="pkce")throw new ci;const{data:n,error:o}=await A(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:a},xform:ye});if(await se(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!n||!n.session||!n.user){const l=new qe;return this._returnResult({data:{user:null,session:null,redirectType:null},error:l})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign(Object.assign({},n),{redirectType:i??null}),error:o})}catch(n){if(await se(this.storage,`${this.storageKey}-code-verifier`),E(n))return this._returnResult({data:{user:null,session:null,redirectType:null},error:n});throw n}}async signInWithIdToken(e){try{const{options:r,provider:a,token:i,access_token:n,nonce:o}=e,l=await A(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:a,id_token:i,access_token:n,nonce:o,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:ye}),{data:c,error:h}=l;if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!c||!c.session||!c.user){const d=new qe;return this._returnResult({data:{user:null,session:null},error:d})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:h})}catch(r){if(E(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(e){var r,a,i,n,o;try{if("email"in e){const{email:l,options:c}=e;let h=null,d=null;this.flowType==="pkce"&&([h,d]=await He(this.storage,this.storageKey));const{error:f}=await A(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(r=c==null?void 0:c.data)!==null&&r!==void 0?r:{},create_user:(a=c==null?void 0:c.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:h,code_challenge_method:d},redirectTo:c==null?void 0:c.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:f})}if("phone"in e){const{phone:l,options:c}=e,{data:h,error:d}=await A(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(i=c==null?void 0:c.data)!==null&&i!==void 0?i:{},create_user:(n=c==null?void 0:c.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:h==null?void 0:h.message_id},error:d})}throw new jt("You must provide either an email or phone number.")}catch(l){if(await se(this.storage,`${this.storageKey}-code-verifier`),E(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async verifyOtp(e){var r,a;try{let i,n;"options"in e&&(i=(r=e.options)===null||r===void 0?void 0:r.redirectTo,n=(a=e.options)===null||a===void 0?void 0:a.captchaToken);const{data:o,error:l}=await A(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:i,xform:ye});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,h=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:h,session:c},error:null})}catch(i){if(E(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(e){var r,a,i,n,o;try{let l=null,c=null;this.flowType==="pkce"&&([l,c]=await He(this.storage,this.storageKey));const h=await A(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(a=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&a!==void 0?a:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:c}),headers:this.headers,xform:Oi});return!((n=h.data)===null||n===void 0)&&n.url&&re()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(h.data.url),this._returnResult(h)}catch(l){if(await se(this.storage,`${this.storageKey}-code-verifier`),E(l))return this._returnResult({data:null,error:l});throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:a}=e;if(a)throw a;if(!r)throw new he;const{error:i}=await A(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(e){if(E(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:a,type:i,options:n}=e,{error:o}=await A(this.fetch,"POST",r,{headers:this.headers,body:{email:a,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:a,type:i,options:n}=e,{data:o,error:l}=await A(this.fetch,"POST",r,{headers:this.headers,body:{phone:a,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l})}throw new jt("You must provide either an email or phone number and a type")}catch(r){if(E(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await a,await r()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const a=r();for(this.pendingInLock.push((async()=>{try{await a}catch{}})()),await a;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await Oe(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const a=e.expires_at?e.expires_at*1e3-Date.now()<Jt:!1;if(this._debug("#__loadSession()",`session has${a?"":" not"} expired`,"expires_at",e.expires_at),!a){if(this.userStorage){const o=await Oe(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=Xt()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=Ti(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?this._returnResult({data:{session:null},error:n}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const r=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return r.data.user&&(this.suppressGetSessionWarning=!0),r}async _getUser(e){try{return e?await A(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Pe}):await this._useSession(async r=>{var a,i,n;const{data:o,error:l}=r;if(l)throw l;return!(!((a=o.session)===null||a===void 0)&&a.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new he}:await A(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&n!==void 0?n:void 0,xform:Pe})})}catch(r){if(E(r))return Yt(r)&&(await this._removeSession(),await se(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async a=>{const{data:i,error:n}=a;if(n)throw n;if(!i.session)throw new he;const o=i.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await He(this.storage,this.storageKey));const{data:h,error:d}=await A(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:Pe});if(d)throw d;return o.user=h.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(a){if(await se(this.storage,`${this.storageKey}-code-verifier`),E(a))return this._returnResult({data:{user:null},error:a});throw a}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new he;const r=Date.now()/1e3;let a=r,i=!0,n=null;const{payload:o}=_t(e.access_token);if(o.exp&&(a=o.exp,i=a<=r),i){const{data:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l)return{data:{user:null,session:null},error:null};n=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});n={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:a-r,expires_at:a},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return this._returnResult({data:{user:n.user,session:n},error:null})}catch(r){if(E(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var a;if(!e){const{data:o,error:l}=r;if(l)throw l;e=(a=o.session)!==null&&a!==void 0?a:void 0}if(!(e!=null&&e.refresh_token))throw new he;const{data:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?this._returnResult({data:{user:null,session:null},error:n}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(E(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(e,r){try{if(!re())throw new Nt("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Nt(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new Ys("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Nt("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ys("No code detected.");const{data:x,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const v=new URL(window.location.href);return v.searchParams.delete("code"),window.history.replaceState(window.history.state,"",v.toString()),{data:{session:x.session,redirectType:null},error:null}}const{provider_token:a,provider_refresh_token:i,access_token:n,refresh_token:o,expires_in:l,expires_at:c,token_type:h}=e;if(!n||!l||!o||!h)throw new Nt("No session defined in URL");const d=Math.round(Date.now()/1e3),f=parseInt(l);let g=d+f;c&&(g=parseInt(c));const p=g-d;p*1e3<=Je&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${f}s`);const u=g-f;d-u>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",u,g,d):d-u<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",u,g,d);const{data:b,error:m}=await this._getUser(n);if(m)throw m;const y={provider_token:a,provider_refresh_token:i,access_token:n,expires_in:f,expires_at:g,refresh_token:o,token_type:h,user:b.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:y,redirectType:e.type},error:null})}catch(a){if(E(a))return this._returnResult({data:{session:null,redirectType:null},error:a});throw a}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await Oe(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var a;const{data:i,error:n}=r;if(n&&!Yt(n))return this._returnResult({error:n});const o=(a=i.session)===null||a===void 0?void 0:a.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(oi(l)&&(l.status===404||l.status===401||l.status===403)||Yt(l)))return this._returnResult({error:l})}return e!=="others"&&(await this._removeSession(),await se(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const r=fi(),a={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,a),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:a}}}async _emitInitialSession(e){return await this._useSession(async r=>{var a,i;try{const{data:{session:n},error:o}=r;if(o)throw o;await((a=this.stateChangeEmitters.get(e))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,r={}){let a=null,i=null;this.flowType==="pkce"&&([a,i]=await He(this.storage,this.storageKey,!0));try{return await A(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:a,code_challenge_method:i,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(n){if(await se(this.storage,`${this.storageKey}-code-verifier`),E(n))return this._returnResult({data:null,error:n});throw n}}async getUserIdentities(){var e;try{const{data:r,error:a}=await this.getUser();if(a)throw a;return this._returnResult({data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(r){if(E(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var r;try{const{data:a,error:i}=await this._useSession(async n=>{var o,l,c,h,d;const{data:f,error:g}=n;if(g)throw g;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await A(this.fetch,"GET",p,{headers:this.headers,jwt:(d=(h=f.session)===null||h===void 0?void 0:h.access_token)!==null&&d!==void 0?d:void 0})});if(i)throw i;return re()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(a==null?void 0:a.url),this._returnResult({data:{provider:e.provider,url:a==null?void 0:a.url},error:null})}catch(a){if(E(a))return this._returnResult({data:{provider:e.provider,url:null},error:a});throw a}}async linkIdentityIdToken(e){return await this._useSession(async r=>{var a;try{const{error:i,data:{session:n}}=r;if(i)throw i;const{options:o,provider:l,token:c,access_token:h,nonce:d}=e,f=await A(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(a=n==null?void 0:n.access_token)!==null&&a!==void 0?a:void 0,body:{provider:l,id_token:c,access_token:h,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:ye}),{data:g,error:p}=f;return p?this._returnResult({data:{user:null,session:null},error:p}):!g||!g.session||!g.user?this._returnResult({data:{user:null,session:null},error:new qe}):(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("USER_UPDATED",g.session)),this._returnResult({data:g,error:p}))}catch(i){if(await se(this.storage,`${this.storageKey}-code-verifier`),E(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(e){try{return await this._useSession(async r=>{var a,i;const{data:n,error:o}=r;if(o)throw o;return await A(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(a=n.session)===null||a===void 0?void 0:a.access_token)!==null&&i!==void 0?i:void 0})})}catch(r){if(E(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const a=Date.now();return await vi(async i=>(i>0&&await yi(200*Math.pow(2,i-1)),this._debug(r,"refreshing attempt",i),await A(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ye})),(i,n)=>{const o=200*Math.pow(2,i);return n&&Qt(n)&&Date.now()+o-a<Je})}catch(a){if(this._debug(r,"error",a),E(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const a=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",a),re()&&!r.skipBrowserRedirect&&window.location.assign(a),{data:{provider:e,url:a},error:null}}async _recoverAndRefresh(){var e,r;const a="#_recoverAndRefresh()";this._debug(a,"begin");try{const i=await Oe(this.storage,this.storageKey);if(i&&this.userStorage){let o=await Oe(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:i.user},await Ye(this.userStorage,this.storageKey+"-user",o)),i.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:Xt()}else if(i&&!i.user&&!i.user){const o=await Oe(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(i.user=o.user,await se(this.storage,this.storageKey+"-user"),await Ye(this.storage,this.storageKey,i)):i.user=Xt()}if(this._debug(a,"session from storage",i),!this._isValidSession(i)){this._debug(a,"session is not valid"),i!==null&&await this._removeSession();return}const n=((r=i.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<Jt;if(this._debug(a,`session has${n?"":" not"} expired with margin of ${Jt}s`),n){if(this.autoRefreshToken&&i.refresh_token){const{error:o}=await this._callRefreshToken(i.refresh_token);o&&(console.error(o),Qt(o)||(this._debug(a,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(i.access_token);!l&&(o!=null&&o.user)?(i.user=o.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(a,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(a,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(a,"error",i),console.error(i);return}finally{this._debug(a,"end")}}async _callRefreshToken(e){var r,a;if(!e)throw new he;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new qt;const{data:n,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!n.session)throw new he;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const l={data:n.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(n){if(this._debug(i,"error",n),E(n)){const o={data:null,error:n};return Qt(n)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(o),o}throw(a=this.refreshingDeferred)===null||a===void 0||a.reject(n),n}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,r,a=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",r,`broadcast = ${a}`);try{this.broadcastChannel&&a&&this.broadcastChannel.postMessage({event:e,session:r});const n=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,r)}catch(c){n.push(c)}});if(await Promise.all(o),n.length>0){for(let l=0;l<n.length;l+=1)console.error(n[l]);throw n[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await se(this.storage,`${this.storageKey}-code-verifier`);const r=Object.assign({},e),a=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!a&&r.user&&await Ye(this.userStorage,this.storageKey+"-user",{user:r.user});const i=Object.assign({},r);delete i.user;const n=tr(i);await Ye(this.storage,this.storageKey,n)}else{const i=tr(r);await Ye(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await se(this.storage,this.storageKey),await se(this.storage,this.storageKey+"-code-verifier"),await se(this.storage,this.storageKey+"-user"),this.userStorage&&await se(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&re()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Je);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const r=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const r=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,r&&clearTimeout(r)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:a}}=r;if(!a||!a.refresh_token||!a.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((a.expires_at*1e3-e)/Je);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Je}ms, refresh threshold is ${ps} ticks`),i<=ps&&await this._callRefreshToken(a.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Br)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!re()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(e){this._debug("#visibilityChangedCallback","error",e)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,a){const i=[`provider=${encodeURIComponent(r)}`];if(a!=null&&a.redirectTo&&i.push(`redirect_to=${encodeURIComponent(a.redirectTo)}`),a!=null&&a.scopes&&i.push(`scopes=${encodeURIComponent(a.scopes)}`),this.flowType==="pkce"){const[n,o]=await He(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(l.toString())}if(a!=null&&a.queryParams){const n=new URLSearchParams(a.queryParams);i.push(n.toString())}return a!=null&&a.skipBrowserRedirect&&i.push(`skip_http_redirect=${a.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var a;const{data:i,error:n}=r;return n?this._returnResult({data:null,error:n}):await A(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(a=i==null?void 0:i.session)===null||a===void 0?void 0:a.access_token})})}catch(r){if(E(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(e){try{return await this._useSession(async r=>{var a,i;const{data:n,error:o}=r;if(o)return this._returnResult({data:null,error:o});const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:c,error:h}=await A(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(a=n==null?void 0:n.session)===null||a===void 0?void 0:a.access_token});return h?this._returnResult({data:null,error:h}):(e.factorType==="totp"&&c.type==="totp"&&(!((i=c==null?void 0:c.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(r){if(E(r))return this._returnResult({data:null,error:r});throw r}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var a;const{data:i,error:n}=r;if(n)return this._returnResult({data:null,error:n});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?Yi(e.webauthn.credential_response):Qi(e.webauthn.credential_response)})}:{code:e.code}),{data:l,error:c}=await A(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(a=i==null?void 0:i.session)===null||a===void 0?void 0:a.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),this._returnResult({data:l,error:c}))})}catch(r){if(E(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var a;const{data:i,error:n}=r;if(n)return this._returnResult({data:null,error:n});const o=await A(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(a=i==null?void 0:i.session)===null||a===void 0?void 0:a.access_token});if(o.error)return o;const{data:l}=o;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:Gi(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:Ji(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(E(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(e){const{data:r,error:a}=await this._challenge({factorId:e.factorId});return a?this._returnResult({data:null,error:a}):await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){var e;const{data:{user:r},error:a}=await this.getUser();if(a)return{data:null,error:a};const i={all:[],phone:[],totp:[],webauthn:[]};for(const n of(e=r==null?void 0:r.factors)!==null&&e!==void 0?e:[])i.all.push(n),n.status==="verified"&&i[n.factor_type].push(n);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(e){var r,a,i,n;if(e)try{const{payload:p}=_t(e);let u=null;p.aal&&(u=p.aal);let b=u;const{data:{user:m},error:y}=await this.getUser(e);if(y)return this._returnResult({data:null,error:y});((a=(r=m==null?void 0:m.factors)===null||r===void 0?void 0:r.filter(v=>v.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(b="aal2");const w=p.amr||[];return{data:{currentLevel:u,nextLevel:b,currentAuthenticationMethods:w},error:null}}catch(p){if(E(p))return this._returnResult({data:null,error:p});throw p}const{data:{session:o},error:l}=await this.getSession();if(l)return this._returnResult({data:null,error:l});if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:c}=_t(o.access_token);let h=null;c.aal&&(h=c.aal);let d=h;((n=(i=o.user.factors)===null||i===void 0?void 0:i.filter(p=>p.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(d="aal2");const g=c.amr||[];return{data:{currentLevel:h,nextLevel:d,currentAuthenticationMethods:g},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async r=>{const{data:{session:a},error:i}=r;return i?this._returnResult({data:null,error:i}):a?await A(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:a.access_token,xform:n=>({data:n,error:null})}):this._returnResult({data:null,error:new he})})}catch(r){if(E(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(e,r){try{return await this._useSession(async a=>{const{data:{session:i},error:n}=a;if(n)return this._returnResult({data:null,error:n});if(!i)return this._returnResult({data:null,error:new he});const o=await A(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&re()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(a){if(E(a))return this._returnResult({data:null,error:a});throw a}}async _denyAuthorization(e,r){try{return await this._useSession(async a=>{const{data:{session:i},error:n}=a;if(n)return this._returnResult({data:null,error:n});if(!i)return this._returnResult({data:null,error:new he});const o=await A(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&re()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(a){if(E(a))return this._returnResult({data:null,error:a});throw a}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:r},error:a}=e;return a?this._returnResult({data:null,error:a}):r?await A(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new he})})}catch(e){if(E(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async r=>{const{data:{session:a},error:i}=r;return i?this._returnResult({data:null,error:i}):a?(await A(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:a.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new he})})}catch(r){if(E(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,r={keys:[]}){let a=r.keys.find(l=>l.kid===e);if(a)return a;const i=Date.now();if(a=this.jwks.keys.find(l=>l.kid===e),a&&this.jwks_cached_at+ni>i)return a;const{data:n,error:o}=await A(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!n.keys||n.keys.length===0||(this.jwks=n,this.jwks_cached_at=i,a=n.keys.find(l=>l.kid===e),!a)?null:a}async getClaims(e,r={}){try{let a=e;if(!a){const{data:p,error:u}=await this.getSession();if(u||!p.session)return this._returnResult({data:null,error:u});a=p.session.access_token}const{header:i,payload:n,signature:o,raw:{header:l,payload:c}}=_t(a);r!=null&&r.allowExpired||Ci(n.exp);const h=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!h){const{error:p}=await this.getUser(a);if(p)throw p;return{data:{claims:n,header:i,signature:o},error:null}}const d=Ei(i.alg),f=await crypto.subtle.importKey("jwk",h,d,!0,["verify"]);if(!await crypto.subtle.verify(d,f,o,gi(`${l}.${c}`)))throw new fs("Invalid JWT signature");return{data:{claims:n,header:i,signature:o},error:null}}catch(a){if(E(a))return this._returnResult({data:null,error:a});throw a}}}ht.nextInstanceID={};const io=ht,oo="2.95.0";let at="";typeof Deno<"u"?at="deno":typeof document<"u"?at="web":typeof navigator<"u"&&navigator.product==="ReactNative"?at="react-native":at="node";const lo={"X-Client-Info":`supabase-js-${at}/${oo}`},co={headers:lo},uo={schema:"public"},ho={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},po={};function pt(s){"@babel/helpers - typeof";return pt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pt(s)}function go(s,e){if(pt(s)!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var a=r.call(s,e);if(pt(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function mo(s){var e=go(s,"string");return pt(e)=="symbol"?e:e+""}function fo(s,e,r){return(e=mo(e))in s?Object.defineProperty(s,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[e]=r,s}function lr(s,e){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);e&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable})),r.push.apply(r,a)}return r}function K(s){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?lr(Object(r),!0).forEach(function(a){fo(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):lr(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}const xo=s=>s?(...e)=>s(...e):(...e)=>fetch(...e),bo=()=>Headers,yo=(s,e,r)=>{const a=xo(r),i=bo();return async(n,o)=>{var l;const c=(l=await e())!==null&&l!==void 0?l:s;let h=new i(o==null?void 0:o.headers);return h.has("apikey")||h.set("apikey",s),h.has("Authorization")||h.set("Authorization",`Bearer ${c}`),a(n,K(K({},o),{},{headers:h}))}};function vo(s){return s.endsWith("/")?s:s+"/"}function wo(s,e){var r,a;const{db:i,auth:n,realtime:o,global:l}=s,{db:c,auth:h,realtime:d,global:f}=e,g={db:K(K({},c),i),auth:K(K({},h),n),realtime:K(K({},d),o),storage:{},global:K(K(K({},f),l),{},{headers:K(K({},(r=f==null?void 0:f.headers)!==null&&r!==void 0?r:{}),(a=l==null?void 0:l.headers)!==null&&a!==void 0?a:{})}),accessToken:async()=>""};return s.accessToken?g.accessToken=s.accessToken:delete g.accessToken,g}function jo(s){const e=s==null?void 0:s.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(vo(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var No=class extends io{constructor(s){super(s)}},_o=class{constructor(s,e,r){var a,i;this.supabaseUrl=s,this.supabaseKey=e;const n=jo(s);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",n),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",n),this.storageUrl=new URL("storage/v1",n),this.functionsUrl=new URL("functions/v1",n);const o=`sb-${n.hostname.split(".")[0]}-auth-token`,l={db:uo,realtime:po,auth:K(K({},ho),{},{storageKey:o}),global:co},c=wo(r??{},l);if(this.storageKey=(a=c.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(i=c.global.headers)!==null&&i!==void 0?i:{},c.accessToken)this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(d,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}});else{var h;this.auth=this._initSupabaseAuthClient((h=c.auth)!==null&&h!==void 0?h:{},this.headers,c.global.fetch)}this.fetch=yo(e,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(K({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new on(new URL("rest/v1",n).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch,timeout:c.db.timeout,urlLengthLimit:c.db.urlLengthLimit}),this.storage=new ei(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),c.accessToken||this._listenForAuthEvents()}get functions(){return new Xa(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(s){return this.rest.from(s)}schema(s){return this.rest.schema(s)}rpc(s,e={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(s,e,r)}channel(s,e={config:{}}){return this.realtime.channel(s,e)}getChannels(){return this.realtime.getChannels()}removeChannel(s){return this.realtime.removeChannel(s)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var s=this,e,r;if(s.accessToken)return await s.accessToken();const{data:a}=await s.auth.getSession();return(e=(r=a.session)===null||r===void 0?void 0:r.access_token)!==null&&e!==void 0?e:s.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:s,persistSession:e,detectSessionInUrl:r,storage:a,userStorage:i,storageKey:n,flowType:o,lock:l,debug:c,throwOnError:h},d,f){const g={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new No({url:this.authUrl.href,headers:K(K({},g),d),storageKey:n,autoRefreshToken:s,persistSession:e,detectSessionInUrl:r,storage:a,userStorage:i,flowType:o,lock:l,debug:c,throwOnError:h,fetch:f,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(s){return new _n(this.realtimeUrl.href,K(K({},s),{},{params:K(K({},{apikey:this.supabaseKey}),s==null?void 0:s.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,e)=>{this._handleTokenChanged(s,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(s,e,r){(s==="TOKEN_REFRESHED"||s==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):s==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const So=(s,e,r)=>new _o(s,e,r);function ko(){if(typeof window<"u")return!1;const s=globalThis.process;if(!s)return!1;const e=s.version;if(e==null)return!1;const r=e.match(/^v(\d+)\./);return r?parseInt(r[1],10)<=18:!1}ko()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Co="https://xmbeftniblkemqeczrlh.supabase.co",Eo="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhtYmVmdG5pYmxrZW1xZWN6cmxoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwNTA0MDQsImV4cCI6MjA4NjYyNjQwNH0.NW8S6Zo_BCC7VDK24_G-yBq6mU4P-VCFY0qIds7ELWc",q=So(Co,Eo),qr=["Amit","Rahul","Priya","Sneha","Vikram","Rohan","Sita","Gita","Mohan","Sohan","Anita","Kavita","Raj","Simran","Arjun","Karan"],Ct=["Kumar","Sharma","Singh","Gupta","Verma","Yadav","Jain","Mehta","Reddy","Patel","Mishra","Joshi"],cr=["Jaipur","Delhi","Mumbai","Kota","Udaipur","Patna","Indore","Bhopal","Lucknow","Kanpur"],Ao=["Red","Blue","Green","Yellow","Orange"],ce=s=>s[Math.floor(Math.random()*s.length)],de=(s,e)=>Math.floor(Math.random()*(e-s+1))+s,dr=[{title:"Salary Calculation",dataModel:"Salary",tasks:["Calculate 'Net Salary' in Column D (Basic Salary + Bonus). Formula: =B1+C1","Calculate 'Annual Salary' in Column E (Net Salary * 12). Formula: =D1*12","Calculate Average Basic Salary in cell B6 using AVERAGE function.","Calculate Total Bonus in cell C7 using SUM function.","Find Maximum Basic Salary in cell B8 using MAX function.","Find Minimum Basic Salary in cell B9 using MIN function.","Count total employees in cell B10 using COUNT function.","Format the header row (Row 0) with Bold and Yellow background.","Align all numeric values in Columns B and C to Center.","Apply Borders to the entire data range."]},{title:"Sales Report",dataModel:"Sales",tasks:["Calculate 'Revenue' in Column D (Price * Units). Formula: =B1*C1","Calculate 'Profit' in Column E (Revenue - (Cost * Units)). Assume Cost is 50% of Price: =D1-(B1*0.5*C1)","Calculate Total Revenue in cell D6 using SUM.","Calculate Average Unit Price in cell B7 using AVERAGE.","Find Highest Units Sold in cell C8 using MAX.","Find Lowest Units Sold in cell C9 using MIN.","Count number of products in cell A10 using COUNT.","Format 'Total Rev' cell (D6) text to Bold and Red Color.","Change the Font of Product Names (Column A) to Italic.","Underline the header row."]},{title:"Student Marks Sheet",dataModel:"Marks",tasks:["Calculate 'Total Marks' in Column E (Maths + Sci + Eng). Formula: =B1+C1+D1","Calculate 'Percentage' in Column F (Total / 3). Formula: =E1/3","Calculate Class Average for Maths in cell B6 using AVERAGE.","Find Highest Marks in Science in cell C7 using MAX.","Find Lowest Marks in English in cell D8 using MIN.","Count total students in cell A9 using COUNT.","Highlight the student with highest total marks in Yellow.","Make the 'Percentage' column (F) text Bold.","Center align all marks.","Apply a thick border around the table."]},{title:"Inventory Management",dataModel:"Inventory",tasks:["Calculate 'Remaining Stock' in Column D (Opening - Sold). Formula: =B1-C1","Calculate 'Stock Value' in Column E (Remaining * 500). Formula: =D1*500","Calculate Total Opening Stock in cell B6 using SUM.","Calculate Total Sold Items in cell C7 using SUM.","Find Maximum Opening Stock in cell B8 using MAX.","Find Minimum Sold Items in cell C9 using MIN.","Count total number of items in cell A10 using COUNT.","Format 'Stock Value' column to have 'Currency' style (bold + italic).","Highlight 'Printer' row in Red if remaining stock is less than 5.","Align 'Item Name' column to Left."]},{title:"Budget Planner",dataModel:"Budget",tasks:["Calculate 'Variance' in Column D (Actual - Estimated). Formula: =C1-B1","Calculate 'Variance %' in Column E (Variance / Estimated * 100). Formula: =D1/B1*100","Calculate Total Estimated Cost in cell B6 using SUM.","Calculate Total Actual Cost in cell C7 using SUM.","Find Maximum Variance in cell D8 using MAX.","Find Minimum Variance in cell D9 using MIN.","Count number of expense categories in cell A10 using COUNT.","Format positive variance values in Green, negative in Red.","Bold the 'Total' rows.","Apply 'Grid' borders to the table."]}],ur=[{title:"Official Letter Formatting",type:"Letter",baseContent:"<p>To,</p><p>The District Collector,</p><p>{CITY}, Rajasthan.</p><p>Subject: Application for {REASON}.</p><p>Sir,</p><p>Most respectfully, I beg to say that {BODY}.</p><p>Kindly grant me leave for two days.</p><p>Thanking You,</p><p>Yours Faithfully,</p><p>{NAME}</p><p>{DESIGNATION}</p>",questions:["Set page size to A4 and margins to 'Normal'.","Make the text 'The District Collector' Bold and Underlined.","Center align the 'Subject' line and make it Bold.","Set font size of the body text to 14.","Right align the 'Yours Faithfully' section.","Justify the main body paragraph.","Change font color of 'Subject' to Blue.","Apply 'Italic' style to '{DESIGNATION}'.","Set line spacing of the body paragraph to 1.5.","Highlight '{CITY}, Rajasthan' in Yellow."]},{title:"Notice Writing",type:"Notice",baseContent:"<p>NOTICE</p><p>{SCHOOL_NAME}, {CITY}</p><p>Date: {DATE}</p><p>{EVENT_NAME}</p><p>This is to inform all students that the {EVENT_NAME} will be held on {EVENT_DATE} in the school playground. Interested students should submit their names to the undersigned by {DEADLINE}.</p><p>Events: 100m Race, Long Jump, Shot Put.</p><p>Sports Secretary,</p><p>{NAME}</p>",questions:["Center align the word 'NOTICE' and make it Bold.","Make the School Name Bold, Underlined, and Font Size 16.","Right align the 'Date'.","Make '{EVENT_NAME}' Bold and Italic.","Justify the main paragraph text.","Change font of 'Events' line to 'Arial'.","Highlight '{EVENT_DATE}' with Green color.","Make 'Sports Secretary' Bold.","Convert '100m Race, Long Jump, Shot Put' into a Bulleted List.","Apply a text border to the word 'NOTICE'."]},{title:"Resume Formatting",type:"Resume",baseContent:"<p>CURRICULUM VITAE</p><p>Name: {NAME}</p><p>Address: {ADDRESS}</p><p>Email: {EMAIL}</p><p>CAREER OBJECTIVE</p><p>To secure a challenging position in a reputable organization to expand my learnings, knowledge, and skills.</p><p>EDUCATION</p><p>10th - RBSE Board - {SCORE1}%</p><p>12th - RBSE Board - {SCORE2}%</p><p>B.Com - Rajasthan University - {SCORE3}%</p><p>SKILLS</p><p>MS Office, Tally, Typing (Hindi & English)</p>",questions:["Center align 'CURRICULUM VITAE', make it Bold and Underlined.","Make 'Name', 'Address', 'Email' labels Bold.","Make section headers ('CAREER OBJECTIVE', 'EDUCATION', 'SKILLS') Bold and shade background Grey.","Justify the Career Objective paragraph.","Convert Education details into a Bulleted List.","Change font of the entire document to 'Times New Roman'.","Set font size of section headers to 14.","Italicize the percentages in Education section.","Apply 'Strike-through' to the word 'Tally'.","Change the font color of 'Email' to Blue."]},{title:"Meeting Minutes",type:"Minutes",baseContent:"<p>MINUTES OF MEETING</p><p>Date: {DATE}</p><p>Time: 10:00 AM</p><p>Venue: Conference Hall</p><p>Attendees:</p><p>1. Mr. {NAME1} (Chairman)</p><p>2. Ms. {NAME2} (Secretary)</p><p>3. All Department Heads</p><p>Agenda:</p><p>1. Review of {TOPIC1}</p><p>2. {TOPIC2}</p><p>3. Employee Welfare Verification</p><p>Action Items:</p><p>HR Dept to organize health camp.</p><p>Marketing Dept to launch new campaign.</p>",questions:["Center align 'MINUTES OF MEETING', make it Bold, Font Size 18.","Make 'Date', 'Time', 'Venue' labels Bold.","Convert 'Attendees' list into a Numbered List.","Convert 'Agenda' list into a Bulleted List.","Make 'Action Items' header Bold and Underlined.","Justify the Action Items text.","Highlight 'Conference Hall' in Yellow.","Change 'Mr. {NAME1} (Chairman)' font color to Red.","Apply Line Spacing of 2.0 to the Agenda list.","Italicize 'Employee Welfare Verification'."]},{title:"Article Formatting",type:"Article",baseContent:"<p>{TITLE}</p><p>{BODY_START}. It gives us oxygen, store carbon, stabilize the soil and give life to the worlds wildlife.</p><p>Benefits:</p><p>Oxygen Production</p><p>Climate Control</p><p>Air Purification</p><p>Conclusion</p><p>We must plant more trees to save our planet.</p><p>Written by: Environment Club</p>",questions:["Center align title '{TITLE}', make Bold and Underlined.","Set title font size to 20.","Justify the first paragraph.","Make 'Benefits:' header Bold and Italic.","Convert the benefits list into a Bulleted List.","Change font of 'Conclusion' to 'Arial Black'.","Center align 'Written by: Environment Club'.","Highlight 'oxygen' and 'carbon' words in Green.","Apply Subscript to '2' in 'CO2' (if added text manually).","Right align the entire first paragraph."]}],To=s=>{const e=[];if(s==="Salary")for(let r=1;r<=5;r++)e.push({id:r,name:`${ce(qr)} ${ce(Ct)}`,val1:de(15e3,5e4),c:de(1e3,5e3),d:"",e:""});else if(s==="Sales"){const r=["Laptop","Mouse","Keyboard","Monitor","Printer","USB Drive","Webcam","Headset"];for(let a=1;a<=5;a++)e.push({id:a,name:ce(r),val1:de(500,2e3),c:de(10,100),d:"",e:""})}else for(let r=1;r<=5;r++)e.push({id:r,name:`Item ${String.fromCharCode(64+r)}`,val1:de(10,100),c:de(10,100),d:"",e:""});for(let r=6;r<=10;r++)e.push({id:r,name:r===6?"Total":"",val1:"",c:"",d:"",e:""});return e},Po=s=>{const e=[];let r=101;for(let a=0;a<s;a++){const i=dr[a%dr.length],n=a<5;e.push({id:r++,title:n?i.title:`${i.title} - Set ${Math.floor(a/5)+1}`,type:"Excel",language:"English",isFree:a<2,data:To(i.dataModel),tasks:i.tasks.map((o,l)=>({text:o,marks:1}))})}return e},Ro=s=>{const e=[];let r=201;for(let a=0;a<s;a++){const i=ur[a%ur.length],n=a<5;let o=i.baseContent.replace(/{CITY}/g,ce(cr)).replace(/{NAME}/g,`${ce(qr)} ${ce(Ct)}`).replace(/{NAME1}/g,ce(Ct)).replace(/{NAME2}/g,ce(Ct)).replace(/{DATE}/g,`${de(1,28)}th ${ce(["Jan","Feb","Mar","Oct","Dec"])} 2025`).replace(/{EVENT_DATE}/g,`${de(1,28)}th Next Month`).replace(/{DEADLINE}/g,`${de(1,28)}th This Month`).replace(/{REASON}/g,ce(["fever","urgent work","marriage","festival"])).replace(/{BODY}/g,"I have some urgent piece of work at home").replace(/{DESIGNATION}/g,ce(["Clerk","Assistant","Manager","Student"])).replace(/{SCHOOL_NAME}/g,"Govt. Sen. Sec. School").replace(/{EVENT_NAME}/g,ce(["Annual Function","Sports Day","Science Fair","Debate Competition"])).replace(/{ADDRESS}/g,`${de(10,99)}, Civil Lines, ${ce(cr)}`).replace(/{EMAIL}/g,`user${de(100,999)}@example.com`).replace(/{SCORE1}/g,de(60,95).toString()).replace(/{SCORE2}/g,de(60,95).toString()).replace(/{SCORE3}/g,de(55,85).toString()).replace(/{TOPIC1}/g,"Performance").replace(/{TOPIC2}/g,"Future Plans").replace(/{TITLE}/g,"IMPORTANCE OF TREES").replace(/{BODY_START}/g,"Trees are vital");e.push({id:r++,title:n?i.title:`${i.title} - Set ${Math.floor(a/5)+1}`,type:"Word",language:"English",isFree:a<2,content:o,questions:i.questions.map(l=>{const c=ce(Ao);return{text:l.replace(/Blue|Red|Green|Yellow/g,c),marks:1}})})}return e},Io=Po(50),Oo=Ro(50),Hr=[],Wr=[],Dt={profileName:"Untitled Profile",description:"",calculationParam:"net_wpm",wordCalculation:"5char",minEligibilityType:"none",languageMode:"fixed",fixedLanguage:"en",hindiFont:"mangal",hindiComplexity:"standard",allowAltCodes:!1,hindiStenoAvailable:!1,errorClassification:"simple",ignoredErrorLimit:0,penaltyMultiplier:0,penaltyMethod:"none",finalScoreCalc:"direct",scoreDisplay:"2dec",showAccuracy:!0,stenoEnabled:!1,durationMin:10,practiceSession:"none",breakDurationSec:0,backspaceEnabled:!0,arrowKeysEnabled:!0,highlight:"word",showFingerPosition:!1,showOnscreenKeyboard:!0,liveErrors:!0,showSpeedDuringTest:!0,minKeystrokes:0,categoryWiseEnabled:!1,scribeAllowed:!1,examType:"practice",resultDisplay:"detailed"},Lo={siteName:"TypingNexus",siteTagline:"India's #1 Typing & Computer Efficiency Platform",supportEmail:"support@typingnexus.in",logoUrl:"",logoLightUrl:"",logoDarkUrl:"",faviconUrl:"",copyrightText:" 2026 TypingNexus.in. All rights reserved.",maintenanceMode:!1,maintenanceMessage:"Website is under maintenance. Please check back soon.",allowAdminBypass:!0,seoTitle:"TypingNexus - Master Typing with Confidence",seoKeywords:"typing, hindi typing, english typing, SSC, RRB, typing test",robotsTxt:`User-agent: *
Allow: /`,timezone:"Asia/Kolkata",dateFormat:"DD/MM/YYYY",currencySymbol:"",upiId:"",razorpayKeyId:"",razorpaySecret:"",stripeKey:"",paymentMode:"Sandbox",taxEnabled:!1,taxRate:18,taxInclusive:!0,hsnCodes:"9983",invoicePrefix:"TN-2026-",companyAddress:"",digitalSignatureUrl:"",autoRenewal:!1,trialDays:7,gracePeriodDays:3,multiDeviceLimit:1,sessionTimeout:24,verifyEmailRequired:!1,ipBanList:[],smtpHost:"",smtpPort:587,smtpUser:"",smtpPass:"",smtpFromEmail:"noreply@typingnexus.in",smtpFromName:"TypingNexus",smsApiUrl:"",whatsappApiKey:"",emailTemplates:{welcome:"Welcome to TypingNexus! Let's start typing.",passwordReset:"Reset your password using the link below.",purchaseSuccess:"Thank you for your purchase!"},bulkDiscounts:[{minQty:5,discount:15},{minQty:20,discount:30}],contentDripEnabled:!1,expiryReminders:[1,3,7],homeBanners:[{id:"1",image:"https://images.unsplash.com/photo-1587620962725-abab7fe55159?q=80&w=1931&auto=format&fit=crop",link:"/practice-exams",active:!0},{id:"2",image:"https://images.unsplash.com/photo-1519389950473-47ba0277781c?q=80&w=2070&auto=format&fit=crop",link:"/cpt/excel",active:!0}],legalPrivacy:"",legalTerms:"",legalRefund:"",googleAnalyticsId:"",facebookPixelId:"",customHeaderScripts:"",customFooterScripts:"",affiliateEnabled:!1,affiliateCommission:10,supportDepartments:["Technical","Billing","Sales"],supportAutoReply:"Thank you for contacting us. We'll get back to you soon.",escalationHours:24,autoBackupEnabled:!0,backupIntervalHours:24,autoLiveExamEnabled:!0,allowRegistrations:!0,primaryColor:"#2563eb",navLinks:[{label:"Home",href:"/",visible:!0},{label:"English Typing",href:"/practice/english",visible:!0,subLinks:[{label:"Typing Test",href:"/practice/english",visible:!0},{label:"Key Drilling",href:"/learn/english",visible:!0},{label:"Keyboard Drilling",href:"/keyboard/english",visible:!0}]},{label:"Hindi Typing",href:"/practice/hindi",visible:!0,subLinks:[{label:"Typing Test",href:"/practice/hindi",visible:!0},{label:"Key Drilling",href:"/learn/hindi",visible:!0},{label:"Keyboard Drilling",href:"/keyboard/hindi",visible:!0}]},{label:"Exam",href:"/practice-exams",visible:!0},{label:"Live Test",href:"/start-typing",visible:!0},{label:"CPT",href:"#",visible:!0,subLinks:[{label:"CPT Word",href:"/cpt/word",visible:!0},{label:"CPT Excel",href:"/cpt/excel",visible:!0}]},{label:"Pricing",href:"/pricing",visible:!0}],footerText:"TypingNexus - Your path to typing excellence",footerLinks:[{label:"Home",href:"/"},{label:"Practice",href:"/practice"},{label:"Exams",href:"/practice-exams"},{label:"Pricing",href:"/pricing"}],footerExams:[{label:"RSSB LDC / Junior Assistant",href:"/practice-exams"},{label:"SSC CGL / CHSL",href:"/practice-exams"},{label:"RRB NTPC / Group D",href:"/practice-exams"},{label:"UPPCL / State PSC",href:"/practice-exams"}],socialLinks:[{platform:"Facebook",url:"https://facebook.com",visible:!0},{platform:"Twitter",url:"https://twitter.com",visible:!0},{platform:"YouTube",url:"https://youtube.com",visible:!0}],showPracticeExams:!0,showTypingTutorial:!0,showKeyboardDrill:!0,showTypingTests:!0,showBlog:!0,showPricing:!0,showRSSBPack:!0,showGamification:!0,showLeaderboard:!0,version:16,heroTitle:"Welcome to TypingNexus",heroSubtitle:"Your ultimate platform for typing mastery.",heroCTAText:"Start Learning",heroCTALink:"/learn",featuredExamWidget:{visible:!1,title:"Featured Exam",examId:null,description:""},featuredItems:[],siteStats:{students:"0",testsTaken:"0",passRate:"0%",uptime:"100%"}},Do=[],Uo=[],$o=[{id:"1",name:"Mahijeet",email:"admin@typingnexus.in",password:"Ramjiram@555999",plan:"Pro Yearly",role:"Super Admin",status:"Active",joined:new Date().toISOString().split("T")[0],authMethod:"Email"}],Mo=[],Bo=[],Fo=[],zo=[],qo=[],Ho=[{id:1,name:"1 Day Pass",subtitle:"Quick Revision",price:9,currency:"",period:"/ 24 Hours",durationDays:1,features:["Unlimited Practice Tests","All Exam Modules (Excel/Word)","Instant Result Analysis","Ad-free Experience","PDF Downloads"],isCombo:!1,type:"Student",buttonText:"Get 1 Day Pass"},{id:2,name:"7 Day Booster",subtitle:"Weekly Practice",price:29,currency:"",period:"/ 7 Days",durationDays:7,features:["Everything in 1 Day Pass","7 Days Validity","Priority Support","Daily Progress Tracking","Save up to 30%"],isCombo:!1,highlight:!0,badge:"Popular",type:"Student",buttonText:"Get 7 Day Booster"},{id:3,name:"6 Month Saver",subtitle:"Semester Special",price:99,currency:"",period:"/ 6 Months",durationDays:180,features:["Same Price as 1 Month!","180 Days Validity","Full Access to All Tests","Priority Support","Best for Semester Exams"],isCombo:!1,highlight:!0,badge:"Limited Offer",type:"Student",buttonText:"Get 6 Month Saver"},{id:4,name:"1 Year Premium",subtitle:"Long Term Mastery",price:199,currency:"",period:"/ Year",durationDays:365,features:["Everything in Monthly Pro","365 Days Validity","All Future Updates Included","Highest Priority Support","Save up to 80%"],isCombo:!1,badge:"Best Value",type:"Student",buttonText:"Get Yearly Premium"}],Ut="ar_typing_admin_store_v2",H=()=>{var r;let s=null;try{const a=localStorage.getItem(Ut);a&&(s=JSON.parse(a))}catch(a){console.error("Failed to load admin store",a)}const e={users:$o,rules:Mo,categories:[],exams:Bo,examProfiles:Wr,contentLibrary:Hr,courses:[],payments:qo,plans:[{id:"plan_1day",name:"1 Day Pass",durationMonths:0,price:9,currency:"INR",features:["Unlimited Practice Tests","All Exam Modules (Excel/Word)","Instant Result Analysis","Ad-free Experience","PDF Downloads"],isActive:!0,type:"Standard"},{id:"plan_7day",name:"7 Day Booster",durationMonths:0,price:29,currency:"INR",features:["Everything in 1 Day Pass","7 Days Validity","Priority Support","Daily Progress Tracking","Save up to 30%"],isActive:!0,type:"Standard"},{id:"plan_6month",name:"6 Month Saver",durationMonths:6,price:99,currency:"INR",features:["Same Price as 1 Month!","180 Days Validity","Full Access to All Tests","Priority Support","Best for Semester Exams"],isActive:!0,type:"Pro"},{id:"plan_yearly",name:"1 Year Premium",durationMonths:12,price:199,currency:"INR",features:["Everything in Monthly Pro","365 Days Validity","All Future Updates Included","Highest Priority Support","Save up to 80%"],isActive:!0,type:"Pro"}],coupons:[],transactions:[],supportTickets:[],announcements:[],ads:[],packages:Ho,blogs:Fo,settings:Lo,results:Do,enquiries:Uo,invoices:[],notifications:zo,media:[],passages:[],certificateTemplates:[],certificateCriteria:{minWPM:35,minAccuracy:95,testType:"Any",enabled:!0},achievements:[],gamificationSettings:{xpPerTest:25,xpPerLesson:10,xpPerStreak:50,streakBonusMultiplier:1.5,leaderboardEnabled:!0,dailyChallengesEnabled:!0,levels:[{level:1,minXp:0,title:"Novice Typist",icon:""},{level:2,minXp:500,title:"Speedsters",icon:""},{level:3,minXp:1500,title:"Keyboard Warrior",icon:""},{level:4,minXp:3e3,title:"Typing Legend",icon:""},{level:5,minXp:5e3,title:"God Mode",icon:""}]},userProgress:[],cptTests:[...Io,...Oo],comboPacks:[]};if(s){let a=s.users||e.users;a.length>0&&!a[0].password&&(console.log("Resetting users to include password field"),a=e.users);const i=e.settings.version||0,n=((r=s.settings)==null?void 0:r.version)||0;let o=s.settings||e.settings;n<i&&(console.log(`Migrating settings from v${n} to v${i}`),o={...e.settings,...s.settings,navLinks:e.settings.navLinks,heroTitle:e.settings.heroTitle,heroCTAText:e.settings.heroCTAText,heroCTALink:e.settings.heroCTALink,footerLinks:e.settings.footerLinks,footerExams:e.settings.footerExams});const l={...e,...s,users:a,rules:s.rules||e.rules,categories:s.categories||e.categories,exams:s.exams||e.exams,payments:s.payments||e.payments,cptTests:e.cptTests,comboPacks:s.comboPacks||e.comboPacks,plans:s.plans||e.plans,coupons:s.coupons||e.coupons,transactions:s.transactions||e.transactions,examProfiles:s.examProfiles&&s.examProfiles.length>0?s.examProfiles:e.examProfiles,contentLibrary:s.contentLibrary&&s.contentLibrary.length>0?s.contentLibrary:e.contentLibrary,courses:s.courses||e.courses,ads:s.ads||e.ads,packages:s.packages||e.packages,blogs:s.blogs||e.blogs,settings:o,results:s.results||e.results,enquiries:s.enquiries||e.enquiries,invoices:s.invoices||e.invoices,notifications:s.notifications||e.notifications,media:s.media||e.media,passages:s.passages||e.passages,certificateTemplates:s.certificateTemplates||e.certificateTemplates,certificateCriteria:s.certificateCriteria||e.certificateCriteria,achievements:s.achievements||e.achievements,gamificationSettings:s.gamificationSettings||e.gamificationSettings,userProgress:s.userProgress||e.userProgress};if(l.exams&&l.exams.length>0){const h=l.exams.filter(g=>g.content&&g.content.trim().length>0).map(g=>({id:-g.id,title:g.contentTitle||g.title,content:g.content,language:g.language||"English",difficulty:"Medium",category:g.title,wordCount:g.content.split(/\s+/).length,tags:["Exam Content"],status:"Active",createdDate:new Date().toISOString()})),d=new Set(l.passages.map(g=>g.id)),f=h.filter(g=>!d.has(g.id));l.passages=[...l.passages,...f]}const c=Date.now()-1440*60*1e3;return l.results=(l.results||[]).filter(h=>h.timestamp&&h.timestamp>c),l}return localStorage.setItem(Ut,JSON.stringify(e)),e},_s=async()=>{try{console.log("[Sync] Starting sync from Hostinger...");const s=H();let e=!1;localStorage.setItem("ar_typing_sync_status","Synchronizing...");const r=async n=>{try{const o=`https://typingnexus.in/data/${n}.json?t=${Date.now()}`,l=await fetch(o);if(l.ok){const c=await l.json();return console.log(`[Sync] Success: ${n}.json fetched.`),c}console.warn(`[Sync] ${n}.json not found (Status: ${l.status})`)}catch(o){console.error(`[Sync] Error fetching ${n}.json:`,o)}return null},a=await r("settings");a&&Object.keys(a).length>0&&(a.settings&&(s.settings={...s.settings,...a.settings}),a.categories&&(s.categories=a.categories),a.plans&&(s.plans=a.plans),a.packages&&(s.packages=a.packages),e=!0);const i=await r("content");if(i&&Object.keys(i).length>0&&(i.exams&&i.exams.length>0&&(s.exams=i.exams),i.rules&&(s.rules=i.rules),i.passages&&(s.passages=i.passages),i.examProfiles&&(s.examProfiles=i.examProfiles),i.contentLibrary&&(s.contentLibrary=i.contentLibrary),i.courses&&(s.courses=i.courses),i.cptTests&&(s.cptTests=i.cptTests),i.blogs&&(s.blogs=i.blogs),i.notifications&&(s.notifications=i.notifications),e=!0),e)return localStorage.setItem(Ut,JSON.stringify(s)),localStorage.setItem("ar_typing_sync_status",`Last Synced: ${new Date().toLocaleTimeString()}`),window.dispatchEvent(new Event("adminStoreUpdate")),console.log("[Sync] Local store updated with server data."),!0;localStorage.setItem("ar_typing_sync_status","Up to date")}catch(s){console.error("Sync Error:",s),localStorage.setItem("ar_typing_sync_status","Sync Failed")}return!1},hr=async(s,e)=>{try{const r="https://typingnexus.in/save_settings.php";console.log(`[API] Saving ${s} to ${r}...`);const a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:s,data:e})}),i=await a.json();if(!a.ok)throw console.error(`[API Error] Status: ${a.status}`,i),new Error(i.error||`Server responded with ${a.status}`);return console.log(`[API Success] ${s} saved:`,i),!0}catch(r){throw console.error(`[API Fatal Error] ${s} save failed:`,r),r}},M=async s=>{try{localStorage.setItem(Ut,JSON.stringify(s)),localStorage.setItem("ar_typing_sync_status","Saving..."),window.dispatchEvent(new Event("adminStoreUpdate"));const r=(await Promise.all([hr("settings",{settings:s.settings,categories:s.categories,plans:s.plans,packages:s.packages}),hr("content",{exams:s.exams,rules:s.rules,passages:s.passages,examProfiles:s.examProfiles,contentLibrary:s.contentLibrary,courses:s.courses,cptTests:s.cptTests,blogs:s.blogs,notifications:s.notifications})])).every(a=>a===!0);return r?localStorage.setItem("ar_typing_sync_status",`Synced: ${new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`):localStorage.setItem("ar_typing_sync_status","Partial Save Fail"),window.dispatchEvent(new Event("adminStoreUpdate")),r}catch(e){return console.error("Critical Save Error:",e),localStorage.setItem("ar_typing_sync_status","Sync Failed"),window.dispatchEvent(new Event("adminStoreUpdate")),alert(`Failed to sync changes to server: ${e.message}
Your changes are saved locally but won't appear on the website until sync is successful.`),!1}},Kr=s=>{const e=H();e.users=e.users.filter(r=>r.id.toString()===s.toString()),M(e)},Vr=s=>{const e=H();e.users=e.users.map(r=>r.id.toString()===s.toString()?{...r,status:r.status==="Active"?"Inactive":"Active"}:r),M(e)},Gr=(s,e)=>{const r=H(),a=r.users.findIndex(i=>i.id.toString()===s.toString());return a===-1?null:(r.users[a]={...r.users[a],...e},M(r),r.users[a])},Wo=async(s,e)=>{try{console.log(`Updating Supabase User ${s}:`,e);const r={};e.name&&(r.name=e.name),e.plan&&(r.plan=e.plan),e.role&&(r.role=e.role),e.status&&(r.status=e.status),e.purchasedPackIds&&(r.purchasedPackIds=e.purchasedPackIds);const{error:a}=await q.from("profiles").update(r).eq("id",s);return a?(console.error("Supabase Update Error:",a),!1):(Gr(s,e),!0)}catch(r){return console.error("Exception updating app user:",r),!1}},Ko=async s=>{const{error:e}=await q.auth.resetPasswordForEmail(s,{redirectTo:window.location.origin+"/login#reset=true"});return e?{success:!1,msg:e.message}:{success:!0,msg:`Password reset email sent to ${s}`}},Vo=async()=>{try{const{data:s,error:e}=await q.from("profiles").select("*").order("created_at",{ascending:!1});return e?(console.error("Error fetching app users:",e),[]):s.map(r=>({...r,joined:r.created_at||r.joined||new Date().toISOString(),plan:r.plan||"Free",role:r.role||"User",status:r.status||"Active",authMethod:r.authMethod||"Email",purchasedPackIds:r.purchasedPackIds||[]}))}catch(s){return console.error("Exception fetching app users:",s),[]}},Jr=s=>s?s.role==="Admin"||s.role==="Super Admin"?!0:s.plan.includes("Pro")||s.plan.includes("Premium"):!1,es=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_EXAM_PROFILE:Dt,INITIAL_CONTENT_LIBRARY:Hr,INITIAL_EXAM_PROFILES:Wr,deleteUser:Kr,fetchAppUsers:Vo,getAdminStore:H,hasProAccess:Jr,saveAdminStore:M,sendPasswordReset:Ko,syncSettingsFromHost:_s,toggleUserStatus:Vr,updateAppUser:Wo,updateUserProfile:Gr},Symbol.toStringTag,{value:"Module"})),Yr=_.createContext(void 0),Qr=typeof window<"u"?window.location.hash:"";console.log("Global Module High-Priority Hash Capture:",Qr);const xs=()=>{const s=_.useContext(Yr);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},Go=({children:s})=>{var m;const[e,r]=_.useState(null),[a,i]=_.useState(!0),[n]=_.useState(()=>Qr||window.location.hash);_.useEffect(()=>{let y=null;return(async()=>{try{const w=n;if(console.log("Captured Mount Hash:",w),w&&(w.includes("access_token=")||w.includes("id_token="))){console.log("Auth fragment detected in URL");const k=new URLSearchParams(w.substring(1).replace(/#/g,"")),S=k.get("access_token"),T=k.get("refresh_token");if(console.log("Tokens found?",!!S,!!T),S==="emergency-bypass"){console.log("Emergency Golden Ticket accepted! Granting Super Admin access..."),localStorage.setItem("tn_admin_bypass","true");const P={id:"emergency-bypass-id",email:"mahijeet@typingnexus.in",name:"Mahijeet",role:"Super Admin",plan:"Premium",status:"Active",joined:new Date().toLocaleDateString()};r(P),window.history.replaceState(null,"",window.location.pathname+window.location.search),i(!1);return}if(S){console.log("Injecting session from URL...");const{data:P,error:F}=await q.auth.setSession({access_token:S,refresh_token:T||""});if(F&&console.error("setSession Error:",F),!F&&P.user){console.log("Session injected successfully for:",P.user.email),window.history.replaceState(null,"",window.location.pathname+window.location.search),await o(P.user.id,P.user.email||""),i(!1);return}}}if(localStorage.getItem("tn_admin_bypass")==="true")r({id:"emergency-bypass-id",email:"mahijeet@typingnexus.in",name:"Mahijeet",role:"Super Admin",plan:"Premium",status:"Active",joined:new Date().toLocaleDateString()}),i(!1);else{const{data:{session:k}}=await q.auth.getSession();k!=null&&k.user&&await o(k.user.id,k.user.email||""),i(!1)}const{data:{subscription:v}}=q.auth.onAuthStateChange(async(k,S)=>{console.log("Auth State Change:",k),S!=null&&S.user?await o(S.user.id,S.user.email||""):k==="SIGNED_OUT"&&(r(null),localStorage.removeItem("tn_admin_bypass")),i(!1)});y=v}catch(w){console.error("Auth Init Error:",w),i(!1)}})(),()=>{y&&y.unsubscribe()}},[]),_.useEffect(()=>{if(!e||!e.id)return;const y=async()=>{try{await q.from("profiles").update({last_seen:new Date().toISOString()}).eq("id",e.id)}catch{}};y();const x=setInterval(y,120*1e3);return()=>clearInterval(x)},[e==null?void 0:e.id]);const o=async(y,x)=>{var w,v,k,S,T;try{let P=x||"",F="",me="";if(P)console.log("Using passed email:",P);else{const{data:{user:D}}=await q.auth.getUser();P=(D==null?void 0:D.email)||"",me=(D==null?void 0:D.phone)||"",F=((w=D==null?void 0:D.user_metadata)==null?void 0:w.full_name)||"",console.log("Fetched user data:",{email:P,phone:me,metaName:F})}const{data:L,error:ae}=await q.from("profiles").select("*").eq("id",y).single(),fe=(P==null?void 0:P.toLowerCase())==="mahijeet@typingnexus.in"||(P==null?void 0:P.toLowerCase().includes("mahijeet"))||((v=L==null?void 0:L.name)==null?void 0:v.toLowerCase())==="mahijeet"||((k=L==null?void 0:L.email)==null?void 0:k.toLowerCase())==="mahijeet@typingnexus.in"||F.toLowerCase()==="mahijeet"||me==="+919876543210"||y==="emergency-bypass-id";if(console.log("Is Mahijeet?",fe,"UID:",y,"Email:",P),ae||!L){if(console.log("Profile missing or error:",ae==null?void 0:ae.message),fe){console.log("Mahijeet detected! Granting immediate session access."),r({id:y,email:P||"mahijeet@typingnexus.in",name:"Mahijeet",role:"Super Admin",plan:"Premium",status:"Active",joined:new Date().toLocaleDateString()}),q.from("profiles").insert([{id:y,email:P||"mahijeet@typingnexus.in",name:"Mahijeet",role:"Super Admin",plan:"Premium",status:"Active",joined:new Date().toLocaleDateString()}]).then(({error:D})=>{D&&console.error("Silent profile creation error:",D)});return}if((ae==null?void 0:ae.code)==="PGRST116"||!L){const D=new URLSearchParams(window.location.hash.substring(1)),{data:{user:C}}=await q.auth.getUser(),V=((S=C==null?void 0:C.user_metadata)==null?void 0:S.full_name)||((T=C==null?void 0:C.user_metadata)==null?void 0:T.name)||(P?P.split("@")[0]:"User"),G={id:y,email:P,name:V,role:"User",plan:"Free",status:"Active",joined:new Date().toLocaleDateString(),last_seen:new Date().toISOString()},{error:I}=await q.from("profiles").upsert([G]);I&&console.error("Profile creation error:",I),r(G)}return}if(fe&&L.role!=="Super Admin"){console.log("Promoting Mahijeet profile...");const D={...L,role:"Super Admin",plan:"Premium"};r(D),q.from("profiles").update({role:"Super Admin",plan:"Premium"}).eq("id",y).then(({error:C})=>{C&&console.error("Promotion DB error:",C)});return}r({...L,joined:L.joined||(L.created_at?new Date(L.created_at).toLocaleDateString():new Date().toLocaleDateString())})}catch(P){console.error("fetchProfile Exception:",P)}},l=async(y,x)=>{if((y.toLowerCase()==="mahijeet"||y.toLowerCase()==="mahijeet@typingnexus.in")&&x==="Ramjiram@555999"){localStorage.setItem("tn_admin_bypass","true");const k={id:"emergency-bypass-id",email:"mahijeet@typingnexus.in",name:"Mahijeet",role:"Super Admin",plan:"Premium",status:"Active",joined:new Date().toLocaleDateString()};return r(k),{success:!0}}const{data:w,error:v}=await q.auth.signInWithPassword({email:y,password:x});return v?{success:!1,error:v.message}:(w.user&&await o(w.user.id,w.user.email||""),{success:!0})},c=async(y,x,w)=>{const{data:v,error:k}=await q.auth.signUp({email:x,password:w,options:{data:{full_name:y}}});if(k)return{success:!1,error:k.message};if(v.user){const S=x.toLowerCase()==="mahijeet@typingnexus.in"||y.toLowerCase()==="mahijeet",{error:T}=await q.from("profiles").insert([{id:v.user.id,name:y,email:x,role:S?"Super Admin":"User",status:"Active",plan:S?"Premium":"Free",joined:new Date().toLocaleDateString()}]);T&&console.error("Error creating profile:",T),await o(v.user.id,x)}return{success:!0}},h=async y=>{const{error:x}=await q.auth.resend({type:"signup",email:y});return x?{success:!1,error:x.message}:{success:!0}},d=async()=>{const{error:y}=await q.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin+"/profile"}});return y?{success:!1,error:y.message}:{success:!0}},f=async y=>{const{error:x}=await q.auth.signInWithOtp({phone:y});return x?{success:!1,error:x.message}:{success:!0}},g=async(y,x)=>{const{data:w,error:v}=await q.auth.verifyOtp({phone:y,token:x,type:"sms"});return v?{success:!1,error:v.message}:(w.user&&await o(w.user.id,w.user.email||w.user.phone||""),{success:!0})},p=async()=>{localStorage.removeItem("tn_admin_bypass"),await q.auth.signOut(),r(null)},u=async y=>{if(!e)return!1;const{data:x,error:w}=await q.from("profiles").update(y).eq("id",e.id).select().single();return w?(console.error("Update profile error:",w),!1):x?(r({...x,joined:x.joined||(x.created_at?new Date(x.created_at).toLocaleDateString():new Date().toLocaleDateString())}),!0):!1},b={currentUser:e,isAuthenticated:!!e,isAdmin:(e==null?void 0:e.role)==="Admin"||(e==null?void 0:e.role)==="Super Admin"||(e==null?void 0:e.email)==="mahijeet@typingnexus.in"||((m=e==null?void 0:e.name)==null?void 0:m.toLowerCase())==="mahijeet",hasPremiumAccess:Jr(e),login:l,signup:c,logout:p,updateProfile:u,resendConfirmationEmail:h,signInWithGoogle:d,signInWithPhone:f,verifyPhoneOtp:g};return t.jsx(Yr.Provider,{value:b,children:!a&&s})},Jo=()=>{const{login:s,signup:e,isAdmin:r,isAuthenticated:a}=xs(),i=mr(),[n,o]=_.useState(""),[l,c]=_.useState(""),[h,d]=_.useState(null),[f,g]=_.useState(!1),[p,u]=_.useState(!1),b=()=>{u(!p),d(null),p?o(""):(o("mahijeet@typingnexus.in"),c(""))},m=async w=>{w.preventDefault(),g(!0);try{const v="mahijeet@typingnexus.in",k=await e("Mahijeet",v,l);k.success?(alert("Admin account created successfully! Please log in now."),u(!1),o(v),c("")):(alert("Creation Failed: "+k.error),d(k.error||"Creation failed"))}catch(v){alert("Error: "+v.message),d(v.message)}g(!1)};_.useEffect(()=>{if(a&&r){const w=window.location.pathname.startsWith("/admin");i(w?"/admin":"/dashboard")}},[a,r,i]);const y=async w=>{w.preventDefault(),d(null),g(!0);let v=n;n.toLowerCase()==="mahijeet"&&(v="mahijeet@typingnexus.in");try{const S=await s(v,l);if(S.success){const P=window.location.pathname.startsWith("/admin")?"/admin":"/dashboard";console.log("DEBUG [AdminLogin] Login Success, Navigating to:",P),i(P);return}if(!S.success){const T=S.error||"Invalid credentials";d(T),g(!1)}g(!1)}catch(S){alert("Login Exception: "+(S.message||String(S))),d("An unexpected error occurred. Please try again."),g(!1)}},{currentUser:x}=xs();return At.useEffect(()=>{if(x&&!r&&f){const w=setTimeout(()=>{f&&(d("Login successful, but you do not have Admin permissions."),g(!1))},3e3);return()=>clearTimeout(w)}},[x,r,f]),t.jsxs("div",{className:"min-h-screen bg-gray-950 flex flex-col items-center justify-center font-sans relative overflow-hidden",children:[t.jsx("div",{className:"absolute top-0 left-0 w-[500px] h-[500px] bg-brand-purple/20 blur-[120px] rounded-full pointer-events-none -translate-x-1/2 -translate-y-1/2"}),t.jsx("div",{className:"absolute bottom-0 right-0 w-[500px] h-[500px] bg-cyan-500/10 blur-[120px] rounded-full pointer-events-none translate-x-1/2 translate-y-1/2"}),t.jsxs("div",{className:"mb-8 relative z-10 flex flex-col items-center",children:[t.jsx("div",{className:"w-16 h-16 bg-gray-900 border border-gray-800 text-white rounded-2xl flex items-center justify-center font-bold text-3xl shadow-[0_0_30px_rgba(168,85,247,0.3)] mb-4",children:"TN"}),t.jsxs("h1",{className:"font-display font-bold text-3xl tracking-tight text-white",children:["Secure",t.jsx("span",{className:"text-brand-purple",children:"Portal"})]}),t.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Restricted Access  Authorized Personnel Only"})]}),t.jsxs("div",{className:"w-full max-w-[400px] bg-gray-900/60 backdrop-blur-xl p-8 border border-gray-800 rounded-2xl shadow-2xl relative z-10",children:[h&&t.jsxs("div",{className:"mb-6 p-4 bg-red-900/20 border border-red-500/30 rounded-lg text-sm text-red-200 flex items-start gap-3",children:[t.jsx(ma,{size:18,className:"text-red-500 shrink-0 mt-0.5"}),t.jsx("span",{children:h})]}),p?t.jsxs("form",{onSubmit:m,className:"space-y-5 relative z-10",children:[t.jsxs("div",{className:"p-4 bg-blue-900/10 border border-blue-900/30 text-blue-200 text-xs rounded-xl mb-4 italic",children:[t.jsx("span",{className:"font-bold",children:"System Initialization:"})," Registering primary admin role for ",t.jsx("strong",{className:"text-blue-400",children:"mahijeet@typingnexus.in"}),"."]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2",children:"Create Security Key"}),t.jsx("input",{type:"password",value:l,onChange:w=>c(w.target.value),className:"w-full px-4 py-3 bg-gray-950 border border-gray-800 rounded-xl text-sm text-white outline-none focus:border-brand-purple transition-all",placeholder:"Minimum 8 characters",required:!0,minLength:8})]}),t.jsxs("div",{className:"flex items-center justify-end gap-4 pt-2",children:[t.jsx("button",{type:"button",onClick:b,className:"text-xs text-gray-500 font-bold hover:text-white transition-colors",children:"ABORT"}),t.jsx("button",{type:"submit",disabled:f,className:"bg-green-600 hover:bg-green-500 text-white px-8 py-3 rounded-xl text-sm font-bold shadow-[0_0_20px_rgba(34,197,94,0.3)] transition-all disabled:opacity-50",children:f?"INITIALIZING...":"CREATE ADMIN"})]})]}):t.jsxs("form",{onSubmit:y,className:"space-y-6",noValidate:!0,autoComplete:"off",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Identity"}),t.jsxs("div",{className:"relative group",children:[t.jsx(fa,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 group-focus-within:text-brand-purple transition-colors"}),t.jsx("input",{type:"text",name:"admin_username_field_no_autofill",value:n,onChange:w=>o(w.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-600 outline-none focus:border-brand-purple focus:ring-1 focus:ring-brand-purple transition-all text-sm font-medium",placeholder:"Username or Email",required:!0,autoComplete:"off"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Security Key"}),t.jsxs("div",{className:"relative group",children:[t.jsx(xa,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 group-focus-within:text-brand-purple transition-colors"}),t.jsx("input",{type:"password",name:"admin_password_field_no_autofill",value:l,onChange:w=>c(w.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg text-white placeholder-gray-600 outline-none focus:border-brand-purple focus:ring-1 focus:ring-brand-purple transition-all text-sm font-medium",placeholder:"Password",required:!0,autoComplete:"new-password"})]})]}),t.jsxs("div",{className:"flex items-center justify-between pt-2",children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4 border-gray-700 rounded bg-gray-800 text-brand-purple focus:ring-offset-gray-900"}),t.jsx("span",{className:"text-xs text-gray-400 group-hover:text-gray-300 transition-colors font-medium",children:"Remember Session"})]}),t.jsxs("button",{type:"button",onClick:b,className:"text-xs text-brand-purple font-bold hover:text-white transition-colors",children:["First Time? ",t.jsx("span",{className:"underline",children:"Setup Admin"})]})]}),t.jsx("button",{type:"submit",disabled:f,className:"w-full bg-gradient-to-r from-brand-purple to-purple-600 hover:from-purple-500 hover:to-purple-500 text-white py-3 rounded-lg text-sm font-bold shadow-[0_0_20px_rgba(168,85,247,0.4)] hover:shadow-[0_0_30px_rgba(168,85,247,0.6)] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:f?"Authenticating...":t.jsxs(t.Fragment,{children:["Access System ",t.jsx(Ps,{size:16})]})})]})]}),t.jsxs("div",{className:"mt-8 flex flex-col items-center gap-4 relative z-10",children:[t.jsxs("a",{href:"/",className:"text-xs font-bold text-gray-500 hover:text-brand-purple transition-colors flex items-center gap-2 px-4 py-2 rounded-full border border-transparent hover:border-gray-800 hover:bg-gray-900",children:[t.jsx(Ps,{size:12,className:"rotate-180"})," Return to Website"]}),t.jsx("p",{className:"text-[10px] text-gray-600 font-mono",children:"SECURED CONNECTION  v2.5.0 (Secure)"})]})]})},Yo="modulepreload",Qo=function(s){return"/"+s},pr={},Et=function(e,r,a){let i=Promise.resolve();if(r&&r.length>0){let o=function(h){return Promise.all(h.map(d=>Promise.resolve(d).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=o(r.map(h=>{if(h=Qo(h),h in pr)return;pr[h]=!0;const d=h.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${f}`))return;const g=document.createElement("link");if(g.rel=d?"stylesheet":Yo,d||(g.as="script"),g.crossOrigin="",g.href=h,c&&g.setAttribute("nonce",c),document.head.appendChild(g),d)return new Promise((p,u)=>{g.addEventListener("load",p),g.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${h}`)))})}))}function n(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&n(l.reason);return e().catch(n)})},Xr="tn_admin_logs",bs=()=>{try{const s=localStorage.getItem(Xr);return s?JSON.parse(s):[]}catch{return[]}},Zr=s=>{try{const e=bs(),r={...s,id:Date.now().toString(),timestamp:new Date().toISOString()},a=[r,...e].slice(0,100);return localStorage.setItem(Xr,JSON.stringify(a)),r}catch(e){return console.error("Failed to save log",e),null}},Xo=()=>{var g;const s=H(),[e,r]=_.useState(s.cptTests),[a,i]=_.useState(null),[n,o]=_.useState("list"),l=()=>{if(!a)return;const p=a.id?e.map(u=>u.id===a.id?a:u):[...e,{...a,id:Date.now()}];s.cptTests=p,M(s),r(p),i(null),o("list")},c=p=>{if(!window.confirm("Are you sure you want to delete this test?"))return;const u=e.filter(b=>b.id!==p);s.cptTests=u,M(s),r(u)},h=()=>{i({id:0,title:"New Test",type:"Word",language:"Bilingual",tasks:[],questions:[],data:[],content:"",instructions:""}),o("edit")};return t.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"CPT Test Manager"}),n==="list"&&t.jsxs("button",{onClick:h,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:[t.jsx(ue,{size:18})," Add New Test"]})]}),n==="list"?t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-100 border-b",children:[t.jsx("th",{className:"p-3 font-semibold",children:"ID"}),t.jsx("th",{className:"p-3 font-semibold",children:"Title"}),t.jsx("th",{className:"p-3 font-semibold",children:"Type"}),t.jsx("th",{className:"p-3 font-semibold",children:"Questions/Tasks"}),t.jsx("th",{className:"p-3 font-semibold",children:"Actions"})]})}),t.jsxs("tbody",{children:[e.map(p=>{var u,b;return t.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[t.jsx("td",{className:"p-3",children:p.id}),t.jsx("td",{className:"p-3 font-medium",children:p.title}),t.jsx("td",{className:"p-3",children:t.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${p.type==="Excel"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:p.type})}),t.jsx("td",{className:"p-3",children:p.type==="Excel"?((u=p.tasks)==null?void 0:u.length)||0:((b=p.questions)==null?void 0:b.length)||0}),t.jsxs("td",{className:"p-3 flex gap-2",children:[t.jsx("button",{onClick:()=>{i(p),o("edit")},className:"text-blue-600 hover:text-blue-800",title:"Edit",children:t.jsx($t,{size:18})}),t.jsx("button",{onClick:()=>c(p.id),className:"text-red-600 hover:text-red-800",title:"Delete",children:t.jsx(oe,{size:18})})]})]},p.id)}),e.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:5,className:"p-4 text-center text-gray-500",children:"No tests found. Create one!"})})]})]})}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Title"}),t.jsx("input",{type:"text",value:a==null?void 0:a.title,onChange:p=>i(u=>u?{...u,title:p.target.value}:null),className:"mt-1 block w-full border border-gray-300 rounded-md p-2"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Type"}),t.jsxs("select",{value:a==null?void 0:a.type,onChange:p=>i(u=>u?{...u,type:p.target.value}:null),className:"mt-1 block w-full border border-gray-300 rounded-md p-2",children:[t.jsx("option",{value:"Word",children:"Word Formatting"}),t.jsx("option",{value:"Excel",children:"Excel Spreadsheet"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Instructions"}),t.jsx("textarea",{value:(a==null?void 0:a.instructions)||"",onChange:p=>i(u=>u?{...u,instructions:p.target.value}:null),className:"mt-1 block w-full border border-gray-300 rounded-md p-2 h-20"})]}),(a==null?void 0:a.type)==="Word"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Content (HTML)"}),t.jsx("textarea",{value:(a==null?void 0:a.content)||"",onChange:p=>i(u=>u?{...u,content:p.target.value}:null),className:"mt-1 block w-full border border-gray-300 rounded-md p-2 h-32 font-mono text-sm",placeholder:"<p>Enter document content here...</p>"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Use HTML tags like <p>, <b>, <table> etc."})]}),(a==null?void 0:a.type)==="Excel"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Initial Data (JSON)"}),t.jsx("textarea",{value:JSON.stringify((a==null?void 0:a.data)||[],null,2),onChange:p=>{try{const u=JSON.parse(p.target.value);i(b=>b?{...b,data:u}:null)}catch{}},className:"mt-1 block w-full border border-gray-300 rounded-md p-2 h-32 font-mono text-sm"}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Array of objects: ",'[{"id":1, "name":"Header", "val1":"Value"}]']})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:(a==null?void 0:a.type)==="Excel"?"Tasks":"Formatting Questions"}),t.jsx("button",{onClick:()=>{const p={id:Date.now(),text:"",textHi:"",marks:2};(a==null?void 0:a.type)==="Excel"?i(u=>u?{...u,tasks:[...u.tasks||[],p]}:null):i(u=>u?{...u,questions:[...u.questions||[],p]}:null)},className:"text-xs bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded",children:"+ Add Question"})]}),t.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto border p-2 rounded bg-gray-50",children:(g=(a==null?void 0:a.type)==="Excel"?a.tasks:a==null?void 0:a.questions)==null?void 0:g.map((p,u)=>t.jsxs("div",{className:"bg-white p-2 rounded border flex gap-2 items-start",children:[t.jsxs("span",{className:"text-xs font-bold w-6 pt-2",children:[u+1,"."]}),t.jsxs("div",{className:"flex-grow space-y-1",children:[t.jsx("input",{placeholder:"Question English",value:p.text,onChange:b=>{const m={...p,text:b.target.value};d(u,m)},className:"w-full text-sm border rounded p-1"}),t.jsx("input",{placeholder:"Question Hindi (Optional)",value:p.textHi||"",onChange:b=>{const m={...p,textHi:b.target.value};d(u,m)},className:"w-full text-sm border rounded p-1 bg-orange-50"})]}),t.jsx("div",{className:"w-16",children:t.jsx("input",{type:"number",value:p.marks,onChange:b=>{const m={...p,marks:Number(b.target.value)};d(u,m)},className:"w-full text-sm border rounded p-1",placeholder:"Marks"})}),t.jsx("button",{onClick:()=>f(u),className:"text-red-500 hover:text-red-700 p-1",children:t.jsx(_e,{size:16})})]},u))})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:()=>o("list"),className:"px-4 py-2 border rounded text-gray-600 hover:bg-gray-100",children:"Cancel"}),t.jsxs("button",{onClick:l,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center gap-2",children:[t.jsx(gt,{size:18})," Save Test"]})]})]})]});function d(p,u){i(b=>{if(!b)return null;const m=b.type==="Excel",y=m?[...b.tasks||[]]:[...b.questions||[]];return y[p]=u,m?{...b,tasks:y}:{...b,questions:y}})}function f(p){i(u=>{if(!u)return null;const b=u.type==="Excel",m=b?[...u.tasks||[]]:[...u.questions||[]];return m.splice(p,1),b?{...u,tasks:m}:{...u,questions:m}})}},Zo=()=>{var u,b;const[s,e]=_.useState(H()),[r,a]=_.useState("English"),[i,n]=_.useState(!1),[o,l]=_.useState(""),[c,h]=_.useState({title:"",text:"",language:"English",font:"Sans",difficulty:"Medium",tags:["Common"]}),d=()=>{e(H())},f=(s.contentLibrary||[]).filter(m=>m.language===r&&(m.title.toLowerCase().includes(o.toLowerCase())||m.text.substring(0,50).toLowerCase().includes(o.toLowerCase()))),g=()=>{if(!c.title||!c.text){alert("Title and Text are required!");return}const m={id:Date.now().toString(),title:c.title,text:c.text,language:r,font:r==="Hindi"?c.font||"Mangal":"Sans",difficulty:c.difficulty||"Medium",tags:c.tags||["Common"],uploadDate:new Date().toISOString()},y=[...s.contentLibrary||[],m];M({...s,contentLibrary:y}),n(!1),h({title:"",text:"",language:r,font:r==="Hindi"?"Mangal":"Sans",difficulty:"Medium",tags:["Common"]}),d()},p=m=>{if(confirm("Are you sure you want to delete this content?")){const y=(s.contentLibrary||[]).filter(x=>x.id!==m);M({...s,contentLibrary:y}),d()}};return t.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold font-display text-white mb-1",children:"Centralized Content Library"}),t.jsxs("p",{className:"text-gray-400 text-sm",children:["Manage typing paragraphs for ",r," exams."]})]}),t.jsxs("button",{onClick:()=>n(!0),className:"bg-brand-purple hover:bg-purple-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors shadow-lg shadow-purple-900/20",children:[t.jsx(ue,{size:18})," Add New Content"]})]}),t.jsxs("div",{className:"flex p-1 bg-gray-900/50 backdrop-blur-sm border border-gray-800 rounded-xl w-fit",children:[t.jsxs("button",{onClick:()=>a("English"),className:`px-6 py-2 rounded-lg text-sm font-bold transition-all flex items-center gap-2 ${r==="English"?"bg-gray-800 text-white shadow-sm":"text-gray-500 hover:text-gray-300"}`,children:[t.jsx(Tt,{size:16})," English Library"]}),t.jsxs("button",{onClick:()=>a("Hindi"),className:`px-6 py-2 rounded-lg text-sm font-bold transition-all flex items-center gap-2 ${r==="Hindi"?"bg-gray-800 text-white shadow-sm":"text-gray-500 hover:text-gray-300"}`,children:[t.jsx("span",{className:"font-mangal",children:""})," Library"]})]}),t.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl overflow-hidden backdrop-blur-sm",children:[t.jsxs("div",{className:"p-4 border-b border-gray-800 flex gap-4",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(ys,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:16}),t.jsx("input",{type:"text",placeholder:`Search ${r} content...`,value:o,onChange:m=>l(m.target.value),className:"w-full bg-gray-800 border-none rounded-lg pl-10 pr-4 py-2 text-sm text-gray-200 focus:ring-1 focus:ring-brand-purple placeholder:text-gray-600"})]}),t.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-xs font-bold uppercase tracking-wider px-3 bg-gray-800/50 rounded-lg border border-gray-800",children:[t.jsx(fr,{size:14})," ",f.length," Items"]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-sm text-left",children:[t.jsx("thead",{className:"bg-gray-800/50 text-gray-400 font-bold uppercase text-[10px] tracking-widest",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3",children:"Title"}),t.jsx("th",{className:"px-6 py-3",children:"Preview"}),t.jsx("th",{className:"px-6 py-3",children:"Properties"}),t.jsx("th",{className:"px-6 py-3",children:"Date"}),t.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-800",children:f.length>0?f.map(m=>t.jsxs("tr",{className:"hover:bg-gray-800/30 transition-colors group",children:[t.jsxs("td",{className:"px-6 py-4 font-bold text-gray-200",children:[m.title,t.jsx("div",{className:"flex gap-1 mt-1",children:m.tags.map(y=>t.jsx("span",{className:"px-1.5 py-0.5 bg-gray-800 text-[10px] text-gray-500 rounded border border-gray-700",children:y},y))})]}),t.jsxs("td",{className:"px-6 py-4 text-gray-400 max-w-xs truncate font-mono text-xs opacity-70",children:[m.text.substring(0,50),"..."]}),t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-800 w-fit rounded border border-gray-700 text-gray-400",children:m.font}),t.jsx("span",{className:`text-xs px-2 py-0.5 w-fit rounded border ${m.difficulty==="Hard"?"bg-red-900/20 text-red-500 border-red-900/30":m.difficulty==="Medium"?"bg-yellow-900/20 text-yellow-500 border-yellow-900/30":"bg-green-900/20 text-green-500 border-green-900/30"}`,children:m.difficulty})]})}),t.jsx("td",{className:"px-6 py-4 text-gray-500 text-xs",children:new Date(m.uploadDate).toLocaleDateString()}),t.jsx("td",{className:"px-6 py-4 text-right",children:t.jsx("button",{onClick:()=>p(m.id),className:"p-2 hover:bg-red-900/20 text-gray-500 hover:text-red-400 rounded-lg transition-colors",children:t.jsx(oe,{size:16})})})]},m.id)):t.jsx("tr",{children:t.jsx("td",{colSpan:5,className:"px-6 py-8 text-center text-gray-500",children:'No content found. Click "Add New Content" to create one.'})})})]})})]}),i&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",children:t.jsxs("div",{className:"bg-[#0f0f13] border border-gray-800 rounded-xl w-full max-w-2xl shadow-2xl overflow-hidden",children:[t.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-800 bg-gray-900/50",children:[t.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[t.jsx(Ze,{className:"text-brand-purple",size:20}),"Add ",r," Content"]}),t.jsx("button",{onClick:()=>n(!1),className:"text-gray-500 hover:text-white transition-colors",children:t.jsx(_e,{size:20})})]}),t.jsxs("div",{className:"p-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1.5",children:"Title"}),t.jsx("input",{className:"w-full bg-gray-900 border border-gray-800 rounded-lg px-4 py-2.5 text-gray-200 focus:border-brand-purple focus:ring-1 focus:ring-brand-purple outline-none transition-all placeholder:text-gray-600",placeholder:"e.g. Gandhi Jayanti Speech",value:c.title,onChange:m=>h({...c,title:m.target.value})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1.5",children:"Font"}),t.jsxs("select",{className:"w-full bg-gray-900 border border-gray-800 rounded-lg px-4 py-2.5 text-gray-200 outline-none focus:border-brand-purple",value:c.font,onChange:m=>h({...c,font:m.target.value}),disabled:r==="English",children:[t.jsx("option",{value:"Sans",children:"Sans Serif (English)"}),t.jsx("option",{value:"Mangal",children:"Mangal (Remington/Inscript)"}),t.jsx("option",{value:"KrutiDev",children:"KrutiDev 10"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1.5",children:"Difficulty"}),t.jsxs("select",{className:"w-full bg-gray-900 border border-gray-800 rounded-lg px-4 py-2.5 text-gray-200 outline-none focus:border-brand-purple",value:c.difficulty,onChange:m=>h({...c,difficulty:m.target.value}),children:[t.jsx("option",{value:"Easy",children:"Easy"}),t.jsx("option",{value:"Medium",children:"Medium"}),t.jsx("option",{value:"Hard",children:"Hard"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1.5",children:"Paragraph Content"}),t.jsx("textarea",{className:`w-full bg-gray-900 border border-gray-800 rounded-lg px-4 py-3 text-gray-200 focus:border-brand-purple focus:ring-1 focus:ring-brand-purple outline-none transition-all min-h-[200px] placeholder:text-gray-600 ${r==="Hindi"&&c.font==="Mangal"?"font-mangal":"font-mono"}`,placeholder:"Paste your paragraph text here...",value:c.text,onChange:m=>h({...c,text:m.target.value})}),t.jsxs("p",{className:"text-xs text-gray-600 mt-1 text-right",children:[((u=c.text)==null?void 0:u.length)||0," characters | ",((b=c.text)==null?void 0:b.split(/\s+/).length)||0," words"]})]})]}),t.jsxs("div",{className:"p-6 border-t border-gray-800 bg-gray-900/30 flex justify-end gap-3",children:[t.jsx("button",{onClick:()=>n(!1),className:"px-5 py-2.5 rounded-lg text-gray-400 font-bold hover:text-white hover:bg-gray-800 transition-colors",children:"Cancel"}),t.jsxs("button",{onClick:g,className:"px-6 py-2.5 rounded-lg bg-brand-purple text-white font-bold hover:bg-purple-600 transition-all shadow-[0_0_20px_rgba(168,85,247,0.3)] hover:shadow-[0_0_25px_rgba(168,85,247,0.5)] flex items-center gap-2",children:[t.jsx(gt,{size:18})," Save Content"]})]})]})})]})},Y=({label:s,value:e,options:r,onChange:a})=>t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 ml-1",children:s}),t.jsxs("div",{className:"relative group",children:[t.jsx("select",{value:e,onChange:i=>a(i.target.value),className:"w-full bg-gray-900/50 border border-gray-800 text-gray-200 rounded-xl px-4 py-3 appearance-none focus:outline-none focus:ring-2 focus:ring-brand-purple/20 focus:border-brand-purple transition-all text-sm cursor-pointer hover:bg-gray-800/50 group-hover:border-gray-700",children:r.map(i=>t.jsx("option",{value:i.value,className:"bg-gray-900 text-gray-200",children:i.label},i.value))}),t.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500 group-hover:text-brand-purple transition-colors",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]})]}),ie=({label:s,value:e,onChange:r,min:a,max:i,step:n})=>t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 ml-1",children:s}),t.jsx("input",{type:"number",value:e,onChange:o=>r(Number(o.target.value)),min:a,max:i,step:n,className:"w-full bg-gray-900/50 border border-gray-800 text-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-brand-purple/20 focus:border-brand-purple transition-all text-sm hover:bg-gray-800/50"})]}),Ae=({title:s,children:e})=>t.jsxs("section",{className:"mt-12 mb-8 p-6 bg-gray-950/50 border border-gray-800 rounded-2xl relative overflow-hidden group hover:border-brand-purple/50 transition-all duration-300",children:[t.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-brand-purple/20 group-hover:bg-brand-purple transition-all duration-300"}),t.jsxs("h2",{className:"text-xl font-display font-bold text-white mb-6 flex items-center gap-3",children:[t.jsx("span",{className:"text-brand-purple font-mono opacity-50",children:"#"}),s]}),t.jsx("div",{className:"space-y-4",children:e})]}),gr={profileName:"",description:"",calculationParam:"net_wpm",wordCalculation:"5char",minEligibilityType:"none",languageMode:"fixed",hindiFont:"none",hindiComplexity:"standard",allowAltCodes:!1,hindiStenoAvailable:!1,errorClassification:"simple",ignoredErrorLimit:0,penaltyMultiplier:0,penaltyMethod:"none",finalScoreCalc:"direct",scoreDisplay:"2dec",showAccuracy:!0,stenoEnabled:!1,durationMin:10,practiceSession:"none",breakDurationSec:0,backspaceEnabled:!0,arrowKeysEnabled:!0,highlight:"word",showFingerPosition:!1,showOnscreenKeyboard:!1,liveErrors:!0,showSpeedDuringTest:!1,minKeystrokes:0,categoryWiseEnabled:!1,scribeAllowed:!1,examType:"recruitment",resultDisplay:"detailed"},el=({initialProfile:s,onSave:e,onCancel:r})=>{var f,g,p;const[a,i]=_.useState(s||gr),n=(u,b)=>{i(m=>({...m,[u]:b}))},o=(u,b,m)=>{i(y=>{const x=y[u]||[],w=m?[...x,b]:x.filter(v=>v!==b);return{...y,[u]:w}})},l=()=>{const u={category:"UR"};i(b=>({...b,categoryRules:[...b.categoryRules||[],u]}))},c=(u,b,m)=>{i(y=>{const x=[...y.categoryRules||[]];return x[u]={...x[u],[b]:m},{...y,categoryRules:x}})},h=u=>{var y;const b=(y=u.target.files)==null?void 0:y[0];if(!b)return;const m=new FileReader;m.onload=x=>{var w;try{const v=JSON.parse((w=x.target)==null?void 0:w.result);v.profileName||v.calculationParam?i({...gr,...v}):alert("Invalid JSON format for Exam Profile.")}catch{alert("Error parsing JSON file.")}},m.readAsText(b)},d=u=>{i(b=>({...b,categoryRules:(b.categoryRules||[]).filter((m,y)=>y!==u)}))};return t.jsxs("div",{className:"max-w-4xl mx-auto pb-20 mt-10 px-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-3xl font-display font-bold text-white tracking-tight flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-brand-purple/20 rounded-lg",children:t.jsx(vs,{className:"text-brand-purple",size:24})}),"Configure ",t.jsx("span",{className:"text-brand-purple",children:"Exam Profile"})]}),t.jsx("p",{className:"text-gray-500 text-sm mt-2 ml-14",children:"Define specialized rules for calculation, penalties, and interface controls."})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("label",{className:"flex items-center gap-2 px-5 py-2.5 bg-cyan-900/20 border border-cyan-800/50 text-cyan-400 hover:bg-cyan-900/40 rounded-xl font-bold transition-all cursor-pointer",children:[t.jsx(St,{size:18})," Import JSON",t.jsx("input",{type:"file",accept:".json",className:"hidden",onChange:h})]}),t.jsxs("button",{type:"button",onClick:r,className:"flex items-center gap-2 px-5 py-2.5 bg-gray-900/50 border border-gray-800 text-gray-400 hover:text-white hover:bg-gray-800 rounded-xl font-bold transition-all",children:[t.jsx(_e,{size:18})," Cancel"]}),t.jsxs("button",{type:"button",onClick:()=>e(a),className:"flex items-center gap-2 px-6 py-2.5 bg-brand-purple hover:bg-purple-600 text-white rounded-xl font-bold shadow-[0_0_20px_rgba(168,85,247,0.3)] transition-all transform hover:scale-105",children:[t.jsx(gt,{size:18})," Save Profile"]})]})]}),t.jsxs("form",{onSubmit:u=>u.preventDefault(),className:"space-y-0 text-left",children:[t.jsx(Ae,{title:"Basic Identity",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 ml-1",children:"Profile Name"}),t.jsx("input",{type:"text",placeholder:"e.g., SSC CGL Typing Rule",value:a.profileName,onChange:u=>n("profileName",u.target.value),className:"w-full bg-gray-900/50 border border-gray-800 text-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-brand-purple/20 focus:border-brand-purple transition-all text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 ml-1",children:"Internal Description"}),t.jsx("textarea",{placeholder:"Mention specific exam department rules here...",value:a.description,onChange:u=>n("description",u.target.value),className:"w-full bg-gray-900/50 border border-gray-800 text-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-brand-purple/20 focus:border-brand-purple transition-all text-sm h-24"})]})]})}),t.jsxs(Ae,{title:"1. PRIMARY MODE",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(Y,{label:"Calculation Parameter",value:a.calculationParam,options:[{value:"net_wpm",label:"Net WPM"},{value:"gross_kdph",label:"Gross KDPH"},{value:"gross_kph",label:"Gross KPH"}],onChange:u=>n("calculationParam",u)}),t.jsx(Y,{label:"Word Calculation Method",value:a.wordCalculation,options:[{value:"5char",label:"5 Characters = 1 Word"},{value:"actual",label:"Actual Word Count"}],onChange:u=>n("wordCalculation",u)})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(Y,{label:"Minimum Eligibility",value:a.minEligibilityType,options:[{value:"none",label:"None"},{value:"fixed_wpm",label:"Fixed WPM"},{value:"fixed_kdph",label:"Fixed KDPH"}],onChange:u=>n("minEligibilityType",u)}),a.minEligibilityType!=="none"&&t.jsx(ie,{label:`Target ${a.minEligibilityType==="fixed_wpm"?"WPM":"KDPH"}`,value:a.minEligibilityValue||0,onChange:u=>n("minEligibilityValue",u)})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(ie,{label:"Min. Keystrokes (incl. spaces)",value:a.minKeystrokes||0,onChange:u=>n("minKeystrokes",u)}),t.jsx("div",{className:"flex items-end",children:t.jsx("p",{className:"text-[10px] text-gray-500 pb-2",children:"If user types fewer keystrokes than this, they are automatically disqualified. Set 0 to disable."})})]}),t.jsxs("div",{className:"border-t border-gray-800/50 pt-4 mt-2",children:[t.jsx(Y,{label:"Language Selection Mode",value:a.languageMode,options:[{value:"fixed",label:"Fixed Language"},{value:"candidate",label:"Candidate's Choice"},{value:"default_with_change",label:"Default with Option to Change"}],onChange:u=>n("languageMode",u)}),a.languageMode==="fixed"&&t.jsx(Y,{label:"Fixed Language",value:a.fixedLanguage||"en",options:[{value:"en",label:"English"},{value:"hi",label:"Hindi"},{value:"both",label:"Both"}],onChange:u=>n("fixedLanguage",u)}),a.languageMode==="candidate"&&t.jsxs("div",{className:"mb-4 bg-gray-900/40 p-4 rounded-xl border border-gray-800",children:[t.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase tracking-widest mb-3",children:"Allowed Languages"}),t.jsxs("div",{className:"flex gap-6",children:[t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",className:"w-5 h-5 rounded border-gray-800 bg-gray-950 text-brand-purple focus:ring-brand-purple/20",checked:(f=a.allowedLanguages)==null?void 0:f.includes("en"),onChange:u=>o("allowedLanguages","en",u.target.checked)}),t.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"English"})]}),t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",className:"w-5 h-5 rounded border-gray-800 bg-gray-950 text-brand-purple focus:ring-brand-purple/20",checked:(g=a.allowedLanguages)==null?void 0:g.includes("hi"),onChange:u=>o("allowedLanguages","hi",u.target.checked)}),t.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"Hindi"})]})]})]}),a.languageMode==="default_with_change"&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-end",children:[t.jsx(Y,{label:"Default Language",value:a.defaultLanguage||"en",options:[{value:"en",label:"English"},{value:"hi",label:"Hindi"}],onChange:u=>n("defaultLanguage",u)}),t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer mb-6 group",children:[t.jsx("input",{type:"checkbox",className:"w-5 h-5 rounded border-gray-800 bg-gray-950 text-brand-purple focus:ring-brand-purple/20",checked:a.allowLanguageChange,onChange:u=>n("allowLanguageChange",u.target.checked)}),t.jsx("span",{className:"text-sm font-bold text-gray-400 group-hover:text-white transition-colors",children:"Allow Candidate to Change"})]})]})]})]}),(a.languageMode!=="fixed"||a.fixedLanguage!=="en")&&t.jsxs(Ae,{title:"2. HINDI TYPING CONFIGURATION",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(Y,{label:"Hindi Font Type",value:a.hindiFont,options:[{value:"mangal",label:"Mangal (Unicode)"},{value:"krutidev",label:"Krutidev"},{value:"devlys",label:"Devlys"},{value:"arial",label:"Arial Unicode MS"},{value:"agra",label:"Agra"},{value:"none",label:"None"}],onChange:u=>n("hindiFont",u)}),a.hindiFont!=="none"&&t.jsx(Y,{label:"Keyboard Layout",value:a.hindiKeyboardLayout||"remington_gail",options:[{value:"remington_gail",label:"Remington Gail"},{value:"inscript",label:"Inscript"},{value:"remington_cbi",label:"Remington CBI"},{value:"typewriter",label:"Typewriter"}],onChange:u=>n("hindiKeyboardLayout",u)})]}),a.hindiFont!=="none"&&t.jsxs(t.Fragment,{children:[t.jsx(Y,{label:"Hindi Complexity Level",value:a.hindiComplexity,options:[{value:"basic",label:"Basic"},{value:"standard",label:"Standard"},{value:"advanced",label:"Advanced"}],onChange:u=>n("hindiComplexity",u)}),t.jsxs("div",{className:"flex flex-wrap gap-6 mt-2",children:[t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",className:"w-5 h-5 rounded border-gray-800 bg-gray-950 text-brand-purple focus:ring-brand-purple/20",checked:a.allowAltCodes,onChange:u=>n("allowAltCodes",u.target.checked)}),t.jsx("span",{className:"text-sm font-bold text-gray-400 group-hover:text-white transition-colors",children:"Allow Alt Codes"})]}),t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",className:"w-5 h-5 rounded border-gray-800 bg-gray-950 text-brand-purple focus:ring-brand-purple/20",checked:a.hindiStenoAvailable,onChange:u=>n("hindiStenoAvailable",u.target.checked)}),t.jsx("span",{className:"text-sm font-bold text-gray-400 group-hover:text-white transition-colors",children:"Shorthand (Steno) Available"})]})]})]})]}),t.jsxs(Ae,{title:"3. ERROR & PENALTY ENGINE",children:[t.jsx(Y,{label:"Error Classification",value:a.errorClassification,options:[{value:"simple",label:"Simple Mistake"},{value:"ssc_aiims",label:"SSC/AIIMS Style (Full & Half)"},{value:"advanced",label:"Advanced Mixed Mode"}],onChange:u=>n("errorClassification",u)}),a.errorClassification==="ssc_aiims"&&t.jsxs("div",{className:"mb-6 bg-gray-900/40 p-5 rounded-xl border border-gray-800",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4 text-brand-purple",children:[t.jsx(Fe,{size:16}),t.jsx("span",{className:"text-xs font-bold uppercase tracking-widest",children:"Half Mistake Definitions"})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:["spacing","capitalization","punctuation","matra","conjunct","indent"].map(u=>{var b;return t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group p-2 bg-gray-950/50 rounded-lg hover:bg-gray-800/30 transition-colors border border-transparent hover:border-gray-800",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-800 bg-gray-950 text-brand-purple focus:ring-brand-purple/20",checked:(b=a.halfMistakeRules)==null?void 0:b.includes(u),onChange:m=>o("halfMistakeRules",u,m.target.checked)}),t.jsxs("span",{className:"text-xs text-gray-400 group-hover:text-gray-200 uppercase tracking-tight font-bold",children:[u==="spacing"&&"Spacing",u==="capitalization"&&"Caps/Case",u==="punctuation"&&"Punctuation",u==="matra"&&"Matras",u==="conjunct"&&"Conjuncts",u==="indent"&&"Indentation"]})]},u)})})]}),t.jsxs("div",{className:"bg-brand-purple/5 p-4 rounded-xl border border-brand-purple/10 flex items-start gap-3",children:[t.jsx(ba,{className:"text-brand-purple mt-0.5",size:18}),t.jsxs("div",{children:[t.jsx(ie,{label:"Ignored Error Limit (%)",value:a.ignoredErrorLimit,onChange:u=>n("ignoredErrorLimit",u),min:0,max:100,step:.1}),t.jsx("p",{className:"text-[10px] text-gray-500 italic",children:"Errors within this percentage of total words typed will not result in a penalty."})]})]})]}),t.jsxs(Ae,{title:"4. PENALTY & SCORING RULES",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(Y,{label:"Penalty Application",value:a.penaltyMethod,options:[{value:"none",label:"No Speed Penalty"},{value:"per_mistake",label:"Per Mistake Deduction"},{value:"per_full_mistake",label:"Per Full Mistake"},{value:"penalty_factor",label:"Penalty Factor (e.g., 5x, 10x)"}],onChange:u=>n("penaltyMethod",u)}),a.penaltyMethod!=="none"&&t.jsx(ie,{label:a.penaltyMethod==="penalty_factor"?"Factor Value":"Deduction Value",value:a.deductionValue||0,onChange:u=>n("deductionValue",u)})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 border-t border-gray-800/50 pt-4 mt-2",children:[t.jsx(Y,{label:"Final Score Calculation",value:a.finalScoreCalc,options:[{value:"direct",label:"Direct Deduction"},{value:"penalty_factor",label:"Penalty Factor"},{value:"qualifying",label:"Qualifying (Pass/Fail)"},{value:"marks",label:"Marks-based (0-100)"}],onChange:u=>n("finalScoreCalc",u)}),t.jsx(Y,{label:"Decimal Display",value:a.scoreDisplay,options:[{value:"whole",label:"Whole No."},{value:"1dec",label:"1 Decimal"},{value:"2dec",label:"2 Decimals"}],onChange:u=>n("scoreDisplay",u)})]}),t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group mt-4",children:[t.jsx("input",{type:"checkbox",className:"w-5 h-5 rounded border-gray-800 bg-gray-950 text-brand-purple focus:ring-brand-purple/20",checked:a.showAccuracy,onChange:u=>n("showAccuracy",u.target.checked)}),t.jsx("span",{className:"text-sm font-bold text-gray-400 group-hover:text-white transition-colors text-left",children:"Show Accuracy Percentage on Result"})]})]}),t.jsxs(Ae,{title:"5. STENO TEST CONFIGURATION",children:[t.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group mb-6",children:[t.jsx("input",{type:"checkbox",id:"stenoEnable",className:"w-6 h-6 rounded border-gray-800 bg-gray-950 text-brand-purple focus:ring-brand-purple/20",checked:a.stenoEnabled,onChange:u=>n("stenoEnabled",u.target.checked)}),t.jsx("label",{htmlFor:"stenoEnable",className:"text-lg font-bold text-gray-200",children:"Enable Specialized Shorthand Logic"})]}),a.stenoEnabled&&t.jsxs("div",{className:"bg-gray-900/40 p-6 rounded-2xl border border-gray-800 space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(Y,{label:"Steno Test Type",value:a.stenoType||"qualifying",options:[{value:"qualifying",label:"Qualifying"},{value:"marks",label:"Marks-based"}],onChange:u=>n("stenoType",u)}),t.jsx(Y,{label:"Dictation Lang",value:a.stenoLanguage||"en",options:[{value:"en",label:"English"},{value:"hi",label:"Hindi"},{value:"both",label:"Both"}],onChange:u=>n("stenoLanguage",u)})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[t.jsx(ie,{label:"Speed (WPM)",value:a.stenoSpeed||0,onChange:u=>n("stenoSpeed",u)}),t.jsx(ie,{label:"Dictation (Min)",value:a.stenoDictationMin||0,onChange:u=>n("stenoDictationMin",u)}),t.jsx(ie,{label:"Transcription (Min)",value:a.stenoTranscriptionMin||0,onChange:u=>n("stenoTranscriptionMin",u)})]}),t.jsxs("div",{className:"flex flex-wrap gap-6 border-t border-gray-800 pt-6",children:[t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",className:"w-5 h-5 rounded border-gray-800 bg-gray-950 text-brand-purple focus:ring-brand-purple/20",checked:a.stenoBackspaceAllowed??!0,onChange:u=>n("stenoBackspaceAllowed",u.target.checked)}),t.jsx("span",{className:"text-xs font-bold text-gray-400 group-hover:text-white tracking-widest uppercase",children:"Allow Backspace"})]}),t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[t.jsx("input",{type:"checkbox",className:"w-5 h-5 rounded border-gray-800 bg-gray-950 text-brand-purple focus:ring-brand-purple/20",checked:a.stenoSpellcheckAllowed??!1,onChange:u=>n("stenoSpellcheckAllowed",u.target.checked)}),t.jsx("span",{className:"text-xs font-bold text-gray-400 group-hover:text-white tracking-widest uppercase",children:"Spellcheck"})]})]}),t.jsx(ie,{label:"Error Limit (%) for Qualification",value:a.stenoErrorLimit||0,onChange:u=>n("stenoErrorLimit",u),min:0,max:100,step:.1})]})]}),t.jsxs(Ae,{title:"6. INTERFACE & DURATION",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx(ie,{label:"Test Duration (Minutes)",value:a.durationMin,onChange:u=>n("durationMin",u),min:1}),t.jsx(ie,{label:"Break After Session (Seconds)",value:a.breakDurationSec,onChange:u=>n("breakDurationSec",u),min:0})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 border-t border-gray-800/50 pt-4 mt-2",children:[t.jsx(Y,{label:"Practice Session Behavior",value:a.practiceSession,options:[{value:"none",label:"Skip Practice"},{value:"timer",label:"Timed Practice (Mandatory)"}],onChange:u=>n("practiceSession",u)}),a.practiceSession==="timer"&&t.jsx(ie,{label:"Practice Time (Min)",value:a.practiceDurationMin||1,onChange:u=>n("practiceDurationMin",u),min:1})]}),t.jsxs("div",{className:"bg-gray-900/30 p-5 rounded-2xl border border-gray-800/50 space-y-4",children:[t.jsx("h4",{className:"text-[10px] font-black text-brand-purple uppercase tracking-[0.2em] mb-4",children:"Functional Restrictions"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsx(Le,{label:"Allow Backspace",checked:a.backspaceEnabled,onChange:u=>n("backspaceEnabled",u)}),t.jsx(Le,{label:"Allow Arrow Keys",checked:a.arrowKeysEnabled,onChange:u=>n("arrowKeysEnabled",u)}),t.jsx(Le,{label:"Live Error Indication",checked:a.liveErrors,onChange:u=>n("liveErrors",u)}),t.jsx(Le,{label:"Show Speed Calculator",checked:a.showSpeedDuringTest,onChange:u=>n("showSpeedDuringTest",u)}),t.jsx(Le,{label:"Show Keyboard Legend",checked:a.showOnscreenKeyboard,onChange:u=>n("showOnscreenKeyboard",u)}),t.jsx(Le,{label:"Show Finger Guide",checked:a.showFingerPosition,onChange:u=>n("showFingerPosition",u)})]}),t.jsx("div",{className:"mt-4 pt-4 border-t border-gray-800/50",children:t.jsx(Y,{label:"Word/Char Highlighting",value:a.highlight,options:[{value:"word",label:"Active Word"},{value:"character",label:"Active Character"},{value:"none",label:"No Highlighting (Blind)"}],onChange:u=>n("highlight",u)})})]})]}),t.jsxs(Ae,{title:"7. ADVANCED & CATEGORY RULES",children:[t.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group mb-6",children:[t.jsx("input",{type:"checkbox",id:"catEnable",className:"w-6 h-6 rounded border-gray-800 bg-gray-950 text-brand-purple focus:ring-brand-purple/20",checked:a.categoryWiseEnabled,onChange:u=>n("categoryWiseEnabled",u.target.checked)}),t.jsx("label",{htmlFor:"catEnable",className:"text-lg font-bold text-gray-200",children:"Enable Category-wise Eligibility"})]}),a.categoryWiseEnabled&&t.jsxs("div",{className:"space-y-4 mb-8",children:[t.jsxs("button",{type:"button",onClick:l,className:"w-full py-3 bg-brand-purple/10 border-2 border-dashed border-brand-purple/30 text-brand-purple rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-brand-purple/20 transition-all mb-4",children:[t.jsx(ue,{size:18})," Add New Category Exemption"]}),(p=a.categoryRules)==null?void 0:p.map((u,b)=>t.jsxs("div",{className:"bg-gray-900/60 p-6 rounded-2xl border border-gray-800 group/item relative animate-in slide-in-from-right-4",children:[t.jsx("button",{type:"button",onClick:()=>d(b),className:"absolute top-4 right-4 p-2 text-gray-600 hover:text-red-500 transition-colors",children:t.jsx(oe,{size:18})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(Y,{label:"Candidate Category",value:u.category,options:[{value:"UR",label:"Unreserved (UR)"},{value:"SC",label:"SC"},{value:"ST",label:"ST"},{value:"OBC",label:"OBC"},{value:"EWS",label:"EWS"},{value:"PwD",label:"PwD"}],onChange:m=>c(b,"category",m)}),t.jsx(ie,{label:"Custom Target Speed",value:u.minEligibility||0,onChange:m=>c(b,"minEligibility",m)})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-2",children:[t.jsx(ie,{label:"Allowed Error %",value:u.ignoredErrorLimit||0,onChange:m=>c(b,"ignoredErrorLimit",m),min:0,max:100,step:.1}),t.jsx(ie,{label:"Extra Time (Min)",value:u.extraTimeMin||0,onChange:m=>c(b,"extraTimeMin",m)})]})]},b))]}),t.jsxs("div",{className:"bg-gray-900/40 p-5 rounded-2xl border border-gray-800 grid grid-cols-1 md:grid-cols-2 gap-6 items-end",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx(Le,{label:"Scribe/Assistant Allowed",checked:a.scribeAllowed,onChange:u=>n("scribeAllowed",u)}),a.scribeAllowed&&t.jsx(ie,{label:"Extra Time for Scribe (Min)",value:a.scribeExtraMin||0,onChange:u=>n("scribeExtraMin",u)})]}),t.jsx(Y,{label:"Exam Domain",value:a.examType,options:[{value:"recruitment",label:"Fresh Recruitment"},{value:"departmental",label:"Internal Exam"},{value:"promotion",label:"Promotion Basis"},{value:"practice",label:"Practice/Dummy"}],onChange:u=>n("examType",u)})]}),t.jsx("div",{className:"mt-8",children:t.jsx(Y,{label:"Final Result Presentation",value:a.resultDisplay,options:[{value:"detailed",label:"Full Breakdown Dashboard"},{value:"pass_fail",label:"Qualification Status Only"},{value:"score",label:"Marks/Score Only"}],onChange:u=>n("resultDisplay",u)})})]}),t.jsxs("div",{className:"sticky bottom-8 left-0 right-0 bg-gray-900/80 backdrop-blur-md border border-gray-800 p-4 rounded-2xl shadow-2xl flex justify-center gap-4 animate-in slide-in-from-bottom-8",children:[t.jsx("button",{type:"button",onClick:r,className:"px-8 py-3 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-xl font-bold transition-all shadow-lg",children:"Reset Settings"}),t.jsx("button",{type:"button",onClick:()=>e(a),className:"px-12 py-3 bg-brand-purple hover:bg-purple-600 text-white rounded-xl font-bold shadow-[0_0_30px_rgba(168,85,247,0.4)] transition-all transform hover:scale-105",children:"Save & Publish Profile"})]})]})]})},Le=({label:s,checked:e,onChange:r})=>t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group p-3 bg-gray-900/50 rounded-xl border border-transparent hover:border-gray-800 transition-all",children:[t.jsx("input",{type:"checkbox",className:"w-5 h-5 rounded border-gray-800 bg-gray-950 text-brand-purple focus:ring-brand-purple/20",checked:e,onChange:a=>r(a.target.checked)}),t.jsx("span",{className:"text-sm font-bold text-gray-400 group-hover:text-gray-200 transition-colors uppercase tracking-tight",children:s})]}),tl=()=>{const[s,e]=_.useState(H()),[r,a]=_.useState(s.examProfiles||[]),[i,n]=_.useState(!1),[o,l]=_.useState(void 0),[c,h]=_.useState(!1),[d,f]=_.useState("bulk"),[g,p]=_.useState(null),[u,b]=_.useState([]),[m,y]=_.useState([]),[x,w]=_.useState(!1),[v,k]=_.useState(null),[S,T]=_.useState(null),P=()=>{const C=H();e(C),a(C.examProfiles||[])},F=C=>{l(C),n(!0)},me=C=>{if(confirm("Delete this profile?")){const B=r.filter(V=>V.id!==C);M({...s,examProfiles:B}),P()}},L=C=>{f(C),p(null),b([]),y([]),w(!1),k(null),T(null),h(!0)},ae=async C=>{var V;const B=(V=C.target.files)==null?void 0:V[0];if(B){p(B),k(null),b([]),y([]),w(!1),T(null);try{const G=await B.text(),I=JSON.parse(G);if(I.profiles&&I.content){w(!0);const J=Array.isArray(I.profiles)?I.profiles:[I.profiles],X=Array.isArray(I.content)?I.content:[I.content],te=[],ge=[];J.forEach((W,ke)=>{if(!W.profileName){ge.push(`Profile #${ke+1}: Missing "profileName"`);return}const Ce={};Object.keys(W).forEach(tt=>{tt.startsWith("_")||(Ce[tt]=W[tt])}),te.push({...Dt,...Ce,id:Ce.id||`profile-${Date.now()}-${ke}`})});const xe=[];X.forEach((W,ke)=>{if(!W.title||!W.text){ge.push(`Content #${ke+1}: Missing "title" or "text"`);return}xe.push({id:W.id||`content-${Date.now()}-${ke}`,title:W.title,text:W.text,language:W.language||"English",font:W.font||(W.language==="Hindi"?"Mangal":"Sans"),difficulty:W.difficulty||"Medium",tags:W.tags||[],uploadDate:new Date().toISOString().split("T")[0]})}),ge.length>0&&k(ge.join(`
`)),te.length>0&&b(te),xe.length>0&&y(xe);return}let ne;if(d==="single")if(Array.isArray(I))if(I.length===1)ne=I;else{k(`Single upload mode expects 1 profile, but found ${I.length}. Use "Bulk Upload" for multiple profiles.`);return}else ne=[I];else ne=Array.isArray(I)?I:[I];const N=[],U=[];ne.forEach((J,X)=>{if(!J.profileName){U.push(`Profile #${X+1}: Missing required field "profileName"`);return}const te={};Object.keys(J).forEach(ge=>{ge.startsWith("_")||(te[ge]=J[ge])}),N.push({...Dt,...te,id:te.id||`profile-${Date.now()}-${X}`})}),U.length>0&&k(U.join(`
`)),N.length>0&&b(N)}catch(G){k(`Invalid JSON: ${G.message}`)}}},fe=()=>{if(u.length===0&&m.length===0)return;const C=r.map(N=>N.profileName.toLowerCase()),B=u.filter(N=>C.includes(N.profileName.toLowerCase()));if(B.length>0){const N=B.map(U=>U.profileName).join(", ");if(!confirm(`The following profiles already exist: "${N}". They will be added as new entries. Continue?`))return}const V=H(),G=[...V.examProfiles||[],...u],I=[...V.contentLibrary||[],...m];M({...V,examProfiles:G,contentLibrary:I}),P(),h(!1);const ne=[];u.length>0&&ne.push(`${u.length} profile(s)`),m.length>0&&ne.push(`${m.length} content item(s)`),alert(` Successfully imported ${ne.join(" and ")}!

Exams will now appear on the website under Practice Exams.`)},D=C=>{if(!C.profileName)return alert("Profile Name is required");const B=(o==null?void 0:o.id)||`profile-${Date.now()}`,V={...C,id:B};let G;o?G=r.map(I=>I.id===o.id?V:I):G=[...r,V],M({...s,examProfiles:G}),P(),n(!1),l(void 0)};return i?t.jsx(el,{initialProfile:o,onSave:D,onCancel:()=>n(!1)}):t.jsxs("div",{className:"space-y-8 animate-in fade-in duration-500 text-left",children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-3xl font-display font-bold text-white tracking-tight",children:["Exam Rule ",t.jsx("span",{className:"text-brand-purple italic",children:"Engine"})]}),t.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Manage specialized calculation rules and test profiles for various recruitment exams."})]}),t.jsxs("div",{className:"flex gap-3 flex-wrap",children:[t.jsxs("button",{onClick:()=>L("unified"),className:"flex items-center justify-center gap-2 bg-gradient-to-r from-purple-900/50 to-cyan-900/50 border border-brand-purple/30 hover:border-brand-purple text-gray-200 px-5 py-3 rounded-xl font-bold transition-all cursor-pointer group text-sm",children:[t.jsx(Pt,{className:"text-yellow-400 group-hover:scale-110 transition-transform",size:18}),"Unified Upload"]}),t.jsxs("button",{onClick:()=>L("single"),className:"flex items-center justify-center gap-2 bg-gray-900 border border-gray-800 hover:bg-gray-800 text-gray-300 px-5 py-3 rounded-xl font-bold transition-all cursor-pointer group text-sm",children:[t.jsx(St,{className:"text-green-400 group-hover:scale-110 transition-transform",size:18}),"Import Single"]}),t.jsxs("button",{onClick:()=>L("bulk"),className:"flex items-center justify-center gap-2 bg-gray-900 border border-gray-800 hover:bg-gray-800 text-gray-300 px-5 py-3 rounded-xl font-bold transition-all cursor-pointer group text-sm",children:[t.jsx(Rs,{className:"text-cyan-400 group-hover:scale-110 transition-transform",size:18}),"Bulk Upload JSON"]}),t.jsxs("button",{onClick:()=>{l(void 0),n(!0)},className:"flex items-center justify-center gap-2 bg-brand-purple hover:bg-purple-600 text-white px-6 py-3 rounded-xl font-bold transition-all shadow-[0_0_20px_rgba(168,85,247,0.3)] hover:scale-105 active:scale-95 group",children:[t.jsx(ue,{className:"group-hover:rotate-90 transition-transform",size:20}),"Create New Profile"]})]})]}),c&&t.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center backdrop-blur-sm p-4",onClick:()=>h(!1),children:t.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-2xl w-full max-w-3xl shadow-2xl max-h-[90vh] flex flex-col",onClick:C=>C.stopPropagation(),children:[t.jsxs("div",{className:"p-6 border-b border-gray-800 flex items-center justify-between shrink-0",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[d==="unified"?t.jsx("div",{className:"p-2 bg-yellow-500/10 rounded-lg border border-yellow-500/20",children:t.jsx(Pt,{className:"text-yellow-400",size:22})}):d==="single"?t.jsx("div",{className:"p-2 bg-green-500/10 rounded-lg border border-green-500/20",children:t.jsx(St,{className:"text-green-400",size:22})}):t.jsx("div",{className:"p-2 bg-cyan-500/10 rounded-lg border border-cyan-500/20",children:t.jsx(Rs,{className:"text-cyan-400",size:22})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-bold text-white",children:d==="unified"?"Unified Exam Upload":d==="single"?"Import Single Profile":"Bulk Import Profiles"}),t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:d==="unified"?"Upload profiles + content in one JSON file  exams auto-appear on website":d==="single"?"Upload a JSON file containing one exam profile":"Upload a JSON file containing an array of exam profiles"})]})]}),t.jsx("button",{onClick:()=>h(!1),className:"p-2 hover:bg-gray-800 rounded-lg text-gray-400 hover:text-white transition-colors",children:t.jsx(_e,{size:20})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-5",children:g?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between bg-gray-800/50 p-3 rounded-xl border border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Ze,{className:"text-brand-purple",size:18}),t.jsx("span",{className:"font-mono text-sm text-gray-300",children:g.name}),t.jsxs("span",{className:"text-[10px] text-gray-500 bg-gray-900 px-2 py-0.5 rounded-full",children:[(g.size/1024).toFixed(1)," KB"]})]}),t.jsxs("button",{onClick:()=>{p(null),b([]),k(null),T(null)},className:"text-red-400 hover:text-red-300 text-xs font-bold flex items-center gap-1",children:[t.jsx(_e,{size:14})," Remove"]})]}),v&&t.jsxs("div",{className:"bg-red-900/20 border border-red-800/50 rounded-xl p-4 text-red-400 text-sm whitespace-pre-line flex items-start gap-3",children:[t.jsx(Is,{className:"shrink-0 mt-0.5",size:18}),t.jsx("div",{children:v})]}),u.length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold text-green-400",children:[t.jsx(ss,{size:16}),u.length," profile(s) parsed successfully"]}),t.jsx("div",{className:"max-h-72 overflow-y-auto border border-gray-700 rounded-xl",children:t.jsxs("table",{className:"w-full text-sm text-left",children:[t.jsx("thead",{className:"bg-gray-800/80 text-gray-400 text-[10px] uppercase font-bold tracking-wider sticky top-0",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3",children:"#"}),t.jsx("th",{className:"px-4 py-3",children:"Profile Name"}),t.jsx("th",{className:"px-4 py-3",children:"Calc Param"}),t.jsx("th",{className:"px-4 py-3",children:"Duration"}),t.jsx("th",{className:"px-4 py-3",children:"Language"}),t.jsx("th",{className:"px-4 py-3",children:"Type"}),t.jsx("th",{className:"px-4 py-3 text-right",children:"Preview"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-800",children:u.map((C,B)=>t.jsxs("tr",{className:"hover:bg-gray-800/30 text-gray-300",children:[t.jsx("td",{className:"px-4 py-3 text-gray-500 font-mono text-xs",children:B+1}),t.jsx("td",{className:"px-4 py-3 font-bold text-white",children:C.profileName}),t.jsx("td",{className:"px-4 py-3",children:t.jsx("span",{className:"text-xs bg-brand-purple/10 text-brand-purple px-2 py-0.5 rounded-full border border-brand-purple/20 font-bold",children:C.calculationParam})}),t.jsxs("td",{className:"px-4 py-3 text-gray-400",children:[C.durationMin," min"]}),t.jsx("td",{className:"px-4 py-3 text-gray-400 capitalize",children:C.languageMode==="fixed"?C.fixedLanguage:"Dynamic"}),t.jsx("td",{className:"px-4 py-3 text-gray-400 capitalize",children:C.examType}),t.jsx("td",{className:"px-4 py-3 text-right",children:t.jsx("button",{onClick:()=>T(S===B?null:B),className:"p-1.5 hover:bg-gray-700 rounded-lg text-gray-400 hover:text-white transition-colors",children:t.jsx(ya,{size:14})})})]},B))})]})}),S!==null&&u[S]&&t.jsxs("div",{className:"bg-gray-950 border border-gray-700 rounded-xl overflow-hidden",children:[t.jsxs("div",{className:"px-4 py-2 bg-gray-800/50 flex justify-between items-center border-b border-gray-700",children:[t.jsxs("span",{className:"text-xs font-bold text-gray-300",children:["Preview: ",u[S].profileName]}),t.jsx("button",{onClick:()=>T(null),className:"text-gray-500 hover:text-white",children:t.jsx(_e,{size:14})})]}),t.jsx("pre",{className:"p-4 text-[11px] text-gray-400 font-mono overflow-x-auto max-h-60 overflow-y-auto",children:JSON.stringify(u[S],null,2)})]})]}),m.length>0&&t.jsxs("div",{className:"mt-4 space-y-3",children:[t.jsxs("h4",{className:"text-sm font-bold text-yellow-400 flex items-center gap-2",children:[t.jsx(Ze,{size:14}),"Content Items (",m.length,")"]}),t.jsx("div",{className:"border border-gray-700 rounded-xl overflow-hidden",children:t.jsxs("table",{className:"w-full text-xs",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-800/50 text-gray-400 uppercase tracking-wider text-left",children:[t.jsx("th",{className:"px-4 py-2",children:"#"}),t.jsx("th",{className:"px-4 py-2",children:"Title"}),t.jsx("th",{className:"px-4 py-2",children:"Language"}),t.jsx("th",{className:"px-4 py-2",children:"Font"}),t.jsx("th",{className:"px-4 py-2",children:"Words"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-800",children:m.map((C,B)=>t.jsxs("tr",{className:"hover:bg-gray-800/30 text-gray-300",children:[t.jsx("td",{className:"px-4 py-2 text-gray-500 font-mono",children:B+1}),t.jsx("td",{className:"px-4 py-2 font-bold text-white truncate max-w-[200px]",children:C.title}),t.jsx("td",{className:"px-4 py-2",children:t.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-bold border ${C.language==="Hindi"?"bg-orange-500/10 text-orange-400 border-orange-500/20":"bg-blue-500/10 text-blue-400 border-blue-500/20"}`,children:C.language})}),t.jsx("td",{className:"px-4 py-2 text-gray-400",children:C.font}),t.jsx("td",{className:"px-4 py-2 text-gray-400",children:C.text.split(" ").length})]},B))})]})})]})]}):t.jsxs("div",{className:"border-2 border-dashed border-gray-700 rounded-xl p-10 text-center hover:border-brand-purple/50 hover:bg-gray-800/30 transition-all",children:[t.jsx("input",{type:"file",accept:".json",onChange:ae,className:"hidden",id:"profile-upload-input"}),t.jsxs("label",{htmlFor:"profile-upload-input",className:"cursor-pointer flex flex-col items-center gap-4",children:[t.jsx("div",{className:"p-4 bg-gray-800/50 rounded-full",children:t.jsx(ts,{className:"text-gray-500",size:40})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-300 font-bold text-lg",children:"Click to select a .json file"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:d==="single"?"Single profile object or array with 1 item":"JSON array of profile objects (e.g. [{ ... }, { ... }])"})]})]}),t.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-800 flex flex-wrap justify-center gap-3",children:[t.jsxs("a",{href:"/example_exam_profile.json",download:!0,className:"flex items-center gap-2 text-xs bg-brand-purple/10 hover:bg-brand-purple/20 text-brand-purple px-4 py-2 rounded-full border border-brand-purple/20 transition-all font-bold",onClick:C=>C.stopPropagation(),children:[t.jsx(Ue,{size:14})," Single Profile Template"]}),t.jsxs("a",{href:"/example_bulk_profiles.json",download:!0,className:"flex items-center gap-2 text-xs bg-cyan-500/10 hover:bg-cyan-500/20 text-cyan-400 px-4 py-2 rounded-full border border-cyan-500/20 transition-all font-bold",onClick:C=>C.stopPropagation(),children:[t.jsx(Ue,{size:14})," Bulk Upload Template (3 Profiles)"]})]})]})}),t.jsxs("div",{className:"p-6 border-t border-gray-800 flex items-center justify-between shrink-0 bg-gray-900/50",children:[t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("a",{href:"/example_unified_exam_upload.json",download:!0,className:"text-xs text-yellow-500 hover:text-yellow-300 flex items-center gap-1 transition-colors font-bold",children:[t.jsx(Ue,{size:12})," Unified Template"]}),t.jsxs("a",{href:"/example_exam_profile.json",download:!0,className:"text-xs text-gray-500 hover:text-gray-300 flex items-center gap-1 transition-colors",children:[t.jsx(Ue,{size:12})," Single Template"]}),t.jsxs("a",{href:"/example_bulk_profiles.json",download:!0,className:"text-xs text-gray-500 hover:text-gray-300 flex items-center gap-1 transition-colors",children:[t.jsx(Ue,{size:12})," Bulk Template"]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>h(!1),className:"px-5 py-2.5 text-gray-400 hover:text-white font-bold text-sm transition-colors",children:"Cancel"}),t.jsxs("button",{onClick:fe,disabled:u.length===0&&m.length===0,className:`px-6 py-2.5 rounded-xl font-bold text-sm flex items-center gap-2 transition-all ${u.length>0||m.length>0?"bg-brand-purple hover:bg-purple-600 text-white shadow-[0_0_15px_rgba(168,85,247,0.3)]":"bg-gray-800 text-gray-600 cursor-not-allowed"}`,children:[t.jsx(ss,{size:16}),"Import",u.length>0?` ${u.length} Profile${u.length!==1?"s":""}`:"",m.length>0?` + ${m.length} Content`:""]})]})]})]})}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.length>0?r.map(C=>t.jsxs("div",{className:"group bg-gray-900/40 border border-gray-800/80 rounded-2xl p-6 hover:border-brand-purple/50 transition-all hover:shadow-[0_0_30px_rgba(168,85,247,0.1)] backdrop-blur-sm relative overflow-hidden",children:[t.jsxs("div",{className:"absolute top-0 right-0 p-4 opacity-0 group-hover:opacity-100 transition-opacity flex gap-2 z-10",children:[t.jsx("button",{onClick:()=>F(C),className:"p-2 bg-gray-800/80 hover:bg-brand-purple text-gray-400 hover:text-white rounded-lg transition-all",title:"Edit Profile",children:t.jsx(vs,{size:16})}),t.jsx("button",{onClick:()=>me(C.id),className:"p-2 bg-gray-800/80 hover:bg-red-500 text-gray-400 hover:text-white rounded-lg transition-all",title:"Delete Profile",children:t.jsx(oe,{size:16})})]}),t.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[t.jsx("div",{className:"p-3 bg-brand-purple/10 rounded-xl border border-brand-purple/20",children:t.jsx(Fe,{className:"text-brand-purple",size:24})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-bold text-white group-hover:text-brand-purple transition-colors line-clamp-1",children:C.profileName}),t.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-gray-600",children:C.examType})]})]}),t.jsx("p",{className:"text-gray-500 text-xs mb-6 line-clamp-2 min-h-[2.5rem] leading-relaxed",children:C.description||"No description provided."}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-[10px] items-center",children:[t.jsxs("div",{className:"flex flex-col gap-1 p-2 bg-gray-950/50 rounded-lg border border-gray-800/50",children:[t.jsxs("span",{className:"text-gray-600 font-bold uppercase tracking-tight flex items-center gap-1",children:[t.jsx(va,{size:10})," Mode"]}),t.jsx("span",{className:"text-gray-300 font-bold uppercase",children:C.languageMode==="fixed"?C.fixedLanguage:"Dynamic"})]}),t.jsxs("div",{className:"flex flex-col gap-1 p-2 bg-gray-950/50 rounded-lg border border-gray-800/50",children:[t.jsxs("span",{className:"text-gray-600 font-bold uppercase tracking-tight flex items-center gap-1",children:[t.jsx(xr,{size:10})," Duration"]}),t.jsxs("span",{className:"text-gray-300 font-bold",children:[C.durationMin," MIN"]})]}),t.jsxs("div",{className:"flex flex-col gap-1 p-2 bg-gray-950/50 rounded-lg border border-gray-800/50",children:[t.jsxs("span",{className:"text-gray-600 font-bold uppercase tracking-tight flex items-center gap-1",children:[t.jsx(Is,{size:10})," Limit"]}),t.jsxs("span",{className:"text-gray-300 font-bold",children:[C.ignoredErrorLimit,"%"]})]}),t.jsxs("div",{className:"flex flex-col gap-1 p-2 bg-gray-950/50 rounded-lg border border-gray-800/50",children:[t.jsxs("span",{className:"text-gray-600 font-bold uppercase tracking-tight flex items-center gap-1",children:[t.jsx(wa,{size:10})," Param"]}),t.jsx("span",{className:"text-brand-purple font-black",children:(C.calculationParam||"").replace("gross_","").replace("net_","").toUpperCase()})]})]})]},C.id)):t.jsxs("div",{className:"col-span-full py-20 bg-gray-900/20 border-2 border-dashed border-gray-800 rounded-3xl flex flex-col items-center justify-center text-center",children:[t.jsx("div",{className:"p-4 bg-gray-800/50 rounded-full mb-4",children:t.jsx(Fe,{className:"text-gray-600",size:40})}),t.jsx("h4",{className:"text-xl font-bold text-gray-400",children:"No rule profiles found"}),t.jsx("p",{className:"text-gray-600 text-sm mt-2 max-w-xs",children:"Create your first exam profile to define custom scoring and calculation logic."}),t.jsxs("div",{className:"flex gap-3 mt-6",children:[t.jsxs("button",{onClick:()=>L("single"),className:"text-green-400 font-bold hover:underline flex items-center gap-1 text-sm",children:[t.jsx(St,{size:14})," Import JSON"]}),t.jsx("span",{className:"text-gray-700",children:"or"}),t.jsx("button",{onClick:()=>n(!0),className:"text-brand-purple font-bold hover:underline text-sm",children:"+ Create Profile"})]})]})})]})},sl=()=>{const[s,e]=_.useState(H()),[r,a]=_.useState(s.courses||[]),[i]=_.useState(s.examProfiles||[]),[n,o]=_.useState(!1),[l,c]=_.useState(null),h={id:"",name:"",description:"",price:0,durationDays:30,modules:[],examProfileIds:[],isActive:!0},[d,f]=_.useState(h),g=()=>{const x=H();e(x),a(x.courses||[])},p=x=>{f(x),c(x.id),o(!0)},u=x=>{if(confirm("Delete this course?")){const w=r.filter(v=>v.id!==x);M({...s,courses:w}),g()}},b=()=>{if(!d.name)return alert("Course Name is required");if(d.modules.length===0)return alert("Select at least one module");if(d.examProfileIds.length===0)return alert("Select at least one Exam Profile");const x={...d,id:l||`course-${Date.now()}`};let w;l?w=r.map(v=>v.id===l?x:v):w=[...r,x],M({...s,courses:w}),g(),o(!1),f(h),c(null)},m=x=>{const w=d.modules;w.includes(x)?f({...d,modules:w.filter(v=>v!==x)}):f({...d,modules:[...w,x]})},y=x=>{const w=d.examProfileIds;w.includes(x)?f({...d,examProfileIds:w.filter(v=>v!==x)}):f({...d,examProfileIds:[...w,x]})};return t.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold font-display text-white mb-1",children:"Course & Subscription Manager"}),t.jsx("p",{className:"text-gray-400 text-sm",children:"Bundle Content (Modules) + Rules (Profiles) into Courses."})]}),t.jsxs("button",{onClick:()=>{f(h),c(null),o(!0)},className:"bg-brand-purple hover:bg-purple-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors shadow-lg shadow-purple-900/20",children:[t.jsx(ue,{size:18})," Create New Course"]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.length>0?r.map(x=>t.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl p-6 hover:border-brand-purple/50 transition-all group backdrop-blur-sm relative overflow-hidden",children:[!x.isActive&&t.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-10",children:t.jsx("span",{className:"px-3 py-1 bg-red-900/80 text-red-200 rounded font-bold text-xs uppercase border border-red-700",children:"Inactive"})}),t.jsxs("div",{className:"flex justify-between items-start mb-4 relative z-20",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-bold text-white text-lg flex items-center gap-2",children:x.name}),t.jsx("p",{className:"text-xs text-gray-400 mt-1 line-clamp-2",children:x.description||"No description"})]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx("button",{onClick:()=>p(x),className:"p-1.5 text-gray-400 hover:text-brand-purple hover:bg-purple-900/20 rounded transition-colors",children:t.jsx($t,{size:16})}),t.jsx("button",{onClick:()=>u(x.id),className:"p-1.5 text-gray-400 hover:text-red-400 hover:bg-red-900/20 rounded transition-colors",children:t.jsx(oe,{size:16})})]})]}),t.jsxs("div",{className:"space-y-3 text-xs relative z-20",children:[t.jsx("div",{className:"flex gap-2 flex-wrap",children:x.modules.map(w=>t.jsx("span",{className:`px-2 py-0.5 rounded border ${w==="Hindi"?"bg-orange-900/20 border-orange-800 text-orange-400":w==="English"?"bg-blue-900/20 border-blue-800 text-blue-400":"bg-green-900/20 border-green-800 text-green-400"}`,children:w},w))}),t.jsxs("div",{className:"p-3 bg-gray-800/50 rounded border border-gray-700/50",children:[t.jsx("span",{className:"block text-[10px] text-gray-500 uppercase tracking-widest mb-2 font-bold",children:"Active Rules (Profiles)"}),t.jsx("div",{className:"flex flex-col gap-1",children:x.examProfileIds.map(w=>{const v=i.find(k=>k.id===w);return t.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[t.jsx(Fe,{size:12,className:"text-brand-purple"}),v?v.name:"Unknown Profile"]},w)})})]}),t.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-800",children:[t.jsxs("span",{className:"text-xl font-bold text-white font-mono",children:["",x.price]}),t.jsxs("span",{className:"text-gray-400 flex items-center gap-1",children:[t.jsx(xr,{size:12})," ",x.durationDays," Days"]})]})]})]},x.id)):t.jsx("div",{className:"col-span-full text-center py-20 text-gray-500 bg-gray-900/30 rounded-xl border border-dashed border-gray-800",children:'No courses created yet. Click "Create New Course" to start.'})}),n&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",children:t.jsxs("div",{className:"bg-[#0f0f13] border border-gray-800 rounded-xl w-full max-w-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]",children:[t.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-800 bg-gray-900/50",children:[t.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[t.jsx(Pt,{className:"text-brand-purple",size:20}),l?"Edit Course":"Create New Course"]}),t.jsx("button",{onClick:()=>o(!1),className:"text-gray-500 hover:text-white",children:t.jsx(_e,{size:20})})]}),t.jsxs("div",{className:"p-6 overflow-y-auto custom-scrollbar space-y-6 flex-1",children:[t.jsxs("section",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Course Name"}),t.jsx("input",{className:"input-field",placeholder:"e.g. SSC + AIIMS Combo",value:d.name,onChange:x=>f({...d,name:x.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Price (INR)"}),t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500",children:""}),t.jsx("input",{type:"number",className:"input-field pl-8",placeholder:"999",value:d.price,onChange:x=>f({...d,price:Number(x.target.value)})})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Description"}),t.jsx("textarea",{className:"input-field min-h-[80px]",placeholder:"Course details...",value:d.description,onChange:x=>f({...d,description:x.target.value})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Duration (Days)"}),t.jsx("input",{type:"number",className:"input-field",value:d.durationDays,onChange:x=>f({...d,durationDays:Number(x.target.value)})})]}),t.jsx("div",{className:"flex items-center pt-6",children:t.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-300 font-bold cursor-pointer",children:[t.jsx("input",{type:"checkbox",className:"accent-brand-purple w-4 h-4",checked:d.isActive,onChange:x=>f({...d,isActive:x.target.checked})}),"Course Active"]})})]})]}),t.jsxs("section",{className:"space-y-3",children:[t.jsx("h4",{className:"text-brand-purple font-bold text-xs uppercase tracking-widest border-b border-gray-800 pb-2",children:"2. Select Modules"}),t.jsx("div",{className:"flex gap-4",children:["Hindi","English","CPT"].map(x=>t.jsxs("button",{onClick:()=>m(x),className:`flex-1 py-3 rounded-lg border flex items-center justify-center gap-2 transition-all ${d.modules.includes(x)?"bg-brand-purple/20 border-brand-purple text-white shadow-[0_0_10px_rgba(168,85,247,0.3)]":"bg-gray-900 border-gray-700 text-gray-500 hover:border-gray-600"}`,children:[x==="Hindi"&&t.jsx("span",{className:"font-mangal",children:""}),x==="English"&&t.jsx(Tt,{size:16}),x==="CPT"&&t.jsx(br,{size:16}),t.jsx("span",{className:"font-bold text-sm",children:x}),d.modules.includes(x)&&t.jsx(rs,{size:14,className:"text-brand-purple"})]},x))})]}),t.jsxs("section",{className:"space-y-3",children:[t.jsx("h4",{className:"text-brand-purple font-bold text-xs uppercase tracking-widest border-b border-gray-800 pb-2",children:"3. Map Exam Rules (Profiles)"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[i.map(x=>t.jsxs("div",{onClick:()=>y(x.id),className:`p-3 rounded-lg border cursor-pointer transition-all flex justify-between items-center ${d.examProfileIds.includes(x.id)?"bg-blue-900/20 border-blue-500/50 text-blue-100":"bg-gray-900 border-gray-700 text-gray-400 hover:bg-gray-800"}`,children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-bold text-sm",children:x.name}),t.jsxs("div",{className:"text-[10px] opacity-70",children:[x.calculationMode," | ",x.penalty.type," Penalty"]})]}),d.examProfileIds.includes(x.id)&&t.jsx(rs,{size:16,className:"text-blue-500"})]},x.id)),i.length===0&&t.jsx("div",{className:"text-gray-500 text-sm italic col-span-full",children:'No Profiles Found. Create profiles in "Master Rules" first.'})]})]})]}),t.jsxs("div",{className:"p-6 border-t border-gray-800 bg-gray-900/30 flex justify-end gap-3",children:[t.jsx("button",{onClick:()=>o(!1),className:"btn-secondary",children:"Cancel"}),t.jsxs("button",{onClick:b,className:"btn-primary flex items-center gap-2",children:[t.jsx(gt,{size:18})," Save Course"]})]})]})}),t.jsx("style",{children:`
        .input-field {
          width: 100%;
          background-color: #111827;
          border-width: 1px;
          border-color: #374151;
          border-radius: 0.5rem;
          padding: 0.625rem 1rem;
          color: #e5e7eb;
          font-size: 0.875rem;
          outline: none;
        }
        .input-field:focus {
          border-color: #a855f7;
          box-shadow: 0 0 0 1px #a855f7;
        }
        .btn-primary {
          background-color: #a855f7;
          color: white;
          padding: 0.625rem 1.25rem;
          border-radius: 0.5rem;
          font-weight: 700;
          transition: background-color 0.2s;
        }
        .btn-primary:hover {
          background-color: #9333ea;
        }
        .btn-secondary {
          background-color: transparent;
          color: #9ca3af;
          padding: 0.625rem 1.25rem;
          border-radius: 0.5rem;
          font-weight: 700;
          transition: color 0.2s;
        }
        .btn-secondary:hover {
          color: white;
          background-color: #1f2937;
        }
        .label-sm {
            display: block;
            font-size: 0.75rem;
            font-weight: 700;
            color: #6b7280;
            text-transform: uppercase;
            margin-bottom: 0.375rem;
        }
      `})]})},rl=()=>{const[s,e]=_.useState(H()),[r,a]=_.useState({name:"",email:"",password:"",role:"Admin"}),i=()=>e(H()),n=()=>{if(!r.name||!r.email||!r.password)return;const c={id:Date.now(),name:r.name,email:r.email,password:r.password,plan:"Pro Yearly",joined:new Date().toISOString().split("T")[0],status:"Active",authMethod:"Email",role:r.role},h=[...s.users,c];M({...s,users:h}),a({name:"",email:"",password:"",role:"Admin"}),i()},o=c=>{confirm("Are you sure you want to remove this admin?")&&(M({...s,users:s.users.filter(h=>h.id!==c)}),i())},l=s.users.filter(c=>["Super Admin","Admin","Moderator"].includes(c.role));return t.jsxs("div",{className:"space-y-6",children:[t.jsx("h2",{className:"text-2xl font-bold font-display",children:"Admin Management"}),t.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-sm border-gray-800",children:[t.jsx("h3",{className:"font-bold mb-4",children:"Create New Admin"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsx("input",{className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple",placeholder:"Name",value:r.name,onChange:c=>a({...r,name:c.target.value})}),t.jsx("input",{className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple",placeholder:"Email",value:r.email,onChange:c=>a({...r,email:c.target.value})}),t.jsx("input",{className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple",placeholder:"Password",type:"password",value:r.password,onChange:c=>a({...r,password:c.target.value})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("select",{className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple",value:r.role,onChange:c=>a({...r,role:c.target.value}),children:[t.jsx("option",{value:"Admin",children:"Admin"}),t.jsx("option",{value:"Moderator",children:"Moderator"})]}),t.jsxs("button",{onClick:n,className:"btn-primary whitespace-nowrap",children:[t.jsx(ue,{size:16})," Add"]})]})]})]}),t.jsx("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl overflow-hidden",children:t.jsxs("table",{className:"w-full text-sm text-left",children:[t.jsx("thead",{className:"bg-gray-800/50 text-gray-400 font-bold uppercase text-[10px] tracking-widest",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3",children:"Name"}),t.jsx("th",{className:"px-6 py-3",children:"Email"}),t.jsx("th",{className:"px-6 py-3",children:"Role"}),t.jsx("th",{className:"px-6 py-3",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-800",children:l.map(c=>t.jsxs("tr",{className:"hover:bg-gray-800/30",children:[t.jsx("td",{className:"px-6 py-3 font-bold text-gray-200",children:c.name}),t.jsx("td",{className:"px-6 py-3 text-gray-400",children:c.email}),t.jsx("td",{className:"px-6 py-3",children:t.jsx("span",{className:"px-2 py-1 bg-purple-900/20 text-purple-400 rounded text-xs font-bold border border-purple-800",children:c.role})}),t.jsx("td",{className:"px-6 py-3",children:c.role!=="Super Admin"&&t.jsx("button",{onClick:()=>o(c.id),className:"text-red-500 hover:text-red-400 transition-colors",children:t.jsx(oe,{size:16})})})]},c.id))})]})})]})},al=()=>{const[s,e]=_.useState(bs()),[r,a]=_.useState("All");_.useEffect(()=>{},[]);const i=()=>e(bs()),n=r==="All"?s:s.filter(o=>o.type===r.toLowerCase());return t.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("h2",{className:"text-2xl font-display font-bold flex items-center gap-2",children:[t.jsx(Nr,{className:"text-brand-purple"})," Activity Logs"]}),t.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-800 rounded-full transition-colors",children:t.jsx(Mt,{size:18})})]}),t.jsx("div",{className:"flex gap-2 mb-4",children:["All","Info","Success","Warning","Danger"].map(o=>t.jsx("button",{onClick:()=>a(o),className:`px-3 py-1 rounded-full text-xs font-bold ${r===o?"bg-brand-purple text-white shadow-[0_0_10px_rgba(168,85,247,0.3)]":"bg-gray-900 border-gray-700 text-gray-200 placeholder-gray-600 focus:border-brand-purple"}`,children:o},o))}),t.jsx("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl overflow-hidden shadow-sm",children:t.jsxs("table",{className:"w-full text-sm text-left",children:[t.jsx("thead",{className:"bg-gray-800/50 text-gray-400 font-bold uppercase text-[10px] tracking-widest",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3",children:"Time"}),t.jsx("th",{className:"px-6 py-3",children:"Admin"}),t.jsx("th",{className:"px-6 py-3",children:"Action"}),t.jsx("th",{className:"px-6 py-3",children:"Details"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-800",children:n.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:4,className:"px-6 py-8 text-center text-gray-400",children:"No logs found."})}):n.map(o=>t.jsxs("tr",{className:"hover:bg-gray-800/30",children:[t.jsx("td",{className:"px-6 py-3 text-xs text-gray-500 font-mono",children:new Date(o.timestamp).toLocaleString()}),t.jsx("td",{className:"px-6 py-3 font-bold text-gray-200",children:o.adminName}),t.jsx("td",{className:`px-6 py-3 font-bold ${o.type==="success"?"text-green-400":o.type==="danger"?"text-red-400":o.type==="warning"?"text-orange-400":"text-blue-400"}`,children:o.action}),t.jsx("td",{className:"px-6 py-3 text-gray-300",children:o.details})]},o.id))})]})})]})},nl=({stats:s})=>{const e=H(),r=e.payments||[],a=e.users||[],i=At.useMemo(()=>{const c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],h=new Date().getMonth();return Array.from({length:6}).map((d,f)=>{const g=(h-5+f+12)%12,p=f===5,u=r.reduce((m,y)=>m+(parseFloat(y.amount)||0),0),b=p?u:Math.floor(Math.random()*5e3)+1e3;return{label:c[g],value:b}})},[r]),n=Math.max(...i.map(c=>c.value))||100,o=At.useMemo(()=>[{label:"Mon",value:12},{label:"Tue",value:19},{label:"Wed",value:15},{label:"Thu",value:25},{label:"Fri",value:32},{label:"Sat",value:28},{label:"Sun",value:a.length}],[a]),l=Math.max(...o.map(c=>c.value))||50;return t.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[t.jsx("h2",{className:"text-2xl font-bold font-display text-white",children:"Dashboard Overview"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:s.map((c,h)=>t.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 p-6 rounded-xl hover:border-brand-purple/50 transition-all shadow-lg backdrop-blur-sm group relative overflow-hidden",children:[t.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-brand-purple/10 rounded-full blur-[40px] group-hover:bg-brand-purple/20 transition-all"}),t.jsxs("div",{className:"flex justify-between items-start mb-4 relative z-10",children:[t.jsx("div",{className:"p-3 bg-gray-800 rounded-lg group-hover:scale-110 transition-transform shadow-inner border border-gray-700",children:c.icon}),t.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded-full border ${c.change.includes("+")?"text-green-400 bg-green-900/20 border-green-800":"text-red-400 bg-red-900/20 border-red-800"}`,children:c.change})]}),t.jsxs("div",{className:"relative z-10",children:[t.jsx("p",{className:"text-gray-400 text-xs font-bold uppercase tracking-wider",children:c.label}),t.jsx("h3",{className:"text-3xl font-bold font-display text-gray-100 mt-1",children:c.value})]})]},h))}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl p-6 backdrop-blur-sm",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsxs("h3",{className:"font-bold text-gray-200 flex items-center gap-2",children:[t.jsx(yr,{size:18,className:"text-green-500"})," Revenue Trend"]}),t.jsx("select",{className:"bg-gray-900 border border-gray-700 text-xs rounded px-2 py-1 text-gray-400",children:t.jsx("option",{children:"Last 6 Months"})})]}),t.jsx("div",{className:"h-48 flex items-end justify-between gap-2 px-2",children:i.map((c,h)=>t.jsxs("div",{className:"flex flex-col items-center gap-2 w-full group",children:[t.jsxs("div",{className:"w-full bg-gray-800 rounded-t-lg relative overflow-hidden transition-all hover:bg-green-900/40 border-t border-x border-gray-700 group-hover:border-green-500/50",style:{height:`${c.value/n*100}%`},children:[t.jsx("div",{className:"absolute bottom-0 w-full h-1 bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.5)]"}),t.jsxs("div",{className:"opacity-0 group-hover:opacity-100 absolute -top-8 left-1/2 -translate-x-1/2 bg-black text-white text-[10px] py-1 px-2 rounded -mb-2 pointer-events-none whitespace-nowrap z-20",children:["",c.value]})]}),t.jsx("span",{className:"text-[10px] text-gray-500 font-bold uppercase",children:c.label})]},h))})]}),t.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl p-6 backdrop-blur-sm",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsxs("h3",{className:"font-bold text-gray-200 flex items-center gap-2",children:[t.jsx(as,{size:18,className:"text-blue-500"})," User Growth"]}),t.jsx("select",{className:"bg-gray-900 border border-gray-700 text-xs rounded px-2 py-1 text-gray-400",children:t.jsx("option",{children:"Last 7 Days"})})]}),t.jsx("div",{className:"h-48 flex items-end justify-between gap-2 px-2",children:o.map((c,h)=>t.jsxs("div",{className:"flex flex-col items-center gap-2 w-full group",children:[t.jsxs("div",{className:"w-full bg-gray-800 rounded-t-lg relative overflow-hidden transition-all hover:bg-blue-900/40 border-t border-x border-gray-700 group-hover:border-blue-500/50",style:{height:`${c.value/l*100}%`},children:[t.jsx("div",{className:"absolute bottom-0 w-full h-1 bg-blue-500 shadow-[0_0_10px_rgba(59,130,246,0.5)]"}),t.jsx("div",{className:"opacity-0 group-hover:opacity-100 absolute -top-8 left-1/2 -translate-x-1/2 bg-black text-white text-[10px] py-1 px-2 rounded pointer-events-none z-20",children:c.value})]}),t.jsx("span",{className:"text-[10px] text-gray-500 font-bold uppercase",children:c.label})]},h))})]})]}),t.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl p-6 backdrop-blur-sm",children:[t.jsxs("h3",{className:"font-bold mb-4 text-gray-200 flex items-center gap-2",children:[t.jsx(_r,{size:18,className:"text-brand-purple"})," System Health"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"bg-black/40 rounded-lg p-4 border border-gray-800",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-xs font-bold text-gray-400",children:"SERVER CPU"}),t.jsx("span",{className:"text-green-400 text-xs font-bold",children:"OK"})]}),t.jsx("div",{className:"text-2xl font-mono font-bold text-white",children:"12%"}),t.jsx("div",{className:"w-full bg-gray-800 h-1 mt-2 rounded-full overflow-hidden",children:t.jsx("div",{className:"w-[12%] h-full bg-green-500"})})]}),t.jsxs("div",{className:"bg-black/40 rounded-lg p-4 border border-gray-800",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-xs font-bold text-gray-400",children:"MEMORY USAGE"}),t.jsx("span",{className:"text-yellow-400 text-xs font-bold",children:"MODERATE"})]}),t.jsx("div",{className:"text-2xl font-mono font-bold text-white",children:"45%"}),t.jsx("div",{className:"w-full bg-gray-800 h-1 mt-2 rounded-full overflow-hidden",children:t.jsx("div",{className:"w-[45%] h-full bg-yellow-500"})})]}),t.jsxs("div",{className:"bg-black/40 rounded-lg p-4 border border-gray-800",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-xs font-bold text-gray-400",children:"DATABASE (Hostinger)"}),t.jsx("span",{className:"text-green-400 text-xs font-bold",children:"CONNECTED"})]}),t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"AdminStore Sync Active"}),t.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})," ",t.jsx("span",{className:"text-xs text-green-400",children:"Operational"})]})]})]})]})]})},il=({exams:s,setExams:e,rules:r,categories:a=[],setCategories:i,examProfiles:n=[],setExamProfiles:o})=>{const[l,c]=_.useState(!1),[h,d]=_.useState(!1),[f,g]=_.useState(!1),[p,u]=_.useState(null),[b,m]=_.useState(""),[y,x]=_.useState(""),[w,v]=_.useState("English"),[k,S]=_.useState(["English"]),[T,P]=_.useState(""),[F,me]=_.useState("Published"),[L,ae]=_.useState("Past"),[fe,D]=_.useState(""),[C,B]=_.useState(null),[V,G]=_.useState([]),[I,ne]=_.useState(null),[N,U]=_.useState(!1),[J,X]=_.useState(""),[te,ge]=_.useState(""),[xe,W]=_.useState(""),[ke,Ce]=_.useState(""),tt=()=>{if(!J.trim())return;const j={id:`cat-${Date.now()}`,name:J,parentId:te||null,type:"folder"};i([...a,j]),X("")},ta=j=>{confirm("Delete this category? Sub-categories will be unlinked.")&&i(a.filter(O=>O.id!==j))},sa=async j=>{var je;const O=(je=j.target.files)==null?void 0:je[0];if(O){B(O),U(!0),ne(null);try{if(O.name.endsWith(".json")){const Z=await O.text(),z=JSON.parse(Z);if(z.categories||z.profiles||z.exams)ne(z),G(z.exams||[]);else{const Re=Array.isArray(z)?z:[z];G(Re.map((be,Ee)=>({id:Date.now()+Ee,title:be.title||`Imported Exam ${Ee+1}`,content:be.content||"",language:be.language||"English",status:"Draft"})))}U(!1)}else if(O.name.endsWith(".xlsx")){const Z=await Et(()=>import("./xlsx-CkFp8p6R.js"),[]),z=new FileReader;z.onload=Re=>{var As;const be=(As=Re.target)==null?void 0:As.result,Ee=Z.read(be,{type:"binary"}),ia=Ee.SheetNames[0],oa=Ee.Sheets[ia],la=Z.utils.sheet_to_json(oa).map((ft,Ts)=>({id:Date.now()+Ts,title:ft.Title||`Bulk Import ${Ts+1}`,content:ft.Content||"",language:ft.Language||"English",categoryId:ft.Category||"",status:"Draft"}));G(la),U(!1)},z.readAsBinaryString(O)}else{const Re=(await O.text()).split("---").map(be=>be.trim()).filter(Boolean).map((be,Ee)=>({id:Date.now()+Ee,title:`Bulk Text Import ${Ee+1}`,content:be,language:"English",status:"Draft"}));G(Re),U(!1)}}catch(Z){console.error("Bulk upload failed",Z),alert("Failed to parse file."),U(!1)}}},ra=()=>{if(I){const j=I.categories?[...a,...I.categories]:a,O=I.profiles?[...n,...I.profiles.map(z=>({...Dt,...z}))]:n;let je=s;if(I.exams){const z=I.exams.map((Re,be)=>({...Re,id:Date.now()+be,plays:0}));je=[...s,...z]}const Z=H();M({...Z,categories:j,examProfiles:O,exams:je}),alert("Unified Import Successful!")}else{const j=V.map(O=>({id:O.id,title:O.title,language:O.language,enabledLanguages:[O.language],ruleSet:"Standard",ruleId:1,status:"Published",content:O.content,contentTitle:O.title,categoryId:y||null,plays:0}));e([...s,...j]),alert(`Successfully imported ${j.length} exams!`)}g(!1),B(null),G([]),ne(null)},aa=()=>{var je;const j=n.find(Z=>Z.id===T),O={title:b,categoryId:y,language:k.length>0?k[0]:"English",enabledLanguages:k,examProfileId:T,ruleSet:(j==null?void 0:j.profileName)||"Standard",status:F,liveStatus:L,liveDate:fe,content:xe,contentTitle:ke,plays:p?(je=s.find(Z=>Z.id===p))==null?void 0:je.plays:0};if(p){const Z=s.find(z=>z.id===p);e(s.map(z=>z.id===p?{...z,...O,createdAt:(Z==null?void 0:Z.createdAt)||Date.now()}:z))}else{const Z=s.length>0?Math.max(...s.map(z=>z.id))+1:1;e([...s,{id:Z,...O,createdAt:Date.now()}])}c(!1),u(null),m(""),W(""),Ce(""),ae("Past"),D(""),S(["English"]),x(""),P("")},na=j=>{u(j.id),m(j.title),x(j.categoryId||""),v(j.language),S(j.enabledLanguages||[j.language]),P(j.examProfileId||""),me(j.status),ae(j.liveStatus||"Past"),D(j.liveDate||""),W(j.content||""),Ce(j.contentTitle||""),c(!0)},[Ss,ks]=_.useState(""),[Ht,Cs]=_.useState(""),Es=s.filter(j=>{const O=j.title.toLowerCase().includes(Ss.toLowerCase()),je=Ht?j.categoryId===Ht:!0;return O&&je}).sort((j,O)=>O.id-j.id);return t.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-display font-bold",children:"Exam Management"}),t.jsx("p",{className:"text-sm text-gray-400",children:"Manage, edit, and publish your typing exams."})]}),t.jsxs("div",{className:"flex flex-wrap gap-2 w-full md:w-auto",children:[t.jsxs("div",{className:"relative group flex-grow md:flex-grow-0",children:[t.jsx(ys,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 group-focus-within:text-brand-purple transition-colors",size:16}),t.jsx("input",{type:"text",placeholder:"Search exams...",value:Ss,onChange:j=>ks(j.target.value),className:"pl-9 pr-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-sm text-white focus:border-brand-purple outline-none w-full md:w-64"})]}),t.jsxs("select",{value:Ht,onChange:j=>Cs(j.target.value),className:"bg-gray-900 text-gray-300 px-3 py-2 rounded-lg text-sm border border-gray-700 outline-none focus:border-brand-purple",children:[t.jsx("option",{value:"",children:"All Categories"}),a.map(j=>t.jsx("option",{value:j.id,children:j.name},j.id))]}),t.jsx("button",{onClick:()=>d(!0),className:"bg-gray-800 text-gray-300 px-3 py-2 rounded-lg font-bold text-sm hover:bg-gray-700 border border-gray-700",title:"Manage Categories",children:t.jsx(Ea,{size:18})}),t.jsx("button",{onClick:()=>g(!0),className:"bg-gray-800 text-gray-300 px-3 py-2 rounded-lg font-bold text-sm hover:bg-gray-700 border border-gray-700 flex items-center gap-2",title:"Bulk Upload",children:t.jsx(ts,{size:18})}),t.jsxs("button",{onClick:()=>{c(!0),u(null),W(""),Ce(""),m(""),S(["English"]),x("")},className:"bg-brand-black text-white px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 hover:bg-gray-800 shadow-brand",children:[t.jsx(ue,{size:18})," New Exam"]})]})]}),h&&t.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center backdrop-blur-sm",onClick:()=>d(!1),children:t.jsxs("div",{className:"bg-gray-900 border border-gray-700 p-6 rounded-xl w-full max-w-md shadow-2xl",onClick:j=>j.stopPropagation(),children:[t.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Category Folders"}),t.jsxs("div",{className:"flex gap-2 mb-4",children:[t.jsx("input",{className:"input-field bg-gray-800 border-gray-600",placeholder:"New Folder Name",value:J,onChange:j=>X(j.target.value)}),t.jsxs("select",{className:"input-field bg-gray-800 border-gray-600 w-1/3",value:te,onChange:j=>ge(j.target.value),children:[t.jsx("option",{value:"",children:"(Root)"}),a.map(j=>t.jsx("option",{value:j.id,children:j.name},j.id))]}),t.jsx("button",{onClick:tt,className:"btn-primary",children:t.jsx(ue,{size:18})})]}),t.jsxs("div",{className:"max-h-60 overflow-y-auto space-y-2 custom-scrollbar",children:[a.map(j=>t.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-800/50 rounded border border-gray-700",children:[t.jsxs("span",{className:"text-sm text-gray-200",children:[j.parentId?t.jsx("span",{className:"text-gray-500 mr-2",children:""}):null,j.name]}),t.jsx("button",{onClick:()=>ta(j.id),className:"text-red-500 hover:text-red-400",children:t.jsx(oe,{size:14})})]},j.id)),a.length===0&&t.jsx("p",{className:"text-gray-500 text-sm italic text-center",children:"No categories created."})]}),t.jsx("button",{onClick:()=>d(!1),className:"mt-4 w-full btn-secondary",children:"Close"})]})}),f&&t.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center backdrop-blur-sm",onClick:()=>g(!1),children:t.jsxs("div",{className:"bg-gray-900 border border-gray-700 p-6 rounded-xl w-full max-w-2xl shadow-2xl",onClick:j=>j.stopPropagation(),children:[t.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[t.jsx(ts,{size:20})," Bulk Import Exams"]}),C?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center bg-gray-800 p-3 rounded",children:[t.jsx("span",{className:"font-mono text-xs text-gray-300",children:C.name}),t.jsx("button",{onClick:()=>{B(null),G([])},className:"text-red-400 text-xs",children:"Remove"})]}),N?t.jsx("p",{className:"text-yellow-400 animate-pulse text-sm",children:"Processing file..."}):t.jsx("div",{className:"max-h-60 overflow-y-auto border border-gray-700 rounded custom-scrollbar",children:t.jsxs("table",{className:"w-full text-xs text-left",children:[t.jsx("thead",{className:"bg-gray-800 text-gray-400",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-2",children:"Title"}),t.jsx("th",{className:"p-2",children:"Lang"}),t.jsx("th",{className:"p-2",children:"Preview"})]})}),t.jsx("tbody",{children:V.map((j,O)=>t.jsxs("tr",{className:"border-b border-gray-800 text-gray-300",children:[t.jsx("td",{className:"p-2 font-bold",children:j.title}),t.jsx("td",{className:"p-2",children:j.language}),t.jsxs("td",{className:"p-2 truncate max-w-xs opacity-70",children:[j.content.substring(0,50),"..."]})]},O))})]})}),t.jsxs("div",{className:"flex gap-2 justify-end mt-4",children:[t.jsxs("select",{className:"input-field bg-gray-800 border-gray-700 w-auto",value:y,onChange:j=>x(j.target.value),children:[t.jsx("option",{value:"",children:"Auto-Detect / No Category"}),a.map(j=>t.jsx("option",{value:j.id,children:j.name},j.id))]}),t.jsxs("button",{onClick:ra,className:"btn-primary",disabled:V.length===0,children:["Import ",V.length," Exams"]})]})]}):t.jsxs("div",{className:"border-2 border-dashed border-gray-700 rounded-xl p-10 text-center hover:bg-gray-800 transition-colors",children:[t.jsx("input",{type:"file",accept:".xlsx,.txt,.json",onChange:sa,className:"hidden",id:"bulk-file"}),t.jsxs("label",{htmlFor:"bulk-file",className:"cursor-pointer",children:[t.jsx("p",{className:"text-gray-300 font-bold mb-2",children:"Click to Bulk Upload (.xlsx, .txt, .json)"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Excel columns: Title, Content, Language, Category"}),t.jsxs("div",{className:"flex flex-col items-center gap-2 mt-4",children:[t.jsx("p",{className:"text-[10px] text-brand-purple font-bold uppercase tracking-wider",children:"New: Upload Unified JSON (Categories + Profiles + Exams)"}),t.jsxs("a",{href:"/master_unified_template.json",download:!0,className:"text-[10px] bg-brand-purple/20 hover:bg-brand-purple/40 text-brand-purple px-4 py-1.5 rounded-full border border-brand-purple/30 transition-all font-bold flex items-center gap-2",onClick:j=>j.stopPropagation(),children:[t.jsx(Ue,{size:12})," Download JSON Template"]})]})]})]})]})}),l&&t.jsxs("div",{className:"bg-gray-950 border-2 border-brand-purple rounded-2xl shadow-[0_0_30px_rgba(192,38,211,0.2)] p-8 mb-8 backdrop-blur-md animate-in slide-in-from-top-4",children:[t.jsxs("h3",{className:"font-bold text-xl mb-6 text-white flex items-center gap-3 border-b border-gray-800 pb-4",children:[t.jsx(Ze,{size:24,className:"text-brand-purple"}),p?"Modify Exam Record":"Create New Examination"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Exam Title"}),t.jsx("input",{type:"text",placeholder:"e.g. SSC CHSL Mains 2024",value:b,onChange:j=>m(j.target.value),className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Category / Folder"}),t.jsxs("select",{className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple",value:y,onChange:j=>x(j.target.value),children:[t.jsx("option",{value:"",children:"(None)"}),a.map(j=>t.jsx("option",{value:j.id,children:j.name},j.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Paragraph Title (Optional)"}),t.jsx("input",{type:"text",placeholder:"e.g. The Fox and Grapes",value:ke,onChange:j=>Ce(j.target.value),className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm text-gray-400",children:"Linked Exam Profile (Modern Engine)"}),t.jsxs("select",{value:T,onChange:j=>P(j.target.value),className:"input-field bg-gray-900 border-gray-700 text-white focus:border-brand-purple font-bold",children:[t.jsx("option",{value:"",children:"Select a Profile..."}),n.map(j=>t.jsx("option",{value:j.id,children:j.profileName},j.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Allowed Languages"}),t.jsxs("div",{className:"flex gap-4 mt-2 bg-gray-900 border border-gray-700 p-2.5 rounded text-gray-200",children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4 accent-brand-purple",checked:k.includes("English"),onChange:j=>{j.target.checked?S([...k,"English"]):S(k.filter(O=>O!=="English"))}}),"English"]}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4 accent-brand-purple",checked:k.includes("Hindi"),onChange:j=>{j.target.checked?S([...k,"Hindi"]):S(k.filter(O=>O!=="Hindi"))}}),"Hindi"]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Publish Status"}),t.jsxs("select",{value:F,onChange:j=>me(j.target.value),className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple",children:[t.jsx("option",{children:"Published"}),t.jsx("option",{children:"Draft"}),t.jsx("option",{children:"Archived"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm text-gray-400",children:"Live Highlight Status"}),t.jsxs("select",{value:L,onChange:j=>ae(j.target.value),className:"input-field bg-gray-900 border-gray-700 text-white focus:border-brand-purple font-bold shadow-[0_0_10px_rgba(239,68,68,0.1)]",children:[t.jsx("option",{value:"Past",children:"None (Standard)"}),t.jsx("option",{value:"Live",children:"LIVE NOW (Home Highlight)"}),t.jsx("option",{value:"Upcoming",children:"Upcoming"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Live Date/Time (Display Only)"}),t.jsx("input",{type:"text",placeholder:"e.g. Today, 10:00 AM",value:fe,onChange:j=>D(j.target.value),className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple"})]})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"label-sm",children:"Typing Content (Article)"}),t.jsx("textarea",{value:xe,onChange:j=>W(j.target.value),className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple h-48 font-mono text-sm leading-relaxed",placeholder:"Paste the exam text paragraph here..."}),t.jsxs("p",{className:"text-[10px] text-gray-400 mt-1 text-right",children:[xe.split(" ").length," words  ",xe.length," characters"]})]}),t.jsxs("div",{className:"mt-8 flex justify-end gap-3 border-t border-gray-800 pt-6",children:[t.jsx("button",{onClick:()=>c(!1),className:"btn-secondary text-gray-400 hover:text-white transition-colors",children:"Discard"}),t.jsx("button",{onClick:aa,className:"btn-primary shadow-[0_0_15px_rgba(192,38,211,0.3)]",children:"Save Exam Data"})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Es.length===0?t.jsxs("div",{className:"col-span-full py-12 text-center border-2 border-dashed border-gray-800 rounded-2xl bg-gray-900/30",children:[t.jsx(Ze,{size:48,className:"mx-auto text-gray-700 mb-4"}),t.jsx("p",{className:"text-gray-500 font-bold",children:"No exams match your search."}),t.jsx("button",{onClick:()=>{ks(""),Cs("")},className:"text-brand-purple text-sm font-bold mt-2 hover:underline",children:"Clear Filters"})]}):Es.map(j=>t.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 hover:border-brand-purple/50 rounded-2xl p-6 shadow-xl transition-all group backdrop-blur-sm relative overflow-hidden",children:[t.jsx("div",{className:`absolute top-0 left-0 w-1 h-full ${j.status==="Published"?"bg-green-500":"bg-gray-700"}`}),t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsx("span",{className:`text-[10px] font-bold px-3 py-1 rounded-full border shadow-sm ${j.status==="Published"?"bg-green-900/20 text-green-400 border-green-800":"bg-gray-800 text-gray-500 border-gray-700"}`,children:j.status}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>na(j),className:"text-gray-400 hover:text-brand-purple p-2 hover:bg-brand-purple/10 rounded-lg transition-colors",children:t.jsx($t,{size:16})}),t.jsx("button",{onClick:()=>e(s.filter(O=>O.id!==j.id)),className:"text-gray-400 hover:text-red-500 p-2 hover:bg-red-500/10 rounded-lg transition-colors",children:t.jsx(oe,{size:16})})]})]}),t.jsx("h3",{className:"font-bold text-gray-200 mt-2 text-lg line-clamp-2 min-h-[56px]",children:j.title}),t.jsxs("div",{className:"mt-4 p-4 bg-gray-950/50 rounded-xl border border-gray-800 space-y-3",children:[t.jsxs("div",{className:"flex justify-between items-center text-[11px] tracking-wide",children:[t.jsx("span",{className:"text-gray-500 font-bold uppercase",children:"Language"}),t.jsx("span",{className:"font-bold text-gray-200",children:j.language})]}),t.jsxs("div",{className:"flex justify-between items-center text-[11px] tracking-wide",children:[t.jsx("span",{className:"text-gray-500 font-bold uppercase",children:"Active Rule"}),t.jsx("span",{className:"font-bold text-brand-purple truncate max-w-[120px]",children:j.ruleSet})]}),j.liveStatus&&j.liveStatus!=="Past"&&t.jsxs("div",{className:"flex justify-between items-center text-[11px] bg-red-900/20 p-2 rounded border border-red-900/50",children:[t.jsxs("span",{className:"text-red-400 font-bold uppercase flex items-center gap-1",children:[t.jsx(kt,{size:10})," Live Mode"]}),t.jsx("span",{className:"font-bold text-red-500",children:j.liveStatus})]})]})]},j.id))})]})},ol=({settings:s,setSettings:e})=>{var l,c,h;const[r,a]=_.useState("identity"),i=async()=>{if(confirm("Download legacy user data as CSV for Supabase import?"))try{const d=await fetch("/data/secure_data.json");if(!d.ok)throw new Error("Failed to load secure_data.json");const g=(await d.json()).users||[];if(g.length===0){alert("No legacy users found.");return}const u=[["id","email","name","password","role","plan","status","joined"].join(","),...g.map(x=>[x.id,x.email,`"${x.name}"`,x.password,x.role,x.plan,x.status,x.joined].join(","))].join(`
`),b=new Blob([u],{type:"text/csv"}),m=window.URL.createObjectURL(b),y=document.createElement("a");y.href=m,y.download=`legacy_users_export_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(y),y.click(),document.body.removeChild(y),window.URL.revokeObjectURL(m)}catch(d){alert("Error exporting users: "+d.message),console.error(d)}},n=(d,f)=>{e({...s,[d]:f})},o=[{id:"identity",label:"Site Identity",icon:Tt},{id:"payments",label:"Payments",icon:vr},{id:"access",label:"User Access",icon:wr},{id:"comm",label:"Communication",icon:Sr},{id:"sales",label:"Sales Logic",icon:Aa},{id:"content",label:"Dynamic UI",icon:is},{id:"marketing",label:"Marketing",icon:Ta},{id:"support",label:"Support",icon:Pa},{id:"health",label:"System Health",icon:Os}];return t.jsxs("div",{className:"flex gap-8 h-[calc(100vh-180px)] overflow-hidden",children:[t.jsxs("div",{className:"w-64 shrink-0 flex flex-col gap-1 overflow-y-auto pr-2 custom-scrollbar",children:[t.jsx("h3",{className:"px-4 text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-4",children:"Settings Categories"}),o.map(d=>t.jsxs("button",{onClick:()=>a(d.id),className:`flex items-center gap-3 px-4 py-3 rounded-xl font-bold transition-all text-sm ${r===d.id?"bg-brand-purple text-white shadow-lg shadow-purple-900/20":"text-gray-400 hover:bg-gray-800/50 hover:text-white"}`,children:[t.jsx(d.icon,{size:18,className:r===d.id?"text-white":"text-gray-500"}),d.label]},d.id))]}),t.jsxs("div",{className:"flex-1 flex flex-col bg-gray-900/30 border border-gray-800 rounded-2xl overflow-hidden backdrop-blur-sm",children:[t.jsxs("div",{className:"p-6 border-b border-gray-800 flex justify-between items-center bg-gray-900/50",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-display font-bold text-white capitalize",children:[r.replace("-"," ")," Settings"]}),t.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Configure your platform's ",r," parameters."]})]}),t.jsxs("button",{onClick:async()=>{await M(H()),alert("Settings Synchronized Successfully!")},className:"btn-primary flex items-center gap-2",children:[t.jsx(gt,{size:16})," Sync to Live"]})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-8 space-y-8 custom-scrollbar",children:[r==="identity"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Site Name"}),t.jsx("input",{className:"input-field",value:s.siteName,onChange:d=>n("siteName",d.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Site Tagline"}),t.jsx("input",{className:"input-field",value:s.siteTagline,onChange:d=>n("siteTagline",d.target.value)})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Favicon URL"}),t.jsx("input",{className:"input-field",value:s.faviconUrl,onChange:d=>n("faviconUrl",d.target.value),placeholder:"https://..."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Logo (Light Mode)"}),t.jsx("input",{className:"input-field",value:s.logoLightUrl,onChange:d=>n("logoLightUrl",d.target.value)})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Timezone"}),t.jsxs("select",{className:"input-field",value:s.timezone,onChange:d=>n("timezone",d.target.value),children:[t.jsx("option",{value:"Asia/Kolkata",children:"Asia/Kolkata (IST)"}),t.jsx("option",{value:"UTC",children:"UTC"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Currency Symbol"}),t.jsx("input",{className:"input-field",value:s.currencySymbol,onChange:d=>n("currencySymbol",d.target.value)})]})]}),t.jsxs("div",{className:"border-t border-gray-800 pt-6",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(Tt,{size:16})," SEO & Metadata"]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Homepage Title (SEO)"}),t.jsx("input",{className:"input-field",value:s.seoTitle,onChange:d=>n("seoTitle",d.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Meta Keywords"}),t.jsx("input",{className:"input-field",value:s.seoKeywords,onChange:d=>n("seoKeywords",d.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Robots.txt Content"}),t.jsx("textarea",{className:"input-field h-24 font-mono text-xs",value:s.robotsTxt||"",onChange:d=>n("robotsTxt",d.target.value)})]})]})]}),t.jsxs("div",{className:"border-t border-gray-800 pt-6",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(Ra,{size:16})," Maintenance Control"]}),t.jsxs("div",{className:"bg-gray-900 p-4 rounded-xl border border-gray-800 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-bold text-gray-200",children:'Global "Site Off" / Maintenance Mode'}),t.jsx("div",{className:"text-xs text-gray-500",children:"Enable this to prevent non-admin users from accessing the site."})]}),t.jsx("button",{onClick:()=>n("maintenanceMode",!s.maintenanceMode),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${s.maintenanceMode?"bg-red-600":"bg-gray-700"}`,children:t.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${s.maintenanceMode?"translate-x-6":"translate-x-1"}`})})]}),s.maintenanceMode&&t.jsxs("div",{className:"mt-4",children:[t.jsx("label",{className:"label-sm",children:"Custom Maintenance Message"}),t.jsx("textarea",{className:"input-field h-20",value:s.maintenanceMessage,onChange:d=>n("maintenanceMessage",d.target.value)})]})]})]}),r==="payments"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-gray-900/50 p-6 rounded-2xl border border-gray-800",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(kt,{size:16})," Razorpay"]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Key ID"}),t.jsx("input",{className:"input-field font-mono text-xs",value:s.razorpayKeyId,onChange:d=>n("razorpayKeyId",d.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Key Secret"}),t.jsx("input",{className:"input-field font-mono text-xs",type:"password",value:s.razorpaySecret,onChange:d=>n("razorpaySecret",d.target.value)})]})]})]}),t.jsxs("div",{className:"bg-gray-900/50 p-6 rounded-2xl border border-gray-800",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(Fe,{size:16})," Mode & UPI"]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Payment Mode"}),t.jsxs("select",{className:"input-field",value:s.paymentMode,onChange:d=>n("paymentMode",d.target.value),children:[t.jsx("option",{value:"Sandbox",children:"Sandbox (Test Mode)"}),t.jsx("option",{value:"Live",children:"Live (Production Mode)"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Manual UPI ID"}),t.jsx("input",{className:"input-field",value:s.upiId,onChange:d=>n("upiId",d.target.value),placeholder:"merchant@upi"})]})]})]})]}),t.jsxs("div",{className:"border-t border-gray-800 pt-6",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(Ia,{size:16})," Invoicing System"]}),t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Invoice Prefix"}),t.jsx("input",{className:"input-field",value:s.invoicePrefix,onChange:d=>n("invoicePrefix",d.target.value),placeholder:"TN-2026-"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Tax Rate (%)"}),t.jsx("input",{className:"input-field",type:"number",value:s.taxRate,onChange:d=>n("taxRate",Number(d.target.value))})]}),t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"label-sm",children:"Company Billing Address"}),t.jsx("textarea",{className:"input-field h-20",value:s.companyAddress,onChange:d=>n("companyAddress",d.target.value)})]})]})]})]}),r==="access"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-900/50 p-6 rounded-2xl border border-gray-800",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(Ls,{size:16})," Session Security"]}),t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Multi-Device Login Limit"}),t.jsx("input",{className:"input-field",type:"number",value:s.multiDeviceLimit,onChange:d=>n("multiDeviceLimit",Number(d.target.value))}),t.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:"Number of screens a user can be logged into simultaneously."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Session Timeout (Hours)"}),t.jsx("input",{className:"input-field",type:"number",value:s.sessionTimeout,onChange:d=>n("sessionTimeout",Number(d.target.value))})]})]})]}),t.jsxs("div",{className:"bg-gray-800/30 p-6 rounded-2xl border border-gray-800",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(Oa,{size:16})," Restricted Access"]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Global IP Ban List (Comma-separated)"}),t.jsx("textarea",{className:"input-field h-24 font-mono text-xs",value:((l=s.ipBanList)==null?void 0:l.join(", "))||"",onChange:d=>n("ipBanList",d.target.value.split(",").map(f=>f.trim())),placeholder:"1.2.3.4, 5.6.7.8"})]})]}),t.jsxs("div",{className:"bg-gray-800/30 p-6 rounded-2xl border border-gray-800 border-l-4 border-l-blue-500",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-2 flex items-center gap-2",children:[t.jsx(Rt,{size:16})," Legacy Data Migration"]}),t.jsx("p",{className:"text-xs text-gray-400 mb-4",children:"Export users from the legacy JSON database to CSV for import into Supabase."}),t.jsxs("button",{onClick:i,className:"btn-primary flex items-center gap-2 text-xs",children:[t.jsx(Ue,{size:14})," Export Legacy Users (CSV)"]})]})]}),r==="comm"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-900/50 p-6 rounded-2xl border border-gray-800",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(kr,{size:16})," SMTP / Email Server"]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Host"}),t.jsx("input",{className:"input-field font-mono text-xs",value:s.smtpHost,onChange:d=>n("smtpHost",d.target.value),placeholder:"smtp.gmail.com"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Port"}),t.jsx("input",{className:"input-field font-mono text-xs",value:s.smtpPort,onChange:d=>n("smtpPort",Number(d.target.value)),placeholder:"587"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Username"}),t.jsx("input",{className:"input-field font-mono text-xs",value:s.smtpUser,onChange:d=>n("smtpUser",d.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Password"}),t.jsx("input",{className:"input-field font-mono text-xs",type:"password",value:s.smtpPass,onChange:d=>n("smtpPass",d.target.value)})]})]})]}),t.jsxs("div",{children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(La,{size:16})," API Gateways"]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"SMS Gateway API URL"}),t.jsx("input",{className:"input-field",value:s.smsApiUrl,onChange:d=>n("smsApiUrl",d.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"WhatsApp API Key"}),t.jsx("input",{className:"input-field",value:s.whatsappApiKey,onChange:d=>n("whatsappApiKey",d.target.value)})]})]})]})]}),r==="sales"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-900/50 p-6 rounded-2xl border border-gray-800",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(Da,{size:16})," Bulk Discount Rules"]}),t.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Set rules for multi-license or bulk package purchases."}),t.jsxs("div",{className:"space-y-3",children:[(s.bulkDiscounts||[]).map((d,f)=>t.jsxs("div",{className:"flex gap-4 items-end",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"label-sm",children:"Min Quantity"}),t.jsx("input",{className:"input-field",type:"number",value:d.minQty,onChange:g=>{const p=[...s.bulkDiscounts||[]];p[f].minQty=Number(g.target.value),n("bulkDiscounts",p)}})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"label-sm",children:"Discount %"}),t.jsx("input",{className:"input-field",type:"number",value:d.discount,onChange:g=>{const p=[...s.bulkDiscounts||[]];p[f].discount=Number(g.target.value),n("bulkDiscounts",p)}})]}),t.jsx("button",{onClick:()=>{const g=(s.bulkDiscounts||[]).filter((p,u)=>u!==f);n("bulkDiscounts",g)},className:"btn-secondary text-red-400 hover:text-red-300 h-[38px]",children:t.jsx(oe,{size:16})})]},f)),t.jsxs("button",{onClick:()=>n("bulkDiscounts",[...s.bulkDiscounts||[],{minQty:10,discount:5}]),className:"btn-primary flex items-center gap-2 text-xs",children:[t.jsx(ue,{size:14})," Add Rule"]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsx("div",{className:"bg-gray-800/20 p-4 rounded-xl border border-gray-800",children:t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:s.contentDripEnabled,onChange:d=>n("contentDripEnabled",d.target.checked)}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-bold text-gray-200",children:"Scheduled Content Unlock"}),t.jsx("p",{className:"text-[10px] text-gray-500",children:"Enable drip content logic for courses."})]})]})}),t.jsxs("div",{className:"bg-gray-800/20 p-4 rounded-xl border border-gray-800",children:[t.jsx("label",{className:"label-sm",children:"Expiry Reminders (Days before)"}),t.jsx("input",{className:"input-field",value:((c=s.expiryReminders)==null?void 0:c.join(", "))||"",onChange:d=>n("expiryReminders",d.target.value.split(",").map(f=>parseInt(f.trim())))})]})]})]}),r==="content"&&t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{className:"bg-gray-800/20 p-6 rounded-2xl border border-gray-800",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-6 flex items-center gap-2",children:[t.jsx(kt,{size:16})," Homepage Hero Section"]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Hero Title"}),t.jsx("input",{className:"input-field",value:s.heroTitle,onChange:d=>n("heroTitle",d.target.value),placeholder:"India's #1 Platform for..."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Hero Subtitle"}),t.jsx("textarea",{className:"input-field h-20",value:s.heroSubtitle,onChange:d=>n("heroSubtitle",d.target.value)})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"CTA Button Text"}),t.jsx("input",{className:"input-field",value:s.heroCTAText,onChange:d=>n("heroCTAText",d.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"CTA Target Link"}),t.jsx("input",{className:"input-field font-mono text-xs",value:s.heroCTALink,onChange:d=>n("heroCTALink",d.target.value)})]})]})]})]}),t.jsxs("div",{children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(is,{size:16})," Homepage Banners"]}),t.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[(s.homeBanners||[]).map((d,f)=>t.jsxs("div",{className:"p-4 bg-gray-900 border border-gray-700 rounded-xl relative group",children:[t.jsx("button",{onClick:()=>{const g=(s.homeBanners||[]).filter((p,u)=>u!==f);n("homeBanners",g)},className:"absolute top-2 right-2 p-1.5 bg-gray-800 text-red-400 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx(oe,{size:14})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Image URL"}),t.jsx("input",{className:"input-field",value:d.image,onChange:g=>{const p=[...s.homeBanners||[]];p[f].image=g.target.value,n("homeBanners",p)}})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Target Link"}),t.jsx("input",{className:"input-field",value:d.link,onChange:g=>{const p=[...s.homeBanners||[]];p[f].link=g.target.value,n("homeBanners",p)}})]})]}),t.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:d.active,onChange:g=>{const p=[...s.homeBanners||[]];p[f].active=g.target.checked,n("homeBanners",p)}}),t.jsx("span",{className:"text-xs text-gray-400",children:"Active"})]})]},f)),t.jsxs("div",{className:"p-4 bg-gray-900 border border-dashed border-gray-700 rounded-xl text-center hover:bg-gray-800/50 transition-colors cursor-pointer",onClick:()=>n("homeBanners",[...s.homeBanners||[],{id:Date.now(),image:"",link:"",active:!0}]),children:[t.jsxs("button",{className:"text-brand-purple text-sm font-bold flex items-center gap-2 mx-auto",children:[t.jsx(ue,{size:16})," Add New Banner"]}),t.jsx("p",{className:"text-[10px] text-gray-500 mt-2",children:"Recommended size: 1920x600px"})]})]})]}),t.jsxs("div",{className:"border-t border-gray-800 pt-6",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(kt,{size:16})," Live Exam Configuration"]}),t.jsxs("div",{className:"bg-gray-950 p-4 rounded-xl border border-gray-800 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-bold text-gray-200",children:"Enable 24h Auto-Live Exam"}),t.jsx("div",{className:"text-xs text-gray-500",children:'Automatically rotates a random "Published" exam as the "Live" exam every 24 hours.'})]}),t.jsx("button",{onClick:()=>n("autoLiveExamEnabled",!s.autoLiveExamEnabled),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${s.autoLiveExamEnabled!==!1?"bg-brand-purple":"bg-gray-700"}`,children:t.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${s.autoLiveExamEnabled!==!1?"translate-x-6":"translate-x-1"}`})})]})]}),t.jsxs("div",{className:"border-t border-gray-800 pt-6",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(Ls,{size:16})," Practice Lab (Exam Library)"]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Practice Lab Title"}),t.jsx("input",{className:"input-field",value:s.practiceLabTitle||"Choose Your Exam",onChange:d=>n("practiceLabTitle",d.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Practice Lab Subtitle"}),t.jsx("input",{className:"input-field",value:s.practiceLabSubtitle||"Pick your target exam category and start mastering your typing speed today.",onChange:d=>n("practiceLabSubtitle",d.target.value)})]}),t.jsxs("div",{className:"bg-gray-800/20 p-4 rounded-xl border border-gray-800 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-bold text-gray-200",children:"Show Social Proof (Student Count)"}),t.jsx("div",{className:"text-xs text-gray-500",children:"Displays a random (2000+) count on each exam category."})]}),t.jsx("button",{onClick:()=>n("showStudentCount",!s.showStudentCount),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${s.showStudentCount?"bg-green-600":"bg-gray-700"}`,children:t.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${s.showStudentCount?"translate-x-6":"translate-x-1"}`})})]})]})]}),t.jsxs("div",{className:"border-t border-gray-800 pt-6",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(Ua,{size:16})," Legal Page Editor"]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Refund & Cancellation Policy"}),t.jsx("textarea",{className:"input-field h-32",value:s.legalRefund,onChange:d=>n("legalRefund",d.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Privacy Policy"}),t.jsx("textarea",{className:"input-field h-32",value:s.legalPrivacy,onChange:d=>n("legalPrivacy",d.target.value)})]})]})]}),t.jsxs("div",{className:"border-t border-gray-800 pt-6",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx($a,{size:16})," Footer Links (Bottom Bar)"]}),t.jsxs("div",{className:"space-y-3",children:[(s.footerLinks||[]).map((d,f)=>t.jsxs("div",{className:"flex gap-4",children:[t.jsx("input",{className:"input-field flex-1",value:d.label,onChange:g=>{const p=[...s.footerLinks];p[f].label=g.target.value,n("footerLinks",p)},placeholder:"Label"}),t.jsx("input",{className:"input-field flex-1",value:d.href,onChange:g=>{const p=[...s.footerLinks];p[f].href=g.target.value,n("footerLinks",p)},placeholder:"URL / Route"}),t.jsx("button",{onClick:()=>n("footerLinks",s.footerLinks.filter((g,p)=>p!==f)),className:"text-red-400 p-2",children:t.jsx(oe,{size:16})})]},f)),t.jsxs("button",{onClick:()=>n("footerLinks",[...s.footerLinks||[],{label:"",href:""}]),className:"btn-secondary text-xs py-1",children:[t.jsx(ue,{size:14})," Add Link"]})]})]}),t.jsxs("div",{className:"border-t border-gray-800 pt-6",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(Ma,{size:16})," Footer: Exams Covered"]}),t.jsxs("div",{className:"space-y-3",children:[(s.footerExams||[]).map((d,f)=>t.jsxs("div",{className:"flex gap-4",children:[t.jsx("input",{className:"input-field flex-1",value:d.label,onChange:g=>{const p=[...s.footerExams];p[f].label=g.target.value,n("footerExams",p)},placeholder:"Exam Name"}),t.jsx("input",{className:"input-field flex-1",value:d.href,onChange:g=>{const p=[...s.footerExams];p[f].href=g.target.value,n("footerExams",p)},placeholder:"/practice-exams"}),t.jsx("button",{onClick:()=>n("footerExams",s.footerExams.filter((g,p)=>p!==f)),className:"text-red-400 p-2",children:t.jsx(oe,{size:16})})]},f)),t.jsxs("button",{onClick:()=>n("footerExams",[...s.footerExams||[],{label:"",href:""}]),className:"btn-secondary text-xs py-1",children:[t.jsx(ue,{size:14})," Add Exam Link"]})]})]})]}),r==="marketing"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-blue-900/10 p-6 rounded-2xl border border-blue-900/30",children:[t.jsxs("h4",{className:"font-bold text-blue-400 mb-4 flex items-center gap-2",children:[t.jsx(Ba,{size:16})," Tracking & Scripts"]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Google Analytics ID"}),t.jsx("input",{className:"input-field font-mono text-xs",value:s.googleAnalyticsId,onChange:d=>n("googleAnalyticsId",d.target.value),placeholder:"G-XXXXXXXXXX"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Facebook Pixel ID"}),t.jsx("input",{className:"input-field font-mono text-xs",value:s.facebookPixelId,onChange:d=>n("facebookPixelId",d.target.value)})]})]}),t.jsxs("div",{className:"mt-4",children:[t.jsx("label",{className:"label-sm",children:"Custom Header Scripts"}),t.jsx("textarea",{className:"input-field h-24 font-mono text-[10px]",value:s.customHeaderScripts,onChange:d=>n("customHeaderScripts",d.target.value),placeholder:"<script>...<\/script>"})]})]}),t.jsxs("div",{className:"bg-gray-900/50 p-6 rounded-2xl border border-gray-800",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(Fa,{size:16})," Affiliate & Referral"]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer bg-gray-900 p-3 rounded-xl border border-gray-800",children:[t.jsx("input",{type:"checkbox",checked:s.affiliateEnabled,onChange:d=>n("affiliateEnabled",d.target.checked)}),t.jsx("span",{className:"text-sm text-gray-300 font-bold uppercase",children:"Enable Affiliate System"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Commission Rate (%)"}),t.jsx("input",{className:"input-field",type:"number",value:s.affiliateCommission,onChange:d=>n("affiliateCommission",Number(d.target.value))})]})]})]})]}),r==="support"&&t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"bg-gray-900/50 p-6 rounded-2xl border border-gray-800",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(za,{size:16})," Helpdesk Rules"]}),t.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Support Departments (Comma separated)"}),t.jsx("input",{className:"input-field",value:((h=s.supportDepartments)==null?void 0:h.join(", "))||"",onChange:d=>n("supportDepartments",d.target.value.split(",").map(f=>f.trim()))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Auto-Response Confirmation Message"}),t.jsx("textarea",{className:"input-field h-24",value:s.supportAutoReply,onChange:d=>n("supportAutoReply",d.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Escalation Threshold (Hours)"}),t.jsx("input",{className:"input-field w-32",type:"number",value:s.escalationHours,onChange:d=>n("escalationHours",Number(d.target.value))})]})]})]})}),r==="health"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("button",{onClick:()=>alert("Cache cleared successfully!"),className:"flex flex-col items-center justify-center p-8 bg-gray-900 border border-gray-800 rounded-2xl hover:bg-gray-800 transition-all group",children:[t.jsx(Mt,{size:32,className:"text-orange-500 mb-2 group-hover:rotate-180 transition-transform duration-500"}),t.jsx("span",{className:"font-bold text-white",children:"Clear System Cache"}),t.jsx("span",{className:"text-[10px] text-gray-500 uppercase mt-1",children:"Force update frontend stores"})]}),t.jsxs("button",{onClick:()=>alert("Manual backup initiated. Check your email when ready."),className:"flex flex-col items-center justify-center p-8 bg-gray-900 border border-gray-800 rounded-2xl hover:bg-gray-800 transition-all group",children:[t.jsx(Rt,{size:32,className:"text-blue-500 mb-2 group-hover:scale-110 transition-transform"}),t.jsx("span",{className:"font-bold text-white",children:"Download DB Backup"}),t.jsx("span",{className:"text-[10px] text-gray-500 uppercase mt-1",children:"Full database dump (SQL/JSON)"})]})]}),t.jsxs("div",{className:"bg-gray-900/50 p-6 rounded-2xl border border-gray-800",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-4 flex items-center gap-2",children:[t.jsx(Os,{size:16})," Advanced Health Rules"]}),t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer bg-gray-950 p-3 rounded-xl border border-gray-800",children:[t.jsx("input",{type:"checkbox",checked:s.autoBackupEnabled,onChange:d=>n("autoBackupEnabled",d.target.checked)}),t.jsx("span",{className:"text-sm text-gray-300 font-bold uppercase",children:"Enable Auto Backups"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Backup Interval (Hours)"}),t.jsx("input",{className:"input-field",type:"number",value:s.backupIntervalHours,onChange:d=>n("backupIntervalHours",Number(d.target.value))})]})]})]})]})]})]})]})},ll=({ads:s,setAds:e})=>{const[r,a]=_.useState({imageUrl:"",linkUrl:"",position:"RightSidebar"}),i=()=>{e([...s,{id:Date.now(),...r,isActive:!0}]),a({imageUrl:"",linkUrl:"",position:"RightSidebar"})},n=o=>{e(s.filter(l=>l.id!==o))};return t.jsxs("div",{className:"space-y-6",children:[t.jsx("h2",{className:"text-2xl font-bold font-display",children:"Ad Management"}),t.jsxs("div",{className:"bg-gray-900/50 p-6 rounded-xl border border-gray-800 shadow-sm space-y-4",children:[t.jsx("h3",{className:"font-bold text-gray-200",children:"Create New Ad Unit"}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Image URL"}),t.jsx("input",{className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple",placeholder:"https://...",value:r.imageUrl,onChange:o=>a({...r,imageUrl:o.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Destination Link"}),t.jsx("input",{className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple",placeholder:"https://...",value:r.linkUrl,onChange:o=>a({...r,linkUrl:o.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Position"}),t.jsxs("select",{className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple",value:r.position,onChange:o=>a({...r,position:o.target.value}),children:[t.jsx("option",{value:"TopBanner",children:"Top Banner (Above Hero)"}),t.jsx("option",{value:"LeftSidebar",children:"Left Sidebar"}),t.jsx("option",{value:"RightSidebar",children:"Right Sidebar"}),t.jsx("option",{value:"Footer",children:"Footer (Above Copyright)"})]})]}),t.jsx("div",{className:"flex items-end",children:t.jsx("button",{onClick:i,className:"btn-primary w-full",children:"Add Advertisement"})})]})]}),t.jsxs("div",{className:"grid gap-4",children:[s.map(o=>t.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-xl border border-gray-800 flex gap-4 items-center",children:[t.jsx("img",{src:o.imageUrl,alt:"Ad",className:"w-20 h-20 object-cover rounded bg-gray-100"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-bold text-sm bg-gray-100 px-2 py-1 rounded inline-block mb-1",children:o.position}),t.jsx("div",{className:"text-xs text-gray-500 truncate",children:o.linkUrl})]}),t.jsx("button",{onClick:()=>n(o.id),className:"p-2 text-red-500 hover:bg-red-50 p-2 rounded",children:t.jsx(oe,{size:18})})]},o.id)),s.length===0&&t.jsx("div",{className:"text-center text-gray-400 py-8",children:"No active advertisements."})]})]})},cl=({packages:s,setPackages:e})=>{const[r,a]=_.useState(!1),[i,n]=_.useState(null),[o,l]=_.useState({name:"",subtitle:"",price:"",currency:"",period:"/ Year",durationDays:30,features:[],isCombo:!1,highlight:!1,badge:"",type:"Student",buttonText:"Get Started"}),[c,h]=_.useState(""),d=()=>{l({name:"",subtitle:"",price:"",currency:"",period:"/ Year",durationDays:30,features:[],isCombo:!1,highlight:!1,badge:"",type:"Student",buttonText:"Get Started"}),n(null),a(!1)},f=m=>{l({...m,price:m.price.toString()}),n(m.id),a(!0)},g=()=>{c.trim()&&(l({...o,features:[...o.features,c.trim()]}),h(""))},p=m=>{l({...o,features:o.features.filter((y,x)=>x!==m)})},u=()=>{if(!o.name||!o.price)return alert("Name and Price are required");let m;if(i)m=s.map(y=>y.id===i?{...y,...o,price:Number(o.price)}:y);else{const y=s.length>0?Math.max(...s.map(x=>x.id))+1:1;m=[...s,{id:y,...o,price:Number(o.price)}]}e(m),d()},b=m=>{confirm("Are you sure you want to delete this package?")&&e(s.filter(y=>y.id!==m))};return t.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-display font-bold text-white",children:"Pricing & Packages"}),t.jsx("p",{className:"text-xs text-gray-400",children:"Manage subscription plans, combos, and pricing cards displayed on the website."})]}),!r&&t.jsxs("button",{onClick:()=>a(!0),className:"btn-primary flex items-center gap-2",children:[t.jsx(ue,{size:16})," Create New Package"]})]}),r&&t.jsxs("div",{className:"bg-gray-900/90 backdrop-blur-xl border-2 border-brand-purple rounded-xl shadow-lg p-6 mb-6",children:[t.jsxs("h3",{className:"font-bold text-lg mb-4 text-brand-purple flex items-center gap-2 border-b border-gray-800 pb-4",children:[t.jsx(ns,{size:20})," ",i?"Edit Package":"New Package Configuration"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Package Name"}),t.jsx("input",{className:"input-field",placeholder:"e.g. 1 Year Premium",value:o.name,onChange:m=>l({...o,name:m.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Subtitle / Tagline"}),t.jsx("input",{className:"input-field",placeholder:"e.g. Best for Students",value:o.subtitle,onChange:m=>l({...o,subtitle:m.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Type"}),t.jsxs("select",{className:"input-field",value:o.type,onChange:m=>l({...o,type:m.target.value}),children:[t.jsx("option",{value:"Student",children:"Student Plan"}),t.jsx("option",{value:"Institute",children:"Institute / Bulk"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Price (Amount)"}),t.jsx("input",{className:"input-field",type:"number",placeholder:"499",value:o.price,onChange:m=>l({...o,price:m.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Currency Symbol"}),t.jsx("input",{className:"input-field",placeholder:"",value:o.currency,onChange:m=>l({...o,currency:m.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Billing Period Text"}),t.jsx("input",{className:"input-field",placeholder:"e.g. / Year",value:o.period,onChange:m=>l({...o,period:m.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Duration (Days)"}),t.jsx("input",{className:"input-field",type:"number",placeholder:"365",value:o.durationDays,onChange:m=>l({...o,durationDays:Number(m.target.value)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"CTA Button Text"}),t.jsx("input",{className:"input-field",placeholder:"Get Started",value:o.buttonText,onChange:m=>l({...o,buttonText:m.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Ribbon Badge (Optional)"}),t.jsx("input",{className:"input-field",placeholder:"e.g. Best Value",value:o.badge||"",onChange:m=>l({...o,badge:m.target.value})})]})]}),t.jsxs("div",{className:"flex gap-6 mb-6 p-4 bg-gray-800/30 rounded-lg border border-gray-700",children:[t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4 accent-brand-purple",checked:o.isCombo,onChange:m=>l({...o,isCombo:m.target.checked})}),t.jsx("span",{className:"text-sm font-bold text-gray-300",children:"Is Combo Pack?"})]}),t.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4 accent-brand-purple",checked:o.highlight,onChange:m=>l({...o,highlight:m.target.checked})}),t.jsx("span",{className:"text-sm font-bold text-gray-300",children:"Highlight (Glow Effect)"})]})]}),t.jsxs("div",{className:"bg-gray-800/50 p-4 rounded-lg border border-gray-700 mb-6",children:[t.jsx("label",{className:"label-sm mb-2",children:"Included Features (Features List)"}),t.jsxs("div",{className:"flex gap-2 mb-3",children:[t.jsx("input",{className:"input-field",placeholder:"e.g. Unlimited Tests",value:c,onChange:m=>h(m.target.value),onKeyDown:m=>m.key==="Enter"&&g()}),t.jsx("button",{onClick:g,className:"bg-black text-white px-4 rounded font-bold text-xs hover:bg-gray-800 transition-colors",children:"ADD"})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.features.map((m,y)=>t.jsxs("span",{className:"bg-gray-800 border border-gray-700 px-3 py-1 rounded-full text-xs font-bold flex items-center gap-2 text-gray-200 group",children:[m," ",t.jsx("button",{onClick:()=>p(y),className:"text-red-500 hover:text-red-400 group-hover:block ml-1",children:""})]},y)),o.features.length===0&&t.jsx("span",{className:"text-xs text-gray-500 italic",children:"No features added yet."})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-800",children:[t.jsx("button",{onClick:d,className:"btn-secondary",children:"Cancel"}),t.jsx("button",{onClick:u,className:"btn-primary px-8",children:"Save Package"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6",children:[s.map(m=>{var y,x;return t.jsxs("div",{className:`bg-gray-900/50 p-6 rounded-xl border relative group transition-all hover:-translate-y-1 ${m.highlight?"border-brand-purple shadow-lg shadow-purple-900/10":"border-gray-800 hover:border-gray-700"}`,children:[(m.badge||m.isCombo)&&t.jsx("div",{className:`absolute top-0 right-0 text-[10px] font-bold px-3 py-1 rounded-bl-xl rounded-tr-xl text-white ${m.isCombo?"bg-gradient-to-r from-blue-600 to-cyan-600":"bg-brand-purple"}`,children:m.badge||(m.isCombo?"COMBO":"")}),t.jsxs("div",{className:"mt-2",children:[t.jsx("h3",{className:"font-bold text-lg text-white",children:m.name}),t.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-wider font-bold mb-4",children:m.subtitle})]}),t.jsxs("div",{className:"flex items-baseline gap-1 mb-6",children:[t.jsx("span",{className:"text-lg font-bold text-gray-400",children:m.currency}),t.jsx("span",{className:"text-3xl font-display font-bold text-white",children:m.price}),t.jsx("span",{className:"text-xs text-gray-500 font-medium",children:m.period})]}),t.jsxs("div",{className:"space-y-3 mb-6 min-h-[100px]",children:[(y=m.features)==null?void 0:y.slice(0,4).map((w,v)=>t.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-300",children:[t.jsx("div",{className:"w-5 h-5 rounded-full bg-gray-800 flex items-center justify-center shrink-0",children:t.jsx(ss,{size:10,className:"text-green-400"})}),t.jsx("span",{className:"line-clamp-1",children:w})]},v)),((x=m.features)==null?void 0:x.length)>4&&t.jsxs("div",{className:"text-xs text-gray-500 pl-8",children:["+",m.features.length-4," more features"]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>f(m),className:"flex-1 py-2 border border-blue-900/50 bg-blue-900/10 text-blue-400 rounded-lg text-xs font-bold hover:bg-blue-900/20 transition-colors flex items-center justify-center gap-2",children:[t.jsx($t,{size:14})," Edit"]}),t.jsxs("button",{onClick:()=>b(m.id),className:"flex-1 py-2 border border-red-900/50 bg-red-900/10 text-red-400 rounded-lg text-xs font-bold hover:bg-red-900/20 transition-colors flex items-center justify-center gap-2",children:[t.jsx(oe,{size:14})," Delete"]})]})]},m.id)}),s.length===0&&t.jsxs("div",{className:"col-span-full py-20 text-center border-2 border-dashed border-gray-800 rounded-2xl",children:[t.jsx(ns,{size:48,className:"mx-auto text-gray-700 mb-4"}),t.jsx("h3",{className:"text-gray-400 font-bold mb-2",children:"No Packages Found"}),t.jsx("p",{className:"text-gray-600 text-sm",children:"Create your first subscription plan to get started."})]})]})]})},dl=s=>s?new Date().getTime()-new Date(s).getTime()<300*1e3:!1,ul=({users:s,setUsers:e,toggleUserStatus:r,deleteUser:a})=>{const[i,n]=_.useState([]),[o,l]=_.useState(!0),[c,h]=_.useState(!1),[d,f]=_.useState(null),[g,p]=_.useState({name:"",email:"",plan:"Free",role:"User",status:"Active",purchasedPackIds:[],password:""}),[u,b]=_.useState([]),[m,y]=_.useState("All"),[x,w]=_.useState("All"),[v,k]=_.useState("All"),[S,T]=_.useState("All"),[P,F]=_.useState(""),me=H(),L=me.comboPacks||[],ae=me.plans||[];_.useEffect(()=>{fe()},[]);const fe=async()=>{l(!0);const{fetchAppUsers:N}=await Et(async()=>{const{fetchAppUsers:X}=await Promise.resolve().then(()=>es);return{fetchAppUsers:X}},void 0),J=(await N()).map(X=>({...X,purchasedPackIds:X.purchasedPackIds||[]}));n(J),l(!1)},D=i.filter(N=>{var xe,W;const U=(((xe=N.name)==null?void 0:xe.toLowerCase())||"").includes(P.toLowerCase())||(((W=N.email)==null?void 0:W.toLowerCase())||"").includes(P.toLowerCase()),J=m==="All"||N.role===m,X=x==="All"||(N.plan||"Free")===x,te=v==="All"||(N.status||"Active")===v,ge=S==="All"||N.purchasedPackIds&&N.purchasedPackIds.includes(S);return U&&J&&X&&te&&ge}),C=N=>{N.target.checked?b(D.map(U=>U.id)):b([])},B=N=>{u.includes(N)?b(u.filter(U=>U!==N)):b([...u,N])},V=N=>{const U=N.toString();g.purchasedPackIds.includes(U)?p({...g,purchasedPackIds:g.purchasedPackIds.filter(J=>J!==U)}):p({...g,purchasedPackIds:[...g.purchasedPackIds,U]})},G=N=>{f(N.id),p({name:N.name,email:N.email,plan:N.plan,role:N.role,status:N.status,purchasedPackIds:N.purchasedPackIds||[],password:""}),h(!0)},I=async()=>{const{updateAppUser:N,sendPasswordReset:U}=await Et(async()=>{const{updateAppUser:X,sendPasswordReset:te}=await Promise.resolve().then(()=>es);return{updateAppUser:X,sendPasswordReset:te}},void 0),J={name:g.name,plan:g.plan,role:g.role,status:g.status,purchasedPackIds:g.purchasedPackIds};d?await N(d,J)?(Zr({adminName:"Admin",action:"User Updated",details:`Updated ${g.email}: Role=${g.role}, Plan=${g.plan}`,type:"success"}),n(i.map(te=>te.id===d?{...te,...J}:te)),h(!1)):alert("Failed to update user in database."):alert("Please ask user to Sign Up via the website. Admins can only edit existing users for security.")},ne=async()=>{if(g.email&&confirm(`Send password reset email to ${g.email}?`)){const{sendPasswordReset:N}=await Et(async()=>{const{sendPasswordReset:X}=await Promise.resolve().then(()=>es);return{sendPasswordReset:X}},void 0),{success:U,msg:J}=await N(g.email);alert(J)}};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold font-display text-white",children:"User Management"}),t.jsx("p",{className:"text-sm text-gray-400",children:"Manage students, assign plans, and control access."})]}),t.jsx("div",{className:"flex gap-2",children:t.jsx("button",{onClick:fe,className:"btn-secondary",children:t.jsx(Mt,{size:16})})})]}),t.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 p-4 rounded-xl flex flex-wrap gap-4 items-center",children:[t.jsxs("div",{className:"flex-1 min-w-[200px] relative",children:[t.jsx(ys,{size:16,className:"absolute left-3 top-2.5 text-gray-500"}),t.jsx("input",{className:"input-field pl-10 bg-gray-950 border-gray-700",placeholder:"Search by name or email...",value:P,onChange:N=>F(N.target.value)})]}),t.jsxs("select",{className:"input-field w-32 bg-gray-950 border-gray-700",value:m,onChange:N=>y(N.target.value),children:[t.jsx("option",{value:"All",children:"All Roles"}),t.jsx("option",{value:"User",children:"User"}),t.jsx("option",{value:"Admin",children:"Admin"}),t.jsx("option",{value:"Moderator",children:"Moderator"}),t.jsx("option",{value:"Super Admin",children:"Super Admin"})]}),t.jsxs("select",{className:"input-field w-32 bg-gray-950 border-gray-700",value:x,onChange:N=>w(N.target.value),children:[t.jsx("option",{value:"All",children:"All Plans"}),t.jsx("option",{value:"Free",children:"Free"}),ae.map(N=>t.jsx("option",{value:N.name,children:N.name},N.id))]}),t.jsxs("select",{className:"input-field w-40 bg-gray-950 border-gray-700",value:S,onChange:N=>T(N.target.value),children:[t.jsx("option",{value:"All",children:"All Combo Packs"}),L.map(N=>t.jsx("option",{value:N.id,children:N.title},N.id))]})]}),c&&t.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:t.jsxs("div",{className:"bg-gray-900 border border-gray-700 w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]",children:[t.jsxs("div",{className:"p-6 border-b border-gray-800 flex justify-between items-center",children:[t.jsx("h3",{className:"text-xl font-bold text-white",children:d?"Edit User Access":"Add New User"}),t.jsx("button",{onClick:()=>h(!1),className:"text-gray-500 hover:text-white",children:t.jsx(_e,{size:20})})]}),t.jsxs("div",{className:"p-6 overflow-y-auto space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Full Name"}),t.jsx("input",{type:"text",value:g.name,onChange:N=>p({...g,name:N.target.value}),className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple",placeholder:"John Doe"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Email Address"}),t.jsx("input",{type:"email",value:g.email,onChange:N=>p({...g,email:N.target.value}),className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple",placeholder:"john@example.com"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Subscription Plan"}),t.jsxs("select",{value:g.plan,onChange:N=>p({...g,plan:N.target.value}),className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple font-bold",children:[t.jsx("option",{value:"Free",children:"Free Tier"}),t.jsx("option",{value:"Pro Monthly",children:"Pro Monthly (Paid)"}),t.jsx("option",{value:"Pro Yearly",children:"Pro Yearly (Paid)"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"System Role"}),t.jsxs("select",{value:g.role,onChange:N=>p({...g,role:N.target.value}),className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple",children:[t.jsx("option",{value:"User",children:"Student"}),t.jsx("option",{value:"Moderator",children:"Moderator"}),t.jsx("option",{value:"Admin",children:"Administrator"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Account Status"}),t.jsxs("select",{value:g.status,onChange:N=>p({...g,status:N.target.value}),className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple font-bold",children:[t.jsx("option",{value:"Active",children:"Active"}),t.jsx("option",{value:"Inactive",children:"Inactive"}),t.jsx("option",{value:"Banned",children:"Banned"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Security"}),t.jsx("p",{className:"text-xs text-gray-400",children:'Use the "Send Reset Email" button below to allow the student to securely change their own password.'})]})]}),t.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-xl border border-gray-800 mb-4",children:[t.jsxs("h4",{className:"font-bold text-gray-200 mb-3 text-sm flex items-center gap-2",children:[t.jsx(Pt,{size:16,className:"text-brand-purple"})," Grant Combo Pack Access"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 max-h-40 overflow-y-auto",children:[L.length===0&&t.jsx("span",{className:"text-gray-500 text-xs italic",children:"No combo packs available. Create one in Combo Packs tab."}),L.map(N=>t.jsxs("label",{className:"flex items-center gap-2 p-2 rounded hover:bg-gray-800 cursor-pointer border border-transparent hover:border-gray-700 transition-colors",children:[t.jsx("input",{type:"checkbox",className:"accent-brand-purple w-4 h-4 rounded",checked:g.purchasedPackIds.includes(N.id),onChange:()=>V(N.id)}),t.jsxs("div",{className:"text-xs",children:[t.jsx("div",{className:"font-bold text-gray-300",children:N.title}),t.jsxs("div",{className:"text-gray-500",children:["",N.price]})]})]},N.id))]}),t.jsx("p",{className:"text-[10px] text-gray-400 mt-2 italic",children:"* Checked items will be accessible to this user immediately."})]}),t.jsxs("div",{className:"flex justify-between items-center mt-6",children:[t.jsx("div",{className:"flex gap-2",children:d&&t.jsxs("button",{onClick:ne,className:"bg-orange-600/20 text-orange-500 border border-orange-600/50 px-3 py-2 rounded-lg text-xs font-bold hover:bg-orange-600/30 transition-colors flex items-center gap-2",children:[t.jsx(Sr,{size:14})," Send Reset Email"]})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>h(!1),className:"btn-secondary",children:"Cancel"}),t.jsx("button",{onClick:I,className:"btn-primary",children:d?"Save Changes":"Create Account"})]})]})]})]})}),t.jsx("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl shadow-2xl overflow-hidden backdrop-blur-sm",children:o?t.jsx("div",{className:"p-8 text-center text-gray-400",children:"Loading users..."}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-sm text-left",children:[t.jsx("thead",{className:"bg-gray-800/50 text-gray-400 font-bold uppercase text-[10px] tracking-[0.2em] border-b border-gray-800",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-4 w-10",children:t.jsx("input",{type:"checkbox",checked:D.length>0&&u.length===D.length,onChange:C,className:"rounded border-gray-700 bg-gray-800 text-brand-purple focus:ring-0 focus:ring-offset-0"})}),t.jsx("th",{className:"px-6 py-4",children:"Student Profile"}),t.jsx("th",{className:"px-6 py-4",children:"Access Tier"}),t.jsx("th",{className:"px-6 py-4",children:"Combo Packs"}),t.jsx("th",{className:"px-6 py-4",children:"Status"}),t.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-800",children:D.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:"No users found matching filters."})}):D.map(N=>t.jsxs("tr",{className:`hover:bg-brand-purple/5 transition-all group ${u.includes(N.id)?"bg-brand-purple/10":""}`,children:[t.jsx("td",{className:"px-6 py-4 w-10",children:t.jsx("input",{type:"checkbox",checked:u.includes(N.id),onChange:U=>{U.stopPropagation(),B(N.id)},className:"rounded border-gray-700 bg-gray-800 text-brand-purple focus:ring-0 focus:ring-offset-0"})}),t.jsxs("td",{className:"px-6 py-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"font-bold text-gray-200 group-hover:text-white",children:N.name}),dl(N.last_seen)&&t.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]",title:"Online Now"})]}),t.jsx("div",{className:"text-[10px] text-gray-500 font-mono uppercase tracking-tight",children:N.email}),t.jsx("div",{className:"text-[10px] text-gray-600 mt-1 flex gap-2",children:t.jsxs("span",{children:["Joined: ",new Date(N.joined).toLocaleDateString()]})})]}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold border ${N.plan&&N.plan.includes("Pro")?"bg-brand-purple/20 text-brand-purple border-brand-purple/30":"bg-gray-800 text-gray-500 border-gray-700"}`,children:N.plan||"Free"})}),t.jsx("td",{className:"px-6 py-4",children:N.purchasedPackIds&&N.purchasedPackIds.length>0?t.jsxs("span",{className:"text-xs text-brand-purple font-bold",children:[N.purchasedPackIds.length," Packs Owned"]}):t.jsx("span",{className:"text-xs text-gray-600",children:"-"})}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("span",{className:`px-2 py-1 rounded text-[10px] font-bold ${N.status==="Active"?"text-green-500 bg-green-900/10":"text-red-500 bg-red-900/10"}`,children:N.status})}),t.jsx("td",{className:"px-6 py-4 text-right",children:t.jsx("button",{onClick:()=>G(N),className:"text-brand-purple hover:text-white font-bold text-xs",children:"Edit"})})]},N.id))})]})})}),c&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:t.jsxs("div",{className:"bg-gray-900 border border-gray-700 w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]",children:[t.jsxs("div",{className:"p-6 border-b border-gray-800 flex justify-between items-center",children:[t.jsx("h3",{className:"text-xl font-bold text-white",children:"Edit User Access"}),t.jsx("button",{onClick:()=>h(!1),className:"text-gray-500 hover:text-white",children:t.jsx(_e,{size:20})})]}),t.jsxs("div",{className:"p-6 overflow-y-auto space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Name"}),t.jsx("input",{className:"input-field",value:g.name,onChange:N=>p({...g,name:N.target.value})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Email (Read Only)"}),t.jsx("input",{className:"input-field opacity-50 cursor-not-allowed",value:g.email,disabled:!0})]})]}),t.jsxs("div",{className:"bg-gray-950/50 p-4 rounded-xl border border-gray-800 space-y-4",children:[t.jsxs("h4",{className:"font-bold text-brand-purple flex items-center gap-2",children:[t.jsx(Fe,{size:16})," Access Level"]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Role"}),t.jsxs("select",{className:"input-field",value:g.role,onChange:N=>p({...g,role:N.target.value}),children:[t.jsx("option",{value:"User",children:"User"}),t.jsx("option",{value:"Moderator",children:"Moderator"}),t.jsx("option",{value:"Admin",children:"Admin"}),t.jsx("option",{value:"Super Admin",children:"Super Admin"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Account Status"}),t.jsxs("select",{className:"input-field",value:g.status,onChange:N=>p({...g,status:N.target.value}),children:[t.jsx("option",{value:"Active",children:"Active"}),t.jsx("option",{value:"Inactive",children:"Inactive"}),t.jsx("option",{value:"Banned",children:"Banned"})]})]})]})]}),t.jsxs("div",{className:"bg-gray-950/50 p-4 rounded-xl border border-gray-800 space-y-4",children:[t.jsxs("h4",{className:"font-bold text-green-500 flex items-center gap-2",children:[t.jsx(ws,{size:16})," Subscription & Packs"]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Primary Plan"}),t.jsxs("select",{className:"input-field",value:g.plan,onChange:N=>p({...g,plan:N.target.value}),children:[t.jsx("option",{value:"Free",children:"Free"}),ae.map(N=>t.jsx("option",{value:N.name,children:N.name},N.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm mb-2",children:"Grant Combo Packs"}),t.jsxs("div",{className:"max-h-32 overflow-y-auto bg-gray-900 border border-gray-700 rounded p-2 grid grid-cols-1 gap-1",children:[L.map(N=>t.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-800 rounded cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:g.purchasedPackIds.includes(N.id.toString()),onChange:()=>V(N.id.toString()),className:"accent-brand-purple"}),t.jsx("span",{className:"text-sm text-gray-300",children:N.name})]},N.id)),L.length===0&&t.jsx("span",{className:"text-xs text-gray-500",children:"No combo packs created yet."})]})]})]}),t.jsxs("div",{className:"border-t border-gray-800 pt-4 flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-bold text-white text-sm",children:"Security"}),t.jsx("p",{className:"text-xs text-gray-500",children:"Send a password reset link to user's email."})]}),t.jsx("button",{onClick:ne,className:"text-xs font-bold bg-gray-800 hover:bg-gray-700 text-white px-3 py-2 rounded border border-gray-600",children:"Send Reset Email"})]})]}),t.jsxs("div",{className:"p-6 border-t border-gray-800 bg-gray-900 flex justify-end gap-3",children:[t.jsx("button",{onClick:()=>h(!1),className:"btn-secondary",children:"Cancel"}),t.jsx("button",{onClick:I,className:"btn-primary shadow-lg shadow-purple-900/20",children:"Save Access Changes"})]})]})})]})},hl=()=>t.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[t.jsx("h2",{className:"text-2xl font-display font-bold text-white",children:"System Health & Analytics"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"bg-gray-900/50 p-6 rounded-2xl border border-gray-800 backdrop-blur-sm shadow-xl",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(jr,{size:24,className:"text-blue-400"}),t.jsx("h3",{className:"font-bold text-gray-200",children:"Server Load"})]}),t.jsx("div",{className:"h-2 bg-gray-800 rounded-full overflow-hidden mb-3 border border-gray-700 shadow-inner",children:t.jsx("div",{className:"h-full bg-blue-500 shadow-[0_0_10px_rgba(59,130,246,0.5)] w-[35%]"})}),t.jsxs("div",{className:"flex justify-between text-[10px] font-bold uppercase tracking-wider",children:[t.jsx("span",{className:"text-gray-500",children:"CPU Usage: 35%"}),t.jsx("span",{className:"text-green-400",children:"Optimal"})]})]}),t.jsxs("div",{className:"bg-gray-900/50 p-6 rounded-2xl border border-gray-800 backdrop-blur-sm shadow-xl",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(Rt,{size:24,className:"text-brand-purple"}),t.jsx("h3",{className:"font-bold text-gray-200",children:"Database"})]}),t.jsx("div",{className:"h-2 bg-gray-800 rounded-full overflow-hidden mb-3 border border-gray-700 shadow-inner",children:t.jsx("div",{className:"h-full bg-brand-purple shadow-[0_0_10px_rgba(168,85,247,0.5)] w-[62%]"})}),t.jsxs("div",{className:"flex justify-between text-[10px] font-bold uppercase tracking-wider",children:[t.jsx("span",{className:"text-gray-500",children:"Storage: 62%"}),t.jsx("span",{className:"text-green-400",children:"Running Smooth"})]})]}),t.jsxs("div",{className:"bg-gray-900/50 p-6 rounded-2xl border border-gray-800 backdrop-blur-sm shadow-xl flex flex-col justify-center",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(_r,{size:24,className:"text-green-400"}),t.jsx("h3",{className:"font-bold text-gray-200",children:"API Gateway"})]}),t.jsxs("div",{className:"text-4xl font-mono font-bold text-white tracking-tighter",children:["14.2k ",t.jsx("span",{className:"text-xs text-gray-500 font-sans font-normal uppercase tracking-widest pl-2",children:"Hits / 24h"})]}),t.jsx("div",{className:"text-[10px] text-gray-500 mt-3 font-bold uppercase",children:"Avg Latency: 45ms"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-2xl p-6 backdrop-blur-sm",children:[t.jsxs("h3",{className:"font-bold text-brand-purple mb-6 flex items-center gap-2 uppercase tracking-widest text-sm",children:[t.jsx(kr,{size:18})," Server Resources"]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between text-xs font-bold mb-2 uppercase tracking-wider text-gray-400",children:[t.jsx("span",{children:"Core CPU Load"}),t.jsx("span",{className:"text-white",children:"42%"})]}),t.jsx("div",{className:"h-2 bg-gray-800 rounded-full overflow-hidden border border-gray-700",children:t.jsx("div",{className:"h-full bg-brand-purple shadow-[0_0_10px_rgba(168,85,247,0.5)] transition-all duration-1000",style:{width:"42%"}})})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between text-xs font-bold mb-2 uppercase tracking-wider text-gray-400",children:[t.jsx("span",{children:"Memory Allocation"}),t.jsx("span",{className:"text-white",children:"1.2 GB / 2.0 GB"})]}),t.jsx("div",{className:"h-2 bg-gray-800 rounded-full overflow-hidden border border-gray-700",children:t.jsx("div",{className:"h-full bg-blue-500 shadow-[0_0_10px_rgba(59,130,246,0.5)] transition-all duration-1000",style:{width:"60%"}})})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between text-xs font-bold mb-2 uppercase tracking-wider text-gray-400",children:[t.jsx("span",{children:"SSD Storage (NVMe)"}),t.jsx("span",{className:"text-white",children:"156 GB / 512 GB"})]}),t.jsx("div",{className:"h-2 bg-gray-800 rounded-full overflow-hidden border border-gray-700",children:t.jsx("div",{className:"h-full bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.5)] transition-all duration-1000",style:{width:"30%"}})})]})]})]}),t.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-2xl p-6 backdrop-blur-sm",children:[t.jsxs("h3",{className:"font-bold text-brand-purple mb-4 flex items-center gap-2 uppercase tracking-widest text-sm",children:[t.jsx(Rt,{size:18})," Engine Health"]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"p-4 bg-gray-950 border border-gray-800 rounded-xl",children:[t.jsx("p",{className:"text-[10px] font-bold text-gray-600 uppercase tracking-widest mb-1",children:"Index Health"}),t.jsx("div",{className:"text-xl font-bold text-green-400 font-display",children:"OPTIMIZED"})]}),t.jsxs("div",{className:"p-4 bg-gray-950 border border-gray-800 rounded-xl",children:[t.jsx("p",{className:"text-[10px] font-bold text-gray-600 uppercase tracking-widest mb-1",children:"Latent Sync"}),t.jsx("div",{className:"text-xl font-bold text-blue-400 font-display",children:"ACTIVE"})]}),t.jsxs("div",{className:"p-4 bg-gray-950 border border-gray-800 rounded-xl",children:[t.jsx("p",{className:"text-[10px] font-bold text-gray-600 uppercase tracking-widest mb-1",children:"Backup Cycle"}),t.jsx("div",{className:"text-xs font-mono text-gray-400 mt-1",children:"EVERY 6H"})]}),t.jsxs("div",{className:"p-4 bg-gray-950 border border-gray-800 rounded-xl",children:[t.jsx("p",{className:"text-[10px] font-bold text-gray-600 uppercase tracking-widest mb-1",children:"Traffic Load"}),t.jsx("div",{className:"text-xs font-mono text-gray-400 mt-1",children:"NOMINAL (L2)"})]})]})]})]}),t.jsxs("div",{className:"bg-black text-green-400 p-6 rounded-xl font-mono text-xs overflow-hidden h-64 shadow-2xl relative",children:[t.jsx("div",{className:"absolute top-0 right-0 p-2 bg-gray-900 text-[10px] font-bold uppercase tracking-wider text-gray-500 rounded-bl-lg",children:"Live Logs"}),t.jsxs("div",{className:"space-y-1 opacity-80",children:[t.jsxs("p",{children:["[",new Date().toLocaleTimeString(),"] INFO: Server started on port 3000"]}),t.jsxs("p",{children:["[",new Date().toLocaleTimeString(),"] INFO: Database connection established (Latency: 12ms)"]}),t.jsxs("p",{children:["[",new Date().toLocaleTimeString(),"] WARN: High memory usage detected on Worker #4"]}),t.jsxs("p",{children:["[",new Date().toLocaleTimeString(),"] INFO: User 102 (Priya) authenticated via Google"]}),t.jsxs("p",{children:["[",new Date().toLocaleTimeString(),"] INFO: API /v1/exams returned 200 OK"]}),t.jsx("p",{className:"animate-pulse",children:"_"})]})]})]}),pl=()=>{const[s,e]=_.useState(localStorage.getItem("ar_typing_sync_status")||"Ready"),[r,a]=_.useState(!1);_.useEffect(()=>{const n=()=>e(localStorage.getItem("ar_typing_sync_status")||"Ready");window.addEventListener("adminStoreUpdate",n);const o=setInterval(n,2e3);return()=>{window.removeEventListener("adminStoreUpdate",n),clearInterval(o)}},[]);const i=async()=>{a(!0),await _s(),a(!1)};return t.jsxs("div",{className:"flex items-center gap-3 bg-gray-800/50 border border-gray-700/50 px-3 py-1.5 rounded-xl shadow-inner",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-[9px] font-bold text-gray-500 uppercase tracking-widest leading-none mb-1",children:"Live Sync"}),t.jsx("span",{className:`text-[11px] font-bold leading-none ${s.includes("Failed")?"text-red-400":s.includes("Ready")||s.includes("Up")?"text-blue-400":"text-green-400"}`,children:s})]}),t.jsx("button",{onClick:i,disabled:r,className:`p-1.5 rounded-lg bg-gray-700/50 text-gray-400 hover:text-brand-purple hover:bg-brand-purple/10 transition-all ${r?"animate-spin":""}`,title:"Force Refresh from Server",children:t.jsx(Mt,{size:14})})]})},gl=({templates:s,criteria:e,setCriteria:r})=>{var i;const a=H();return t.jsxs("div",{className:"space-y-6",children:[t.jsx("h2",{className:"text-2xl font-bold font-display text-white",children:"Certificate Manager"}),t.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl p-6 backdrop-blur-sm",children:[t.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2 text-gray-200",children:[t.jsx(ws,{size:20,className:"text-brand-purple"})," Certificate Criteria"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Minimum WPM"}),t.jsx("input",{type:"number",className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple",value:(e==null?void 0:e.minWPM)||35,onChange:n=>r({...e,minWPM:parseInt(n.target.value)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Minimum Accuracy %"}),t.jsx("input",{type:"number",className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple",value:(e==null?void 0:e.minAccuracy)||95,onChange:n=>r({...e,minAccuracy:parseInt(n.target.value)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"label-sm",children:"Test Type"}),t.jsxs("select",{className:"input-field bg-gray-900 border-gray-700 text-gray-200 focus:border-brand-purple",value:(e==null?void 0:e.testType)||"Any",onChange:n=>r({...e,testType:n.target.value}),children:[t.jsx("option",{children:"Any"}),t.jsx("option",{children:"Exam"}),t.jsx("option",{children:"Practice"})]})]}),t.jsx("div",{className:"flex items-end",children:t.jsx("button",{onClick:()=>r({...e,enabled:!(e!=null&&e.enabled)}),className:`w-full py-2 rounded-lg font-bold transition-all ${e!=null&&e.enabled?"bg-green-600 text-white shadow-[0_0_10px_rgba(34,197,94,0.3)]":"bg-gray-800 text-gray-500 border border-gray-700"}`,children:e!=null&&e.enabled?" Enabled":" Disabled"})})]})]}),t.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl p-6 backdrop-blur-sm",children:[t.jsx("h3",{className:"font-bold mb-4 text-gray-200",children:"Certificate Templates"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:(i=a.certificateTemplates)==null?void 0:i.map(n=>t.jsxs("div",{className:"bg-gray-950/50 border border-gray-800 rounded-2xl p-6 group hover:border-brand-purple transition-all relative overflow-hidden backdrop-blur-sm",children:[t.jsxs("div",{className:"flex justify-between items-start mb-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-bold text-gray-100 text-lg",children:n.name}),t.jsxs("p",{className:"text-[10px] text-gray-500 uppercase tracking-widest font-bold mt-1",children:["Template Code: ",n.id]})]}),t.jsx("div",{className:`p-2 rounded-lg ${n.active?"bg-green-900/20 text-green-400 border border-green-800":"bg-gray-800 text-gray-500 border border-gray-700"}`,children:n.active?t.jsx(rs,{size:20}):t.jsx(qa,{size:20})})]}),t.jsx("div",{className:"aspect-video bg-gray-900 rounded-xl border border-gray-800 flex items-center justify-center mb-6 shadow-inner group-hover:border-brand-purple/30 transition-colors",children:t.jsx(is,{size:48,className:"text-gray-800 group-hover:text-brand-purple/20 transition-colors"})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:"flex-1 btn-secondary text-xs uppercase tracking-widest font-bold",children:"Edit Design"}),t.jsx("button",{className:"flex-1 btn-primary text-xs uppercase tracking-widest font-bold border border-brand-purple/50",children:"Preview"})]})]},n.id))})]})]})},ml=({announcements:s,setAnnouncements:e})=>{const[r,a]=_.useState({message:"",type:"Info",isActive:!0}),i=()=>{if(!r.message)return;const l={id:`ann-${Date.now()}`,...r,expiryDate:new Date(Date.now()+10080*60*1e3).toISOString()};e([l,...s]),a({message:"",type:"Info",isActive:!0}),Zr({adminName:"Admin",action:"Announcement Created",details:`Created: ${r.message}`,type:"info"})},n=l=>{e(s.filter(c=>c.id!==l))},o=l=>{e(s.map(c=>c.id===l?{...c,isActive:!c.isActive}:c))};return t.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[t.jsx("h2",{className:"text-2xl font-bold font-display text-white",children:"Announcement Bar"}),t.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded-xl p-6",children:[t.jsx("h3",{className:"font-bold text-gray-200 mb-4",children:"Create New Announcement"}),t.jsxs("div",{className:"flex gap-4 items-end",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"label-sm",children:"Message"}),t.jsx("input",{className:"input-field bg-gray-950 border-gray-700",value:r.message,onChange:l=>a({...r,message:l.target.value}),placeholder:"e.g., Server Maintenance tonight at 10 PM"})]}),t.jsxs("div",{className:"w-32",children:[t.jsx("label",{className:"label-sm",children:"Type"}),t.jsxs("select",{className:"input-field bg-gray-950 border-gray-700",value:r.type,onChange:l=>a({...r,type:l.target.value}),children:[t.jsx("option",{children:"Info"}),t.jsx("option",{children:"Warning"}),t.jsx("option",{children:"Success"}),t.jsx("option",{children:"Danger"})]})]}),t.jsxs("button",{onClick:i,className:"btn-primary h-[38px] flex items-center gap-2",children:[t.jsx(ue,{size:16})," Publish"]})]})]}),t.jsx("div",{className:"bg-gray-900/50 border border-gray-800 rounded-xl overflow-hidden",children:t.jsxs("table",{className:"w-full text-sm text-left",children:[t.jsx("thead",{className:"bg-gray-800 text-gray-400",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-4",children:"Message"}),t.jsx("th",{className:"p-4",children:"Type"}),t.jsx("th",{className:"p-4",children:"Status"}),t.jsx("th",{className:"p-4 text-right",children:"Action"})]})}),t.jsxs("tbody",{className:"divide-y divide-gray-800",children:[s.map(l=>t.jsxs("tr",{className:"hover:bg-gray-800/50",children:[t.jsx("td",{className:"p-4 font-bold text-gray-200",children:l.message}),t.jsx("td",{className:"p-4",children:t.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold border ${l.type==="Info"?"bg-blue-900/20 text-blue-400 border-blue-800":l.type==="Warning"?"bg-yellow-900/20 text-yellow-400 border-yellow-800":l.type==="Success"?"bg-green-900/20 text-green-400 border-green-800":"bg-red-900/20 text-red-400 border-red-800"}`,children:l.type})}),t.jsx("td",{className:"p-4",children:t.jsx("button",{onClick:()=>o(l.id),className:`text-xs font-bold ${l.isActive?"text-green-400":"text-gray-500"}`,children:l.isActive?"Active":"Inactive"})}),t.jsx("td",{className:"p-4 text-right",children:t.jsx("button",{onClick:()=>n(l.id),className:"text-red-400 hover:text-red-300",children:t.jsx(oe,{size:16})})})]},l.id)),s.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:4,className:"p-8 text-center text-gray-500",children:"No announcements."})})]})]})})]})},le=({id:s,activeTab:e,setActiveTab:r,icon:a,label:i})=>t.jsxs("button",{onClick:()=>r(s),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold transition-all text-sm group ${e===s?"bg-brand-purple text-white shadow-[0_0_15px_rgba(168,85,247,0.4)]":"text-gray-400 hover:bg-gray-800/50 hover:text-white"}`,children:[t.jsx(a,{size:20,className:`${e===s?"text-white":"text-gray-500 group-hover:text-brand-purple"} transition-colors`}),t.jsx("span",{children:i})]}),fl=()=>{var x,w;const[s,e]=_.useState("dashboard"),[r,a]=_.useState(null),[i,n]=_.useState(null),[o,l]=_.useState(!1),[c,h]=_.useState(0),d=mr();_.useEffect(()=>{(async()=>{try{const S=H();S&&a(S),await _s();const T=H();T&&a(T)}catch(S){console.error("Store Load Error:",S),n(S.message||"Failed to load persistence layer")}})();const k=()=>{try{a(H())}catch(S){console.error(S)}};return window.addEventListener("adminStoreUpdate",k),()=>window.removeEventListener("adminStoreUpdate",k)},[]),_.useEffect(()=>{(async()=>{const{count:k,error:S}=await q.from("profiles").select("*",{count:"exact",head:!0});!S&&k!==null&&h(k)})()},[]);const f=()=>{localStorage.removeItem("ar_typing_admin_store_v2"),window.location.reload()};if(i)return t.jsxs("div",{className:"p-10 text-red-600",children:["Error: ",i," ",t.jsx("button",{onClick:f,children:"Reset"})]});if(!r)return t.jsx("div",{className:"p-10",children:"Loading..."});const{currentUser:g,logout:p,isAuthenticated:u,isAdmin:b}=xs();if(_.useEffect(()=>{(!u||!b)&&d("/admin/login")},[u,b,d]),!u||!b)return null;const m=((r==null?void 0:r.payments)||[]).reduce((v,k)=>{try{const S=(k==null?void 0:k.amount)!==void 0&&(k==null?void 0:k.amount)!==null?k.amount:0,T=parseFloat(S.toString().replace(/[^0-9.-]+/g,""));return v+(isNaN(T)?0:T)}catch{return v}},0),y=[{label:"Total Students",value:c||((x=r==null?void 0:r.users)==null?void 0:x.length)||0,change:"+0%",icon:t.jsx(as,{size:20,className:"text-blue-600"})},{label:"Revenue",value:`${m.toLocaleString()}`,change:"+0%",icon:t.jsx(yr,{size:20,className:"text-green-600"})},{label:"Active Plans",value:((r==null?void 0:r.users)||[]).filter(v=>(v==null?void 0:v.plan)!=="Basic").length,change:"Current",icon:t.jsx(vr,{size:20,className:"text-brand-purple"})}];return t.jsxs("div",{className:"flex h-screen bg-gray-950 overflow-hidden font-sans relative",children:[t.jsx("style",{children:".label-sm { font-size: 10px; font-weight: 700; color: #9CA3AF; text-transform: uppercase; display: block; margin-bottom: 4px; } .input-field { width: 100%; padding: 8px; border: 1px solid #374151; background-color: #111827; color: #e5e7eb; border-radius: 6px; font-size: 14px; outline: none; transition: border-color 0.2s; } .input-field:focus { border-color: #c026d3; } .btn-primary { background: #c026d3; color: white; padding: 8px 16px; border-radius: 8px; font-size: 14px; font-weight: 700; transition: background 0.2s; } .btn-primary:hover { background: #a21caf; } .btn-secondary { color: #9CA3AF; padding: 8px 16px; font-size: 14px; font-weight: 700; } .btn-secondary:hover { color: #e5e7eb; }"}),o&&t.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden animate-in fade-in duration-200",onClick:()=>l(!1)}),t.jsxs("aside",{className:`fixed md:static inset-y-0 left-0 w-64 bg-gray-900 border-r border-gray-800 flex flex-col z-50 transition-transform duration-300 md:translate-x-0 ${o?"translate-x-0":"-translate-x-full"} shrink-0 shadow-2xl md:shadow-none`,children:[t.jsxs("div",{className:"p-6 border-b border-gray-800 flex items-center gap-3",children:[t.jsx("div",{className:"w-9 h-9 bg-gray-800 border border-gray-700 text-white rounded-xl flex items-center justify-center font-bold text-xl shadow-lg",children:"TN"}),t.jsxs("span",{className:"font-display font-bold text-xl tracking-tight text-white",children:["Admin",t.jsx("span",{className:"text-brand-purple",children:"Portal"})]})]}),t.jsxs("div",{className:"flex-grow overflow-y-auto py-6 px-3 space-y-1",children:[t.jsx("p",{className:"px-4 text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2",children:"Modules"}),t.jsx(le,{id:"dashboard",activeTab:s,setActiveTab:v=>{e(v),l(!1)},icon:ja,label:"Dashboard"}),t.jsx(le,{id:"users",activeTab:s,setActiveTab:v=>{e(v),l(!1)},icon:as,label:"Users"}),t.jsx(le,{id:"content",activeTab:s,setActiveTab:v=>{e(v),l(!1)},icon:Ze,label:"Exams & Content"}),t.jsx(le,{id:"exam-profiles",activeTab:s,setActiveTab:v=>{e(v),l(!1)},icon:wr,label:"Exam Profiles"}),t.jsx(le,{id:"content-library",activeTab:s,setActiveTab:v=>{e(v),l(!1)},icon:fr,label:"Paragraphs Library"}),t.jsx(le,{id:"cpt-tests",activeTab:s,setActiveTab:v=>{e(v),l(!1)},icon:br,label:"CPT Management"}),t.jsx(le,{id:"ads",activeTab:s,setActiveTab:v=>{e(v),l(!1)},icon:Na,label:"Ads Manager"}),t.jsx(le,{id:"pricing",activeTab:s,setActiveTab:v=>{e(v),l(!1)},icon:ns,label:"Pricing & Packages"}),(r==null?void 0:r.users)&&g&&((w=r.users.find(v=>v.id===(g==null?void 0:g.id)))==null?void 0:w.role)==="Super Admin"&&t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"px-4 text-[10px] font-bold text-gray-400 uppercase tracking-widest mt-6 mb-2",children:"Super Admin"}),t.jsx(le,{id:"admins",activeTab:s,setActiveTab:v=>{e(v),l(!1)},icon:Fe,label:"Admin Management"})]}),t.jsx("p",{className:"px-4 text-[10px] font-bold text-gray-400 uppercase tracking-widest mt-6 mb-2",children:"System Controls"}),t.jsx(le,{id:"course-manager",activeTab:s,setActiveTab:v=>{e(v),l(!1)},icon:_a,label:"Course Manager"}),t.jsx(le,{id:"certificates",activeTab:s,setActiveTab:v=>{e(v),l(!1)},icon:ws,label:"Certificates"}),t.jsx(le,{id:"system",activeTab:s,setActiveTab:v=>{e(v),l(!1)},icon:jr,label:"System Health"}),t.jsx(le,{id:"settings",activeTab:s,setActiveTab:v=>{e(v),l(!1)},icon:vs,label:"Global Settings"}),t.jsx(le,{id:"logs",activeTab:s,setActiveTab:v=>{e(v),l(!1)},icon:Nr,label:"Activity Logs"})]}),t.jsxs("div",{className:"p-4 border-t border-gray-800 mt-auto bg-gray-900/50 space-y-2",children:[t.jsxs("a",{href:"https://typingnexus.in",target:"_blank",rel:"noopener noreferrer",className:"w-full flex items-center justify-center gap-2 px-4 py-2 rounded-lg font-bold transition-all text-xs text-brand-purple hover:bg-brand-purple/10 bg-gray-800 border border-brand-purple/30 shadow-lg group",children:[t.jsx(Sa,{size:16,className:"group-hover:scale-110 transition-transform"}),t.jsx("span",{children:"Visit Website"})]}),t.jsxs("button",{onClick:()=>{p(),d("/")},className:"w-full flex items-center justify-center gap-2 px-4 py-2 rounded-lg font-bold transition-all text-xs text-red-400 hover:bg-red-900/20 bg-gray-800 border border-red-900/50 shadow-lg group",children:[t.jsx(ka,{size:16,className:"group-hover:rotate-12 transition-transform"}),t.jsx("span",{children:"Logout Securely"})]})]})]}),t.jsxs("main",{className:"flex-1 flex flex-col min-w-0 overflow-hidden",children:[t.jsxs("div",{className:"md:hidden flex items-center justify-between p-4 bg-gray-900 border-b border-gray-800",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-8 bg-brand-purple text-white rounded-lg flex items-center justify-center font-bold text-xs shadow-lg shadow-purple-900/20",children:"AR"}),t.jsx("span",{className:"font-display font-bold text-sm text-white",children:"Admin Portal"})]}),t.jsx("button",{onClick:()=>l(!0),className:"p-2 text-gray-400 hover:bg-gray-800 rounded-lg transition-colors",children:t.jsx(Ca,{size:24})})]}),t.jsxs("div",{className:"hidden md:flex items-center justify-between px-10 py-4 bg-gray-950/30 border-b border-gray-800/30 backdrop-blur-sm",children:[t.jsx("div",{className:"flex items-center gap-4",children:t.jsxs("h2",{className:"text-sm font-bold text-gray-400 uppercase tracking-widest flex items-center gap-2",children:[t.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-brand-purple animate-pulse"}),"System ",s.replace("-"," ")]})}),t.jsx("div",{className:"flex items-center gap-4",children:t.jsx(pl,{})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-10",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[s==="dashboard"&&t.jsx(nl,{stats:y}),s==="users"&&t.jsx(ul,{users:r.users,setUsers:v=>M({...r,users:v}),toggleUserStatus:Vr,deleteUser:Kr}),s==="content"&&t.jsx(il,{exams:r.exams,setExams:v=>M({...r,exams:v}),rules:r.rules,categories:r.categories,setCategories:v=>M({...r,categories:v}),examProfiles:r.examProfiles||[],setExamProfiles:v=>M({...r,examProfiles:v})}),s==="ads"&&t.jsx(ll,{ads:r.ads,setAds:v=>M({...r,ads:v})}),s==="announcements"&&t.jsx(ml,{announcements:r.announcements,setAnnouncements:v=>M({...r,announcements:v})}),s==="admins"&&t.jsx(rl,{}),s==="system"&&t.jsx(hl,{}),s==="settings"&&t.jsx(ol,{settings:r.settings,setSettings:v=>M({...r,settings:v})}),s==="logs"&&t.jsx(al,{}),s==="exam-profiles"&&t.jsx(tl,{}),s==="content-library"&&t.jsx(Zo,{}),s==="cpt-tests"&&t.jsx(Xo,{}),s==="course-manager"&&t.jsx(sl,{}),s==="certificates"&&t.jsx(gl,{templates:r.certificateTemplates,criteria:r.certificateCriteria,setCriteria:v=>M({...r,certificateCriteria:v})}),s==="pricing"&&t.jsx(cl,{packages:r.packages||[],setPackages:v=>M({...r,packages:v})})]})})]})]})},xl=()=>t.jsx(Go,{children:t.jsx(ha,{children:t.jsxs(pa,{children:[t.jsx(Wt,{path:"/",element:t.jsx(Jo,{})}),t.jsx(Wt,{path:"/dashboard/*",element:t.jsx(fl,{})}),t.jsx(Wt,{path:"*",element:t.jsx(ga,{to:"/",replace:!0})})]})})}),ea=document.getElementById("root");if(!ea)throw new Error("Could not find root element to mount to");const bl=Ga.createRoot(ea);bl.render(t.jsx(At.StrictMode,{children:t.jsx(xl,{})}));
